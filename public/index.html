<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Yaz 2026 Strateji Merkezi | EgeModa KDS</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            background: #0a0a0f;
            min-height: 100vh;
            color: #e0e0e0;
            display: flex;
        }

        /* Sol Sidebar Men√º */
        .sidebar {
            width: 220px;
            min-height: 100vh;
            background: #12121a;
            border-right: 1px solid #2a2a4a;
            padding: 20px 0;
            position: fixed;
            left: 0;
            top: 0;
            overflow-y: auto;
        }

        .sidebar-logo {
            padding: 15px 20px;
            margin-bottom: 20px;
            border-bottom: 1px solid #2a2a4a;
        }

        .sidebar-logo h2 {
            font-size: 1.2em;
            background: linear-gradient(135deg, #00d4ff, #7c3aed);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .sidebar-logo p {
            font-size: 0.75em;
            color: #666;
        }

        .sidebar-menu {
            display: flex;
            flex-direction: column;
            gap: 4px;
            padding: 0 10px;
        }

        .sidebar-btn {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 15px;
            background: transparent;
            border: none;
            color: #888;
            font-size: 0.9em;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.2s;
            text-align: left;
        }

        .sidebar-btn:hover {
            background: rgba(255,255,255,0.05);
            color: #fff;
        }

        .sidebar-btn.active {
            background: linear-gradient(135deg, rgba(124,58,237,0.3), rgba(0,212,255,0.2));
            color: #00d4ff;
            border-left: 3px solid #00d4ff;
        }

        .sidebar-btn .icon {
            font-size: 1.1em;
        }

        .app {
            margin-left: 220px;
            flex: 1;
            padding: 20px;
            max-width: calc(100vw - 220px);
        }

        /* Header - gizli */
        .header {
            display: none;
        }

        .header h1 {
            font-size: 2.2em;
            font-weight: 700;
            margin-bottom: 8px;
            background: linear-gradient(135deg, #00d4ff, #7c3aed);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .header p {
            color: #888;
            font-size: 1em;
        }

        .header .target-badge {
            display: inline-block;
            background: linear-gradient(135deg, #7c3aed, #00d4ff);
            color: white;
            padding: 8px 20px;
            border-radius: 20px;
            font-weight: 600;
            margin-top: 15px;
            font-size: 0.9em;
        }

        /* Eski tabs gizle */
        .tabs {
            display: none;
        }

        /* Karar Paneli - En √ñnemli Kƒ±sƒ±m */
        .decision-panel {
            background: linear-gradient(135deg, #1e3a5f 0%, #0d1b2a 100%);
            border: 2px solid #00d4ff;
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
        }

        .decision-panel::before {
            content: 'üí°';
            position: absolute;
            right: 30px;
            top: 30px;
            font-size: 4em;
            opacity: 0.1;
        }

        .decision-panel h2 {
            font-size: 1.4em;
            margin-bottom: 20px;
            color: #00d4ff;
        }

        .decision-item {
            background: rgba(0, 212, 255, 0.1);
            border-radius: 12px;
            padding: 16px 20px;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 15px;
            border-left: 4px solid #00d4ff;
        }

        .decision-item.urgent {
            background: rgba(239, 68, 68, 0.15);
            border-left-color: #ef4444;
        }

        .decision-item.success {
            background: rgba(16, 185, 129, 0.15);
            border-left-color: #10b981;
        }

        .decision-item .icon {
            font-size: 1.8em;
            flex-shrink: 0;
        }

        .decision-item h4 {
            font-size: 1em;
            margin-bottom: 4px;
            color: #fff;
        }

        .decision-item p {
            font-size: 0.85em;
            color: #94a3b8;
        }

        /* √ñzet Kartlarƒ± - Kompakt */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: #12121a;
            border: 1px solid #2a2a4a;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            transition: transform 0.2s, border-color 0.2s;
        }

        .stat-card:hover {
            transform: translateY(-2px);
            border-color: #7c3aed;
        }

        .stat-card .value {
            font-size: 1.8em;
            font-weight: 700;
            margin-bottom: 3px;
        }

        .stat-card .label {
            color: #888;
            font-size: 0.85em;
        }

        .stat-card.highlight {
            background: linear-gradient(135deg, #7c3aed20, #00d4ff10);
            border-color: #7c3aed;
        }

        .stat-card.danger .value { color: #ef4444; }
        .stat-card.success .value { color: #10b981; }
        .stat-card.warning .value { color: #f59e0b; }
        .stat-card.info .value { color: #00d4ff; }

        /* Hedef Ayarlama */
        .target-control {
            background: #12121a;
            border: 1px solid #2a2a4a;
            border-radius: 10px;
            padding: 12px 20px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        .target-control label {
            font-weight: 600;
            font-size: 0.9em;
            color: #00d4ff;
            white-space: nowrap;
        }

        .target-control input[type="range"] {
            flex: 1;
            min-width: 150px;
            height: 6px;
            border-radius: 3px;
            background: #2a2a4a;
            -webkit-appearance: none;
            cursor: pointer;
        }

        .target-control input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: linear-gradient(135deg, #7c3aed, #00d4ff);
            cursor: pointer;
            box-shadow: 0 0 15px rgba(124, 58, 237, 0.5);
        }

        .target-display {
            font-size: 1.5em;
            font-weight: 700;
            color: #00d4ff;
            min-width: 60px;
            text-align: center;
        }

        /* Grafik Grid - 3 s√ºtun */
        .charts-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .chart-card {
            background: #12121a;
            border: 1px solid #2a2a4a;
            border-radius: 12px;
            padding: 15px;
        }

        .chart-card h3 {
            font-size: 0.85em;
            color: #888;
            margin-bottom: 10px;
            font-weight: 500;
        }

        .chart-container {
            height: 120px;
        }

        .chart-recommendation {
            margin-top: 8px;
            padding: 8px 10px;
            background: linear-gradient(135deg, #1a2a1a 0%, #12121a 100%);
            border-left: 3px solid #10b981;
            border-radius: 0 6px 6px 0;
            font-size: 0.7em;
            color: #a3e635;
            line-height: 1.4;
        }

        .chart-recommendation.warning {
            background: linear-gradient(135deg, #2a2a1a 0%, #12121a 100%);
            border-left-color: #f59e0b;
            color: #fbbf24;
        }

        .chart-recommendation.danger {
            background: linear-gradient(135deg, #2a1a1a 0%, #12121a 100%);
            border-left-color: #ef4444;
            color: #f87171;
        }

        .chart-recommendation.info {
            background: linear-gradient(135deg, #1a1a2a 0%, #12121a 100%);
            border-left-color: #3b82f6;
            color: #60a5fa;
        }

        /* Aksiyon Tablosu */
        .action-table {
            background: #12121a;
            border: 1px solid #2a2a4a;
            border-radius: 16px;
            overflow: hidden;
            margin-bottom: 30px;
        }

        .action-table h3 {
            padding: 20px 24px;
            font-size: 1.1em;
            border-bottom: 1px solid #2a2a4a;
            color: #ef4444;
        }

        /* A√ßƒ±lƒ±r/Kapanƒ±r Tablo */
        .collapsible-table .table-header-toggle {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 24px;
            cursor: pointer;
            transition: background 0.3s ease;
            border-bottom: 1px solid #2a2a4a;
        }

        .collapsible-table .table-header-toggle:hover {
            background: rgba(0, 212, 255, 0.05);
        }

        .record-count {
            font-size: 0.75em;
            color: #888;
            font-weight: 400;
        }

        .toggle-btn {
            background: linear-gradient(135deg, #1a1a2e, #252545);
            border: 1px solid #3a3a5a;
            color: #00d4ff;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.85em;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .toggle-btn:hover {
            background: linear-gradient(135deg, #252545, #303060);
            border-color: #00d4ff;
        }

        .toggle-icon {
            transition: transform 0.3s ease;
            display: inline-block;
        }

        .toggle-icon.collapsed {
            transform: rotate(-90deg);
        }

        .table-content {
            max-height: 600px;
            overflow: hidden;
            transition: max-height 0.4s ease, opacity 0.3s ease;
            opacity: 1;
        }

        .table-content.collapsed {
            max-height: 0;
            opacity: 0;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 16px 24px;
            text-align: left;
            border-bottom: 1px solid #1a1a2a;
        }

        th {
            color: #666;
            font-weight: 500;
            font-size: 0.8em;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        tr:hover {
            background: #1a1a2a;
        }

        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: 600;
        }

        .badge-danger { background: #7f1d1d; color: #fca5a5; }
        .badge-success { background: #064e3b; color: #6ee7b7; }
        .badge-warning { background: #78350f; color: #fcd34d; }
        .badge-info { background: #1e3a5f; color: #93c5fd; }

        /* Tab Sistemi */
        .tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 24px;
            background: #12121a;
            padding: 8px;
            border-radius: 12px;
            border: 1px solid #2a2a4a;
        }

        .tab-btn {
            background: transparent;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            color: #888;
            font-size: 0.9em;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .tab-btn:hover {
            background: #1a1a2a;
            color: #fff;
        }

        .tab-btn.active {
            background: linear-gradient(135deg, #7c3aed, #00d4ff);
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Butonlar */
        .btn {
            background: linear-gradient(135deg, #7c3aed, #00d4ff);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(124, 58, 237, 0.4);
        }

        .btn-secondary {
            background: #2a2a4a;
        }

        .btn-secondary:hover {
            background: #3a3a5a;
            box-shadow: none;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.9);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: #12121a;
            border: 1px solid #2a2a4a;
            border-radius: 20px;
            padding: 30px;
            width: 90%;
            max-width: 500px;
        }

        .modal-content h2 {
            margin-bottom: 20px;
            color: #00d4ff;
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-group label {
            display: block;
            color: #888;
            font-size: 0.85em;
            margin-bottom: 6px;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 12px 16px;
            background: #0a0a0f;
            border: 1px solid #2a2a4a;
            border-radius: 8px;
            color: #fff;
            font-size: 1em;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #7c3aed;
        }

        .form-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 24px;
        }

        /* Sim√ºlasyon */
        .sim-controls {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 24px;
        }

        /* Smart Notifications Panel */
        .smart-notifications {
            position: fixed;
            top: 80px;
            right: 20px;
            width: 340px;
            max-height: 400px;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            border: 1px solid #2a2a4a;
            border-radius: 16px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
            z-index: 1000;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .smart-notifications.has-alerts {
            border-color: #ef4444;
            box-shadow: 0 10px 40px rgba(239, 68, 68, 0.3);
        }

        .notifications-header {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 16px 20px;
            background: linear-gradient(135deg, #2a2a4a 0%, #1a1a2e 100%);
            border-bottom: 1px solid #2a2a4a;
        }

        .notifications-icon {
            font-size: 1.3em;
            animation: bellShake 0.5s ease-in-out;
        }

        @keyframes bellShake {
            0%, 100% { transform: rotate(0); }
            25% { transform: rotate(15deg); }
            75% { transform: rotate(-15deg); }
        }

        .notifications-header h4 {
            flex: 1;
            margin: 0;
            color: #fff;
            font-size: 0.95em;
        }

        .notifications-count {
            background: #ef4444;
            color: white;
            font-size: 0.75em;
            font-weight: 700;
            padding: 4px 10px;
            border-radius: 20px;
            min-width: 24px;
            text-align: center;
        }

        .notifications-count.zero {
            background: #10b981;
        }

        .notif-close-btn {
            background: transparent;
            border: none;
            color: #888;
            font-size: 1.5em;
            cursor: pointer;
            padding: 0 8px;
            line-height: 1;
            transition: all 0.2s;
            border-radius: 4px;
        }

        .notif-close-btn:hover {
            color: #ef4444;
            background: rgba(239, 68, 68, 0.1);
        }

        .smart-notifications.hidden {
            transform: translateX(400px);
            opacity: 0;
            pointer-events: none;
        }

        .notif-show-btn {
            position: fixed;
            top: 80px;
            right: 20px;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            border: 1px solid #2a2a4a;
            color: #00d4ff;
            padding: 12px 16px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 1em;
            display: none;
            z-index: 999;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }

        .notif-show-btn:hover {
            background: linear-gradient(135deg, #2a2a4a 0%, #1a1a2e 100%);
            transform: scale(1.05);
        }

        .notif-show-btn.visible {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .notifications-list {
            max-height: 320px;
            overflow-y: auto;
            padding: 12px;
        }

        .notification-empty {
            text-align: center;
            color: #666;
            padding: 20px;
            font-size: 0.9em;
        }

        .notification-item {
            display: flex;
            gap: 12px;
            padding: 12px;
            margin-bottom: 8px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 10px;
            border-left: 3px solid #3b82f6;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateX(20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .notification-item.danger {
            border-left-color: #ef4444;
            background: rgba(239, 68, 68, 0.1);
        }

        .notification-item.warning {
            border-left-color: #f59e0b;
            background: rgba(245, 158, 11, 0.1);
        }

        .notification-item.info {
            border-left-color: #3b82f6;
            background: rgba(59, 130, 246, 0.1);
        }

        .notification-icon {
            font-size: 1.2em;
        }

        .notification-content {
            flex: 1;
        }

        .notification-title {
            font-weight: 600;
            color: #fff;
            font-size: 0.85em;
            margin-bottom: 4px;
        }

        .notification-text {
            color: #999;
            font-size: 0.8em;
            line-height: 1.4;
        }

        /* Kritik Kar Alarmƒ± - Tablo Satƒ±r Stilleri */
        .row-critical {
            background: rgba(239, 68, 68, 0.15) !important;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { background: rgba(239, 68, 68, 0.15); }
            50% { background: rgba(239, 68, 68, 0.25); }
        }

        .row-warning {
            background: rgba(245, 158, 11, 0.1) !important;
        }

        .badge-critical {
            background: #ef4444 !important;
            color: white !important;
            animation: blink 1s infinite;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .badge-market-high {
            background: #f59e0b;
            color: #0a0a0f;
            font-size: 0.7em;
            padding: 2px 6px;
            border-radius: 4px;
            margin-left: 6px;
        }

        .risk-label {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
            font-size: 0.7em;
            font-weight: 600;
            padding: 3px 8px;
            border-radius: 4px;
            margin-left: 8px;
            animation: pulse 1.5s infinite;
        }

        /* Yaz Sezonu Sim√ºlasyon Ba≈ülƒ±k */
        .sim-header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #1a1a2e 0%, #0f3460 100%);
            border-radius: 16px;
            border: 1px solid #2a2a4a;
        }

        .sim-header h2 {
            font-size: 1.8em;
            color: #f59e0b;
            margin-bottom: 8px;
        }

        .sim-header p {
            color: #888;
            margin-bottom: 12px;
        }

        .sim-badge {
            display: inline-block;
            background: rgba(0, 212, 255, 0.1);
            border: 1px solid #00d4ff;
            color: #00d4ff;
            font-size: 0.8em;
            padding: 4px 12px;
            border-radius: 20px;
        }

        /* √úr√ºn Kartlarƒ± Grid */
        .product-cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .product-card {
            background: linear-gradient(135deg, #12121a 0%, #1a1a2e 100%);
            border: 3px solid #2a2a4a;
            border-radius: 20px;
            padding: 24px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .product-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: #2a2a4a;
        }

        .product-card.risk-kritik {
            border-color: #ef4444;
            box-shadow: 0 0 30px rgba(239, 68, 68, 0.4), inset 0 0 40px rgba(239, 68, 68, 0.1);
            animation: neonPulse 2s infinite;
        }

        .product-card.risk-kritik::before {
            background: linear-gradient(90deg, #ef4444, #dc2626);
        }

        @keyframes neonPulse {
            0%, 100% { box-shadow: 0 0 30px rgba(239, 68, 68, 0.4), inset 0 0 40px rgba(239, 68, 68, 0.1); }
            50% { box-shadow: 0 0 50px rgba(239, 68, 68, 0.6), inset 0 0 60px rgba(239, 68, 68, 0.2); }
        }

        .product-card.risk-risk {
            border-color: #f59e0b;
            box-shadow: 0 0 20px rgba(245, 158, 11, 0.3);
        }

        .product-card.risk-risk::before {
            background: linear-gradient(90deg, #f59e0b, #d97706);
        }

        .product-card.risk-guvenli {
            border-color: #10b981;
        }

        .product-card.risk-guvenli::before {
            background: linear-gradient(90deg, #10b981, #059669);
        }

        .product-card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .product-card-name {
            font-weight: 700;
            color: #fff;
            font-size: 1.2em;
            margin-bottom: 4px;
        }

        .product-card-category {
            font-size: 0.85em;
            color: #888;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .product-card-category::before {
            content: 'üìÅ';
            font-size: 0.9em;
        }

        .product-card-badge {
            font-size: 0.85em;
            font-weight: 700;
            padding: 8px 16px;
            border-radius: 30px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .badge-kritik {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
            animation: pulse 1.5s infinite;
        }

        .badge-kritik::before {
            content: 'üö®';
        }

        .badge-risk {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: #0a0a0f;
        }

        .badge-risk::before {
            content: '‚ö†Ô∏è';
        }

        .badge-guvenli {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
        }

        .badge-guvenli::before {
            content: '‚úÖ';
        }

        .product-card-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 16px;
        }

        .product-stat {
            text-align: center;
            padding: 15px 10px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 12px;
            border: 1px solid rgba(255,255,255,0.05);
        }

        .product-stat-icon {
            font-size: 1.5em;
            margin-bottom: 5px;
        }

        .product-stat-value {
            font-size: 1.5em;
            font-weight: 800;
            margin-bottom: 4px;
        }

        .product-stat-label {
            font-size: 0.75em;
            color: #888;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .product-card-arrow {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            padding: 12px;
            background: rgba(255,255,255,0.02);
            border-radius: 10px;
            margin-bottom: 12px;
        }

        .arrow-from {
            font-size: 1.3em;
            color: #888;
        }

        .arrow-icon {
            font-size: 1.5em;
            color: #00d4ff;
        }

        .arrow-to {
            font-size: 1.5em;
            font-weight: 700;
        }

        .product-card-action {
            background: linear-gradient(135deg, #1a1a2e, #252545);
            border-radius: 12px;
            padding: 15px;
            margin-top: 12px;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .action-label {
            font-size: 0.75em;
            color: #888;
            text-transform: uppercase;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .action-value {
            font-size: 1.3em;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .product-card-warning {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
            font-size: 0.9em;
            font-weight: 600;
            padding: 12px 16px;
            border-radius: 10px;
            text-align: center;
            margin-top: 12px;
            animation: blink 1s infinite;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .product-card-rekabet {
            font-size: 0.8em;
            padding: 10px 14px;
            border-radius: 10px;
            text-align: center;
            margin-top: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .rekabet-dusuk {
            background: rgba(239, 68, 68, 0.15);
            color: #ef4444;
            border: 1px solid #ef4444;
        }

        .rekabet-dusuk::before {
            content: 'üìâ';
        }

        .rekabet-ortalama {
            background: rgba(59, 130, 246, 0.15);
            color: #3b82f6;
            border: 1px solid #3b82f6;
        }

        .rekabet-ortalama::before {
            content: 'üìä';
        }

        .rekabet-avantaj {
            background: rgba(16, 185, 129, 0.15);
            color: #10b981;
            border: 1px solid #10b981;
        }

        /* Rakip Sayfasƒ± Stilleri */
        .rakip-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #2a2a4a;
        }

        .rakip-insights {
            background: linear-gradient(135deg, #12121a 0%, #1a1a2e 100%);
            border: 1px solid #2a2a4a;
            border-radius: 16px;
            padding: 24px;
        }

        .insights-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 16px;
        }

        .insight-card {
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid #2a2a4a;
            border-radius: 12px;
            padding: 16px;
            display: flex;
            gap: 12px;
            align-items: flex-start;
        }

        .insight-card.success {
            border-color: #10b981;
            background: rgba(16, 185, 129, 0.05);
        }

        .insight-card.warning {
            border-color: #f59e0b;
            background: rgba(245, 158, 11, 0.05);
        }

        .insight-card.danger {
            border-color: #ef4444;
            background: rgba(239, 68, 68, 0.05);
        }

        .insight-card.info {
            border-color: #3b82f6;
            background: rgba(59, 130, 246, 0.05);
        }

        .insight-icon {
            font-size: 1.5em;
            flex-shrink: 0;
        }

        .insight-content h4 {
            color: #fff;
            margin-bottom: 4px;
            font-size: 0.95em;
        }

        .insight-content p {
            color: #888;
            font-size: 0.85em;
            margin: 0;
        }

        .badge-avantaj {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.75em;
            font-weight: 600;
        }

        .badge-dezavantaj {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.75em;
            font-weight: 600;
        }

        .badge-esit {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.75em;
            font-weight: 600;
        }

        .rekabet-avantaj::before {
            content: 'üìà';
        }

        .sim-slider {
            background: #12121a;
            border: 1px solid #2a2a4a;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
        }

        .sim-slider label {
            display: block;
            color: #888;
            font-size: 0.85em;
            margin-bottom: 12px;
        }

        .sim-slider input[type="range"] {
            width: 100%;
            margin-bottom: 10px;
        }

        .sim-slider .value {
            font-size: 1.5em;
            font-weight: 700;
            color: #00d4ff;
        }

        .loading {
            text-align: center;
            padding: 60px;
            color: #666;
        }

        /* 6 Ay Sonra Karar Kutusu */
        .final-decision-box {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            border: 2px solid #10b981;
            border-radius: 20px;
            padding: 30px;
            margin-top: 30px;
            position: relative;
            overflow: hidden;
        }

        .final-decision-box::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 200px;
            height: 200px;
            background: radial-gradient(circle, rgba(16, 185, 129, 0.1) 0%, transparent 70%);
        }

        .final-decision-header {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 24px;
        }

        .final-icon {
            font-size: 3em;
            background: linear-gradient(135deg, #10b981, #00d4ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .final-decision-header h2 {
            font-size: 1.4em;
            color: #10b981;
            margin-bottom: 4px;
        }

        .final-decision-header p {
            color: #666;
            font-size: 0.9em;
        }

        .decision-main {
            background: rgba(16, 185, 129, 0.1);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            text-align: center;
        }

        .decision-badge {
            display: inline-block;
            font-size: 1.3em;
            font-weight: 700;
            color: #10b981;
        }

        .decision-badge.warning {
            color: #f59e0b;
        }

        .decision-badge.danger {
            color: #ef4444;
        }

        .decision-details {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
            margin-bottom: 24px;
        }

        .detail-item {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 12px;
            padding: 16px;
            text-align: center;
        }

        .detail-label {
            display: block;
            color: #666;
            font-size: 0.8em;
            margin-bottom: 8px;
        }

        .detail-value {
            font-size: 1.4em;
            font-weight: 700;
            color: #00d4ff;
        }

        .decision-steps {
            display: grid;
            gap: 12px;
        }

        .step-item {
            display: flex;
            align-items: center;
            gap: 14px;
            background: rgba(255, 255, 255, 0.02);
            border-radius: 10px;
            padding: 14px 18px;
            border-left: 3px solid #10b981;
        }

        .step-number {
            width: 28px;
            height: 28px;
            background: linear-gradient(135deg, #10b981, #00d4ff);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.85em;
            color: #000;
            flex-shrink: 0;
        }

        .step-text {
            color: #e0e0e0;
            font-size: 0.95em;
        }

        /* Analiz A√ßƒ±klamalarƒ± */
        .analysis-insights {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            margin-bottom: 24px;
        }

        .insight-card {
            background: #12121a;
            border: 1px solid #2a2a4a;
            border-radius: 12px;
            padding: 16px;
            display: flex;
            gap: 14px;
            align-items: flex-start;
            transition: all 0.3s;
        }

        .insight-card.dolar { border-left: 3px solid #10b981; }
        .insight-card.pamuk { border-left: 3px solid #f59e0b; }
        .insight-card.lojistik { border-left: 3px solid #3b82f6; }
        .insight-card.enflasyon { border-left: 3px solid #ef4444; }

        .insight-card.negative { background: rgba(239, 68, 68, 0.1); }
        .insight-card.positive { background: rgba(16, 185, 129, 0.1); }
        .insight-card.neutral { background: rgba(59, 130, 246, 0.1); }

        .insight-icon {
            font-size: 1.8em;
            flex-shrink: 0;
        }

        .insight-content h4 {
            font-size: 0.85em;
            color: #888;
            margin-bottom: 6px;
            font-weight: 500;
        }

        .insight-content p {
            font-size: 0.95em;
            color: #e0e0e0;
            line-height: 1.5;
        }

        .sim-conclusion {
            background: linear-gradient(135deg, #1a1a2e 0%, #0d1b2a 100%);
            border: 2px solid #7c3aed;
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 24px;
        }

        .conclusion-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
        }

        .conclusion-icon {
            font-size: 2em;
        }

        .conclusion-header h3 {
            font-size: 1.2em;
            color: #7c3aed;
        }

        .conclusion-text {
            font-size: 1.1em;
            color: #e0e0e0;
            line-height: 1.6;
        }

        .conclusion-text strong {
            color: #00d4ff;
        }

        .conclusion-text .danger { color: #ef4444; }
        .conclusion-text .success { color: #10b981; }
        .conclusion-text .warning { color: #f59e0b; }

        /* Aksiyon Takvimi */
        .calendar-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .calendar-header h2 {
            font-size: 1.8em;
            color: #00d4ff;
            margin-bottom: 8px;
        }

        .calendar-header p {
            color: #666;
        }

        .timeline {
            position: relative;
            padding-left: 100px;
        }

        .timeline::before {
            content: '';
            position: absolute;
            left: 45px;
            top: 0;
            bottom: 0;
            width: 3px;
            background: linear-gradient(to bottom, #7c3aed, #00d4ff);
            border-radius: 3px;
        }

        .timeline-item {
            position: relative;
            margin-bottom: 30px;
        }

        .timeline-marker {
            position: absolute;
            left: -100px;
            width: 90px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .month-badge {
            background: #1a1a2e;
            border: 2px solid #7c3aed;
            color: #7c3aed;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 700;
            font-size: 0.85em;
            z-index: 2;
        }

        .month-badge.success {
            background: #10b981;
            border-color: #10b981;
            color: #000;
        }

        .timeline-content {
            background: #12121a;
            border: 1px solid #2a2a4a;
            border-radius: 16px;
            padding: 24px;
            margin-left: 20px;
            transition: all 0.3s;
        }

        .timeline-content:hover {
            border-color: #7c3aed;
            transform: translateX(5px);
        }

        .timeline-content.highlight {
            background: linear-gradient(135deg, #1a1a2e 0%, #10b98120 100%);
            border-color: #10b981;
        }

        .timeline-content h3 {
            font-size: 1.1em;
            color: #fff;
            margin-bottom: 16px;
        }

        .action-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .action-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            background: rgba(255, 255, 255, 0.02);
            border-radius: 8px;
            transition: all 0.2s;
        }

        .action-item:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .action-item.completed {
            opacity: 0.6;
        }

        .action-item.completed .action-text {
            text-decoration: line-through;
        }

        .action-check {
            font-size: 1.2em;
            cursor: pointer;
            user-select: none;
            transition: transform 0.2s;
        }

        .action-check:hover {
            transform: scale(1.2);
        }

        .action-text {
            flex: 1;
            color: #e0e0e0;
            font-size: 0.95em;
        }

        .action-tag {
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.75em;
            font-weight: 600;
        }

        .priority-high .action-tag {
            background: #7f1d1d;
            color: #fca5a5;
        }

        .priority-medium .action-tag {
            background: #78350f;
            color: #fcd34d;
        }

        .priority-low .action-tag {
            background: #1e3a5f;
            color: #93c5fd;
        }

        .calendar-summary {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 16px;
            margin-top: 40px;
            margin-bottom: 20px;
        }

        .summary-card {
            background: #12121a;
            border: 1px solid #2a2a4a;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
        }

        .summary-icon {
            font-size: 1.5em;
            margin-bottom: 8px;
        }

        .summary-value {
            font-size: 2em;
            font-weight: 700;
            color: #00d4ff;
        }

        .summary-label {
            color: #666;
            font-size: 0.85em;
            margin-top: 4px;
        }

        .progress-bar-container {
            background: #1a1a2e;
            border-radius: 10px;
            height: 12px;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #7c3aed, #00d4ff);
            border-radius: 10px;
            transition: width 0.5s ease;
        }

        /* Senaryo Kar≈üƒ±la≈ütƒ±rma */
        .scenario-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .scenario-header h2 {
            font-size: 1.8em;
            color: #00d4ff;
            margin-bottom: 8px;
        }

        .scenario-header p {
            color: #666;
        }

        .scenario-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
        }

        .scenario-card {
            background: #12121a;
            border: 2px solid #2a2a4a;
            border-radius: 16px;
            padding: 24px;
            transition: all 0.3s;
        }

        .scenario-card:hover {
            transform: translateY(-5px);
        }

        .scenario-card.optimistic {
            border-color: #10b981;
        }

        .scenario-card.optimistic:hover {
            box-shadow: 0 10px 40px rgba(16, 185, 129, 0.2);
        }

        .scenario-card.normal {
            border-color: #3b82f6;
            background: linear-gradient(135deg, #12121a 0%, #1e3a5f20 100%);
        }

        .scenario-card.normal:hover {
            box-shadow: 0 10px 40px rgba(59, 130, 246, 0.2);
        }

        .scenario-card.pessimistic {
            border-color: #ef4444;
        }

        .scenario-card.pessimistic:hover {
            box-shadow: 0 10px 40px rgba(239, 68, 68, 0.2);
        }

        .scenario-badge {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.9em;
            margin-bottom: 20px;
        }

        .optimistic .scenario-badge {
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
        }

        .normal .scenario-badge {
            background: rgba(59, 130, 246, 0.2);
            color: #3b82f6;
        }

        .normal .scenario-badge.current {
            background: #3b82f6;
            color: #fff;
        }

        .pessimistic .scenario-badge {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
        }

        .scenario-params {
            margin-bottom: 20px;
        }

        .param-row {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #2a2a4a;
            font-size: 0.9em;
        }

        .param-row:last-child {
            border-bottom: none;
        }

        .param-row span:first-child {
            color: #888;
        }

        .param-value {
            font-weight: 600;
            color: #e0e0e0;
        }

        .scenario-results {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 16px;
        }

        .result-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
        }

        .result-label {
            color: #666;
            font-size: 0.85em;
        }

        .result-value {
            font-weight: 700;
            font-size: 1.1em;
            color: #00d4ff;
        }

        .result-value.success { color: #10b981; }
        .result-value.danger { color: #ef4444; }
        .result-value.warning { color: #f59e0b; }

        .scenario-verdict {
            background: rgba(255, 255, 255, 0.02);
            border-radius: 8px;
            padding: 12px;
            font-size: 0.9em;
            color: #94a3b8;
            text-align: center;
            line-height: 1.5;
        }

        .scenario-recommendation {
            background: linear-gradient(135deg, #1a1a2e 0%, #0d1b2a 100%);
            border: 2px solid #f59e0b;
            border-radius: 16px;
            padding: 24px;
            margin-top: 30px;
        }

        .rec-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
        }

        .rec-icon {
            font-size: 2em;
        }

        .rec-header h3 {
            font-size: 1.2em;
            color: #f59e0b;
        }

        .rec-content {
            font-size: 1em;
            color: #e0e0e0;
            line-height: 1.7;
        }

        .rec-content strong {
            color: #00d4ff;
        }

        /* Tahminleme */
        .forecast-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .forecast-header h2 {
            font-size: 1.8em;
            color: #00d4ff;
            margin-bottom: 8px;
        }

        .forecast-header p {
            color: #666;
        }

        .forecast-cards {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }

        .forecast-card {
            background: #12121a;
            border: 1px solid #2a2a4a;
            border-radius: 16px;
            padding: 24px;
            text-align: center;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .forecast-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
        }

        .forecast-card.sales::before { background: linear-gradient(90deg, #10b981, #00d4ff); }
        .forecast-card.demand::before { background: linear-gradient(90deg, #f59e0b, #ef4444); }
        .forecast-card.stock::before { background: linear-gradient(90deg, #3b82f6, #7c3aed); }
        .forecast-card.revenue::before { background: linear-gradient(90deg, #7c3aed, #ec4899); }

        .forecast-card:hover {
            transform: translateY(-5px);
            border-color: #7c3aed;
        }

        .forecast-icon {
            font-size: 2.5em;
            margin-bottom: 12px;
        }

        .forecast-card h3 {
            font-size: 0.9em;
            color: #888;
            margin-bottom: 12px;
            font-weight: 500;
        }

        .forecast-value {
            font-size: 2em;
            font-weight: 700;
            color: #00d4ff;
            margin-bottom: 8px;
        }

        .forecast-card.sales .forecast-value { color: #10b981; }
        .forecast-card.demand .forecast-value { color: #f59e0b; }
        .forecast-card.stock .forecast-value { color: #3b82f6; }
        .forecast-card.revenue .forecast-value { color: #7c3aed; }

        .forecast-card p {
            font-size: 0.85em;
            color: #666;
            margin-bottom: 12px;
        }

        .forecast-detail {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 8px;
            padding: 8px 12px;
            font-size: 0.8em;
            color: #94a3b8;
        }

        .forecast-methodology {
            background: #12121a;
            border: 1px solid #2a2a4a;
            border-radius: 16px;
            padding: 24px;
            margin-top: 30px;
        }

        .forecast-methodology h4 {
            color: #888;
            font-size: 1em;
            margin-bottom: 16px;
        }

        .method-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }

        .method-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px;
            background: rgba(255, 255, 255, 0.02);
            border-radius: 8px;
            font-size: 0.9em;
            color: #94a3b8;
        }

        .method-icon {
            font-size: 1.2em;
        }

        /* Ge√ßmi≈ü Veriler */
        .history-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .history-header h2 {
            font-size: 1.8em;
            color: #00d4ff;
            margin-bottom: 8px;
        }

        .history-header p {
            color: #666;
        }

        /* Yƒ±l Se√ßici */
        .year-selector {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .year-btn {
            padding: 12px 28px;
            background: linear-gradient(135deg, #1a1a2e 0%, #252545 100%);
            border: 2px solid #3a3a5a;
            border-radius: 12px;
            color: #888;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .year-btn:hover {
            border-color: #00d4ff;
            color: #00d4ff;
            transform: translateY(-2px);
        }

        .year-btn.active {
            background: linear-gradient(135deg, #00d4ff 0%, #0099cc 100%);
            border-color: #00d4ff;
            color: #0a0a0f;
            box-shadow: 0 4px 20px rgba(0, 212, 255, 0.3);
        }

        .year-btn-all {
            background: linear-gradient(135deg, #2a2a4a 0%, #3a3a5a 100%);
            border-color: #f59e0b;
            color: #f59e0b;
        }

        .year-btn-all:hover {
            border-color: #f59e0b;
            color: #f59e0b;
            background: linear-gradient(135deg, #3a3a4a 0%, #4a4a5a 100%);
        }

        .year-btn-all.active {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            border-color: #f59e0b;
            color: #0a0a0f;
            box-shadow: 0 4px 20px rgba(245, 158, 11, 0.3);
        }

        .history-summary {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 16px;
            margin-bottom: 30px;
        }

        .history-card {
            background: #12121a;
            border: 1px solid #2a2a4a;
            border-radius: 16px;
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 16px;
            transition: all 0.3s;
        }

        .history-card:hover {
            border-color: #7c3aed;
            transform: translateY(-3px);
        }

        .history-icon {
            font-size: 2.5em;
        }

        .history-info {
            display: flex;
            flex-direction: column;
        }

        .history-label {
            font-size: 0.8em;
            color: #666;
            margin-bottom: 4px;
        }

        .history-value {
            font-size: 1.6em;
            font-weight: 700;
            color: #ef4444;
        }

        .history-period {
            font-size: 0.75em;
            color: #888;
            margin-top: 2px;
        }

        .history-insights {
            background: #12121a;
            border: 1px solid #2a2a4a;
            border-radius: 16px;
            padding: 24px;
            margin-top: 30px;
        }

        .insight-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
        }

        .insight-header h3 {
            font-size: 1.1em;
            color: #f59e0b;
        }

        .insight-list {
            display: grid;
            gap: 12px;
        }

        .insight-item {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            padding: 14px 16px;
            background: rgba(255, 255, 255, 0.02);
            border-radius: 10px;
            border-left: 3px solid #f59e0b;
        }

        .insight-item.danger {
            border-left-color: #ef4444;
            background: rgba(239, 68, 68, 0.05);
        }

        .insight-item.success {
            border-left-color: #10b981;
            background: rgba(16, 185, 129, 0.05);
        }

        .insight-item .item-icon {
            font-size: 1.3em;
            flex-shrink: 0;
        }

        .insight-item .item-text {
            color: #e0e0e0;
            font-size: 0.95em;
            line-height: 1.5;
        }

        .history-decision {
            background: linear-gradient(135deg, #1e3a5f 0%, #0d1b2a 100%);
            border: 2px solid #00d4ff;
            border-radius: 16px;
            padding: 24px;
            margin-top: 30px;
            display: flex;
            align-items: flex-start;
            gap: 20px;
        }

        .history-decision .decision-icon {
            font-size: 3em;
            flex-shrink: 0;
        }

        .history-decision h3 {
            font-size: 1.1em;
            color: #00d4ff;
            margin-bottom: 12px;
        }

        .history-decision p {
            font-size: 1em;
            color: #e0e0e0;
            line-height: 1.7;
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .charts-grid { grid-template-columns: repeat(2, 1fr); }
        }

        @media (max-width: 1000px) {
            .sidebar { width: 180px; }
            .app { margin-left: 180px; max-width: calc(100vw - 180px); }
            .stats-grid { grid-template-columns: repeat(2, 1fr); }
            .charts-grid { grid-template-columns: 1fr; }
            .sim-controls { grid-template-columns: repeat(2, 1fr) !important; }
            .decision-details { grid-template-columns: 1fr; }
            .analysis-insights { grid-template-columns: 1fr; }
            .calendar-summary { grid-template-columns: repeat(2, 1fr); }
            .timeline { padding-left: 80px; }
            .timeline::before { left: 35px; }
            .timeline-marker { left: -80px; width: 70px; }
            .scenario-grid { grid-template-columns: 1fr; }
            .forecast-cards { grid-template-columns: repeat(2, 1fr); }
            .method-grid { grid-template-columns: 1fr; }
            .history-summary { grid-template-columns: repeat(2, 1fr); }
        }

        @media (max-width: 768px) {
            .sidebar { 
                position: fixed;
                z-index: 1000;
                transform: translateX(-100%);
                transition: transform 0.3s ease;
            }
            .sidebar.open { transform: translateX(0); }
            .app { margin-left: 0; max-width: 100%; padding: 15px; }
        }

        @media (max-width: 600px) {
            .stats-grid { grid-template-columns: 1fr; }
            .target-control { flex-direction: column; text-align: center; }
        }
    </style>
</head>
<body>
    <!-- Sol Sidebar Men√º -->
    <div class="sidebar">
        <div class="sidebar-logo">
            <h2>‚òÄÔ∏è EgeModa KDS</h2>
            <p>Yaz 2026 Strateji</p>
        </div>
        <div class="sidebar-menu">
            <button class="sidebar-btn active" onclick="showTab('genel')">
                <span class="icon">üìä</span> Genel Bakƒ±≈ü
            </button>
            <button class="sidebar-btn" onclick="showTab('gecmis')">
                <span class="icon">üìú</span> Ge√ßmi≈ü Veriler
            </button>
            <button class="sidebar-btn" onclick="showTab('tahmin')">
                <span class="icon">üîÆ</span> Tahminleme
            </button>
            <button class="sidebar-btn" onclick="showTab('sim√ºlasyon')">
                <span class="icon">üéöÔ∏è</span> Ne Olur Analizi
            </button>
            <button class="sidebar-btn" onclick="showTab('senaryo')">
                <span class="icon">üîÄ</span> Senaryo Kar≈üƒ±la≈ütƒ±r
            </button>
            <button class="sidebar-btn" onclick="showTab('urunler')">
                <span class="icon">üì¶</span> √úr√ºnler
            </button>
            <button class="sidebar-btn" onclick="showTab('rakipler')">
                <span class="icon">‚öîÔ∏è</span> Rakipler
            </button>
        </div>
    </div>

    <div class="app">

        <!-- GENEL BAKI≈û -->
        <div id="genel" class="tab-content active">

            <!-- Hedef Ayarlama -->
            <div class="target-control">
                <label>üéØ Hedef Kar Marjƒ±:</label>
                <input type="range" id="hedefSlider" min="30" max="100" value="50" oninput="updateAll()">
                <div class="target-display">%<span id="hedefValue">50</span></div>
            </div>

            <!-- √ñzet Kartlarƒ± -->
            <div class="stats-grid">
                <div class="stat-card info">
                    <div class="value" id="mevcutKar">-%</div>
                    <div class="label">Mevcut Kar Marjƒ±</div>
                </div>
                <div class="stat-card highlight">
                    <div class="value" id="hedefKar">%50</div>
                    <div class="label">Hedef Kar Marjƒ±</div>
                </div>
                <div class="stat-card danger">
                    <div class="value" id="riskliSayi">0</div>
                    <div class="label">Riskli √úr√ºn</div>
                </div>
                <div class="stat-card success">
                    <div class="value" id="guvenliSayi">0</div>
                    <div class="label">G√ºvenli √úr√ºn</div>
                </div>
            </div>

            <!-- Grafikler - Satƒ±r 1 -->
            <div class="charts-grid">
                <div class="chart-card">
                    <h3>üìà √úr√ºn Kar Marjlarƒ±</h3>
                    <div class="chart-container">
                        <canvas id="urunKarChart"></canvas>
                    </div>
                    <div class="chart-recommendation" id="rec-urunKar">üí° Analiz ediliyor...</div>
                </div>
                <div class="chart-card">
                    <h3>üéØ Durum Daƒüƒ±lƒ±mƒ±</h3>
                    <div class="chart-container">
                        <canvas id="durumChart"></canvas>
                    </div>
                    <div class="chart-recommendation" id="rec-durum">üí° Analiz ediliyor...</div>
                </div>
                <div class="chart-card">
                    <h3>üßµ Hammadde Maliyet Analizi</h3>
                    <div class="chart-container">
                        <canvas id="hammaddeMaliyetChart"></canvas>
                    </div>
                    <div class="chart-recommendation info" id="rec-hammaddeMaliyet">üí° Analiz ediliyor...</div>
                </div>
            </div>

            <!-- Grafikler - Satƒ±r 2 -->
            <div class="charts-grid">
                <div class="chart-card">
                    <h3>üìä Kategori Kar Marjlarƒ±</h3>
                    <div class="chart-container">
                        <canvas id="kategoriKarChart"></canvas>
                    </div>
                    <div class="chart-recommendation" id="rec-kategoriKar">üí° Analiz ediliyor...</div>
                </div>
                <div class="chart-card">
                    <h3>üéØ Yaz Hedefi Kar Gereksinimleri</h3>
                    <div class="chart-container">
                        <canvas id="yazHedefKarChart"></canvas>
                    </div>
                    <div class="chart-recommendation warning" id="rec-yazHedefKar">üí° Analiz ediliyor...</div>
                </div>
                <div class="chart-card">
                    <h3>‚òÄÔ∏è Yaz Mevsimi Karar Matrisi</h3>
                    <div class="chart-container">
                        <canvas id="yazKararChart"></canvas>
                    </div>
                    <div class="chart-recommendation" id="rec-yazKarar">üí° Analiz ediliyor...</div>
                </div>
            </div>

            <!-- Grafikler - Satƒ±r 3 -->
            <div class="charts-grid">
                <div class="chart-card">
                    <h3>üì¶ Stok Getirme Gereksinimleri</h3>
                    <div class="chart-container">
                        <canvas id="stokGereksinimChart"></canvas>
                    </div>
                    <div class="chart-recommendation" id="rec-stokGereksinim">üí° Analiz ediliyor...</div>
                </div>
                <div class="chart-card">
                    <h3>üåæ Hammadde Bazlƒ± Stok Deƒüeri</h3>
                    <div class="chart-container">
                        <canvas id="hammaddeKarChart"></canvas>
                    </div>
                    <div class="chart-recommendation info" id="rec-hammaddeKar">üí° Analiz ediliyor...</div>
                </div>
                <div class="chart-card">
                    <h3>üß∂ Hammadde ƒ∞htiyacƒ± (kg)</h3>
                    <div class="chart-container">
                        <canvas id="hammaddeIhtiyacChart"></canvas>
                    </div>
                    <div class="chart-recommendation info" id="rec-hammaddeIhtiyac">üí° Analiz ediliyor...</div>
                </div>
            </div>

            <!-- Grafikler - Satƒ±r 4 -->
            <div class="charts-grid">
                <div class="chart-card">
                    <h3>üìÖ Aylƒ±k Gelir Projeksiyonu (Yaz 2026)</h3>
                    <div class="chart-container">
                        <canvas id="aylikGelirChart"></canvas>
                    </div>
                    <div class="chart-recommendation" id="rec-aylikGelir">üí° Analiz ediliyor...</div>
                </div>
                <div class="chart-card">
                    <h3>üéØ Hedefe Ula≈üƒ±m ƒ∞lerlemesi</h3>
                    <div class="chart-container">
                        <canvas id="hedefIlerlemeChart"></canvas>
                    </div>
                    <div class="chart-recommendation" id="rec-hedefIlerleme">üí° Analiz ediliyor...</div>
                </div>
                <div class="chart-card">
                    <h3>üå°Ô∏è Sezon Hazƒ±rlƒ±k Durumu</h3>
                    <div class="chart-container">
                        <canvas id="sezonHazirlikChart"></canvas>
                    </div>
                    <div class="chart-recommendation" id="rec-sezonHazirlik">üí° Analiz ediliyor...</div>
                </div>
            </div>

            <!-- Riskli √úr√ºnler -->
            <div class="action-table" id="riskliTable" style="display: none;">
                <h3>üìã Stratejik Planlama Gerektiren √úr√ºnler</h3>
                <table>
                    <thead>
                        <tr>
                            <th>√úr√ºn</th>
                            <th>Mevcut Kar</th>
                            <th>Hedefe Fark</th>
                            <th>Yapƒ±lmasƒ± Gereken</th>
                        </tr>
                    </thead>
                    <tbody id="riskliBody"></tbody>
                </table>
            </div>

            <!-- 6 Ay Sonra En ƒ∞yi Karar -->
            <div class="final-decision-box">
                <div class="final-decision-header">
                    <span class="final-icon">üéØ</span>
                    <div>
                        <h2>6 Ay Sonra √ñnerilen Karar</h2>
                        <p>Haziran 2026 - Yaz Sezonu Ba≈ülangƒ±cƒ±</p>
                    </div>
                </div>
                <div class="final-decision-content" id="finalDecisionContent">
                    <div class="decision-main" id="mainDecision">
                        <span class="decision-badge">Hesaplanƒ±yor...</span>
                    </div>
                    <div class="decision-details" id="decisionDetails">
                        <div class="detail-item">
                            <span class="detail-label">Tahmini Kar Artƒ±≈üƒ±</span>
                            <span class="detail-value" id="tahminKarArtis">-</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">√ñnerilen Toplam Zam</span>
                            <span class="detail-value" id="toplamZamOneri">-</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Hedef Ula≈üƒ±m</span>
                            <span class="detail-value" id="hedefUlasim">-</span>
                        </div>
                    </div>
                    <div class="decision-steps" id="decisionSteps">
                        <!-- Adƒ±mlar dinamik olarak eklenecek -->
                    </div>
                </div>
            </div>
        </div>

        <!-- GE√áMƒ∞≈û VERƒ∞LER -->
        <div id="gecmis" class="tab-content">

            <!-- √ñzet Kartlarƒ± -->
            <div class="history-summary">
                <div class="history-card">
                    <div class="history-icon">üíµ</div>
                    <div class="history-info">
                        <span class="history-label">Dolar Kuru Artƒ±≈üƒ±</span>
                        <span class="history-value" id="dolarArtis">+%87</span>
                        <span class="history-period">2022 ‚Üí 2025</span>
                    </div>
                </div>
                <div class="history-card">
                    <div class="history-icon">üßµ</div>
                    <div class="history-info">
                        <span class="history-label">Pamuk Endeksi Artƒ±≈üƒ±</span>
                        <span class="history-value" id="pamukArtis">+%60</span>
                        <span class="history-period">2022 ‚Üí 2025</span>
                    </div>
                </div>
                <div class="history-card">
                    <div class="history-icon">üìà</div>
                    <div class="history-info">
                        <span class="history-label">Yƒ±llƒ±k Ort. Artƒ±≈ü</span>
                        <span class="history-value" id="ortArtis">+%29</span>
                        <span class="history-period">Son 3 yƒ±l</span>
                    </div>
                </div>
                <div class="history-card">
                    <div class="history-icon">üéØ</div>
                    <div class="history-info">
                        <span class="history-label">2026 Tahmini Dolar</span>
                        <span class="history-value" id="tahminDolar">42‚Ç∫</span>
                        <span class="history-period">Trend bazlƒ±</span>
                    </div>
                </div>
            </div>

            <!-- Trend Grafikleri -->
            <div class="charts-grid">
                <div class="chart-card">
                    <h3>üíµ Dolar Kuru Trendi (2022-2026)</h3>
                    <div class="chart-container" style="height: 280px;">
                        <canvas id="dolarTrendChart"></canvas>
                    </div>
                </div>
                <div class="chart-card">
                    <h3>üßµ Pamuk Endeksi Trendi (2022-2026)</h3>
                    <div class="chart-container" style="height: 280px;">
                        <canvas id="pamukTrendChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Yƒ±llƒ±k Kar≈üƒ±la≈ütƒ±rma Tablosu -->
            <div class="action-table">
                <h3 style="padding: 20px 24px; color: #00d4ff; border-bottom: 1px solid #2a2a4a;">üìä Yƒ±llƒ±k Parametre Deƒüi≈üimi</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Parametre</th>
                            <th>2022</th>
                            <th>2023</th>
                            <th>2025</th>
                            <th>2026 (Tahmin)</th>
                            <th>Toplam Deƒüi≈üim</th>
                        </tr>
                    </thead>
                    <tbody id="historyTableBody"></tbody>
                </table>
            </div>

            <!-- √úR√úN BAZLI GE√áMƒ∞≈û VERƒ∞LER -->
            <div class="history-header" style="margin-top: 50px;">
                <h2>üëó √úr√ºn Bazlƒ± Maliyet & Fiyat Ge√ßmi≈üi</h2>
                <p>Yƒ±l se√ßerek √ºr√ºnlerin o yƒ±ldaki maliyet ve fiyat durumunu g√∂r√ºn</p>
            </div>

            <!-- Yƒ±l Se√ßici -->
            <div class="year-selector">
                <button class="year-btn" data-year="2022" onclick="selectYear(2022)">2022</button>
                <button class="year-btn" data-year="2023" onclick="selectYear(2023)">2023</button>
                <button class="year-btn" data-year="2024" onclick="selectYear(2024)">2024</button>
                <button class="year-btn active" data-year="2025" onclick="selectYear(2025)">2025</button>
                <button class="year-btn year-btn-all" data-year="all" onclick="selectYear('all')">üìä T√ºm Yƒ±llar</button>
            </div>

            <!-- √úr√ºn Bazlƒ± √ñzet Kartlarƒ± -->
            <div class="history-summary">
                <div class="history-card">
                    <div class="history-icon">üíµ</div>
                    <div class="history-info">
                        <span class="history-label">Ortalama Maliyet</span>
                        <span class="history-value" id="ortMaliyetArtis">0 ‚Ç∫</span>
                        <span class="history-period" id="yilPeriod1">2025</span>
                    </div>
                </div>
                <div class="history-card">
                    <div class="history-icon">üè∑Ô∏è</div>
                    <div class="history-info">
                        <span class="history-label">Ortalama Fiyat</span>
                        <span class="history-value" id="ortFiyatArtis">0 ‚Ç∫</span>
                        <span class="history-period" id="yilPeriod2">2025</span>
                    </div>
                </div>
                <div class="history-card">
                    <div class="history-icon">üìä</div>
                    <div class="history-info">
                        <span class="history-label">Ort. Kar Marjƒ±</span>
                        <span class="history-value" id="ortKarMarji">%0</span>
                        <span class="history-period" id="yilPeriod3">2025</span>
                    </div>
                </div>
                <div class="history-card">
                    <div class="history-icon">üèÜ</div>
                    <div class="history-info">
                        <span class="history-label">En Y√ºksek Kar Marjƒ±</span>
                        <span class="history-value" id="enCokArtanUrun" style="font-size: 0.9em;">-</span>
                        <span class="history-period" id="enCokArtanYuzde">%0</span>
                    </div>
                </div>
            </div>

            <!-- √úr√ºn Bazlƒ± Grafikler -->
            <div class="charts-grid">
                <div class="chart-card">
                    <h3 id="maliyetChartTitle">üíµ √úr√ºn Maliyetleri - 2025</h3>
                    <div class="chart-container" style="height: 300px;">
                        <canvas id="urunMaliyetArtisChart"></canvas>
                    </div>
                </div>
                <div class="chart-card">
                    <h3 id="karMarjiChartTitle">üìä Kar Marjlarƒ± - 2025</h3>
                    <div class="chart-container" style="height: 300px;">
                        <canvas id="urunKarMarjiTrendChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- √úr√ºn Bazlƒ± Detay Tablosu -->
            <div class="action-table">
                <h3 id="urunTableTitle" style="padding: 20px 24px; color: #00d4ff; border-bottom: 1px solid #2a2a4a;">üëó √úr√ºn Verileri - 2025</h3>
                <table>
                    <thead id="urunTableHead">
                        <tr>
                            <th>√úr√ºn</th>
                            <th>Kategori</th>
                            <th>Maliyet</th>
                            <th>Satƒ±≈ü Fiyatƒ±</th>
                            <th>Kar</th>
                            <th>Kar Marjƒ±</th>
                            <th>Durum</th>
                        </tr>
                    </thead>
                    <tbody id="urunMaliyetTableBody"></tbody>
                </table>
            </div>

            <!-- Stratejik √áƒ±karƒ±mlar -->
            <div class="history-insights">
                <div class="insight-header">
                    <span class="insight-icon">üí°</span>
                    <h3>Stratejik √áƒ±karƒ±mlar</h3>
                </div>
                <div class="insight-list" id="historyInsightList">
                    <!-- Dinamik olarak doldurulacak -->
                </div>
            </div>

            <!-- Karar Destek √ñnerisi -->
            <div class="history-decision">
                <div class="decision-icon">üéØ</div>
                <div class="decision-content">
                    <h3>Ge√ßmi≈ü Verilere Dayalƒ± Karar √ñnerisi</h3>
                    <p id="historyDecision">Veriler analiz ediliyor...</p>
                </div>
            </div>
        </div>

        <!-- TAHMƒ∞NLEME -->
        <div id="tahmin" class="tab-content">

            <!-- Tahmin Kartlarƒ± -->
            <div class="forecast-cards">
                <div class="forecast-card sales">
                    <div class="forecast-icon">üìà</div>
                    <h3>Tahmini Satƒ±≈ü Artƒ±≈üƒ±</h3>
                    <div class="forecast-value" id="forecastSales">+%25</div>
                    <p>Yaz sezonu ortalamasƒ±</p>
                    <div class="forecast-detail">
                        <span>Haziran-Aƒüustos d√∂nemi</span>
                    </div>
                </div>
                <div class="forecast-card demand">
                    <div class="forecast-icon">üî•</div>
                    <h3>En Y√ºksek Talep</h3>
                    <div class="forecast-value" id="forecastDemand">Plaj Giyim</div>
                    <p>Kategori bazlƒ± tahmin</p>
                    <div class="forecast-detail">
                        <span>+%45 talep artƒ±≈üƒ± bekleniyor</span>
                    </div>
                </div>
                <div class="forecast-card stock">
                    <div class="forecast-icon">üì¶</div>
                    <h3>√ñnerilen Stok Artƒ±≈üƒ±</h3>
                    <div class="forecast-value" id="forecastStock">+%30</div>
                    <p>Yaz √∂ncesi hazƒ±rlƒ±k</p>
                    <div class="forecast-detail">
                        <span>Stok t√ºkenmesini √∂nlemek i√ßin</span>
                    </div>
                </div>
                <div class="forecast-card revenue">
                    <div class="forecast-icon">üí∞</div>
                    <h3>Tahmini Gelir</h3>
                    <div class="forecast-value" id="forecastRevenue">‚Ç∫0</div>
                    <p>Yaz sezonu toplam</p>
                    <div class="forecast-detail">
                        <span>Mevcut fiyatlarla hesaplanan</span>
                    </div>
                </div>
            </div>

            <!-- Aylƒ±k Satƒ±≈ü Tahmini Grafiƒüi -->
            <div class="chart-card">
                <h3>üìä Aylƒ±k Satƒ±≈ü Tahmini (2026)</h3>
                <div class="chart-container" style="height: 280px;">
                    <canvas id="salesForecastChart"></canvas>
                </div>
            </div>

            <!-- Kategori Bazlƒ± Tahmin -->
            <div class="charts-grid">
                <div class="chart-card">
                    <h3>üè∑Ô∏è Kategori Bazlƒ± Talep Tahmini</h3>
                    <div class="chart-container" style="height: 250px;">
                        <canvas id="categoryForecastChart"></canvas>
                    </div>
                </div>
                <div class="chart-card">
                    <h3>üì¶ Stok Optimizasyonu</h3>
                    <div class="chart-container" style="height: 250px;">
                        <canvas id="stockForecastChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- √úr√ºn Bazlƒ± Tahminler Tablosu -->
            <div class="action-table">
                <h3 style="padding: 20px 24px; color: #00d4ff; border-bottom: 1px solid #2a2a4a;">üéØ √úr√ºn Bazlƒ± Tahminler</h3>
                <table>
                    <thead>
                        <tr>
                            <th>√úr√ºn</th>
                            <th>Mevcut Stok</th>
                            <th>Tahmini Talep</th>
                            <th>√ñnerilen Stok</th>
                            <th>Stok Durumu</th>
                            <th>Aksiyon</th>
                        </tr>
                    </thead>
                    <tbody id="forecastTableBody"></tbody>
                </table>
            </div>

            <!-- Tahmin Metodolojisi -->
            <div class="forecast-methodology">
                <h4>üìê Tahmin Metodolojisi</h4>
                <div class="method-grid">
                    <div class="method-item">
                        <span class="method-icon">üìÖ</span>
                        <span>Mevsimsel analiz (yaz sezonu katsayƒ±larƒ±)</span>
                    </div>
                    <div class="method-item">
                        <span class="method-icon">üìä</span>
                        <span>Kategori bazlƒ± b√ºy√ºme oranlarƒ±</span>
                    </div>
                    <div class="method-item">
                        <span class="method-icon">üéØ</span>
                        <span>Stok/satƒ±≈ü oranƒ± optimizasyonu</span>
                    </div>
                    <div class="method-item">
                        <span class="method-icon">üí°</span>
                        <span>ƒ∞zmir e-ticaret pazar trendi</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- YAZ SEZONU Sƒ∞M√úLASYON - KDS ANALƒ∞Tƒ∞K MODEL -->
        <div id="sim√ºlasyon" class="tab-content">

            <!-- Smart Action Panel - Bildirimler -->
            <div class="smart-notifications" id="smartNotifications">
                <div class="notifications-header">
                    <span class="notifications-icon">üîî</span>
                    <h4>Stratejik Bildirimler</h4>
                    <span class="notifications-count" id="notifCount">0</span>
                    <button class="notif-close-btn" onclick="toggleNotifications()" title="Kapat">√ó</button>
                </div>
                <div class="notifications-list" id="notifList">
                    <div class="notification-empty">Slider'larƒ± hareket ettirerek analizi ba≈ülatƒ±n...</div>
                </div>
            </div>
            
            <!-- Bildirim G√∂ster Butonu -->
            <button class="notif-show-btn" id="notifShowBtn" onclick="toggleNotifications()">
                üîî <span>Bildirimleri G√∂ster</span>
            </button>

            <!-- Kontrol Paneli - 4 Slider -->
            <div class="sim-controls" style="grid-template-columns: repeat(4, 1fr);">
                <div class="sim-slider">
                    <label>üíµ Dolar Kuru (TL)</label>
                    <input type="range" id="simDolar" min="30" max="60" value="42" step="0.5" oninput="runYazSimulasyon()">
                    <div class="value"><span id="simDolarVal">42.00</span> ‚Ç∫</div>
                </div>
                <div class="sim-slider">
                    <label>üßµ Pamuk Endeksi</label>
                    <input type="range" id="simPamuk" min="100" max="200" value="152" step="1" oninput="runYazSimulasyon()">
                    <div class="value"><span id="simPamukVal">152</span></div>
                </div>
                <div class="sim-slider">
                    <label>üöö Lojistik Endeksi</label>
                    <input type="range" id="simLojistik" min="80" max="180" value="125" step="1" oninput="runYazSimulasyon()">
                    <div class="value"><span id="simLojistikVal">125</span></div>
                </div>
                <div class="sim-slider">
                    <label>üìà Enflasyon (%)</label>
                    <input type="range" id="simEnflasyon" min="20" max="80" value="44" step="1" oninput="runYazSimulasyon()">
                    <div class="value">%<span id="simEnflasyonVal">44</span></div>
                </div>
            </div>

            <!-- √ñzet Kartlarƒ± -->
            <div class="stats-grid">
                <div class="stat-card" id="kartKar">
                    <div class="value" id="simKar">-%</div>
                    <div class="label">Ortalama Kar Marjƒ±</div>
                </div>
                <div class="stat-card danger" id="kartKritik">
                    <div class="value" id="simKritik">0</div>
                    <div class="label">üö® Kritik √úr√ºn</div>
                </div>
                <div class="stat-card warning" id="kartRisk">
                    <div class="value" id="simRiskli">0</div>
                    <div class="label">‚ö†Ô∏è Riskli √úr√ºn</div>
                </div>
                <div class="stat-card" id="kartZam">
                    <div class="value" id="simZam">0‚Ç∫</div>
                    <div class="label">Toplam Zam Gereksinimi</div>
                </div>
            </div>

            <!-- Grafikler -->
            <div class="charts-grid">
                <div class="chart-card">
                    <h3>üìä Kar Marjƒ± Kar≈üƒ±la≈ütƒ±rmasƒ±</h3>
                    <div class="chart-container" style="height: 250px;">
                        <canvas id="simKarChart"></canvas>
                    </div>
                    <div class="chart-recommendation" id="rec-simKar">‚òÄÔ∏è YAZ 2026: Analiz ediliyor...</div>
                </div>
                <div class="chart-card">
                    <h3>üéØ Risk Daƒüƒ±lƒ±mƒ±</h3>
                    <div class="chart-container" style="height: 250px;">
                        <canvas id="simRiskChart"></canvas>
                    </div>
                    <div class="chart-recommendation" id="rec-simRisk">‚òÄÔ∏è YAZ 2026: Analiz ediliyor...</div>
                </div>
                <div class="chart-card">
                    <h3>üí∏ Maliyet Artƒ±≈ü Oranlarƒ±</h3>
                    <div class="chart-container" style="height: 250px;">
                        <canvas id="simMaliyetArtisChart"></canvas>
                    </div>
                    <div class="chart-recommendation warning" id="rec-simMaliyet">‚òÄÔ∏è YAZ 2026: Analiz ediliyor...</div>
                </div>
                <div class="chart-card">
                    <h3>üìÅ Kategori Bazlƒ± Ortalama Kar</h3>
                    <div class="chart-container" style="height: 250px;">
                        <canvas id="simKategoriKarChart"></canvas>
                    </div>
                    <div class="chart-recommendation" id="rec-simKategori">‚òÄÔ∏è YAZ 2026: Analiz ediliyor...</div>
                </div>
                <div class="chart-card">
                    <h3>üí∞ √ñnerilen Zam Tutarlarƒ±</h3>
                    <div class="chart-container" style="height: 250px;">
                        <canvas id="simZamChart"></canvas>
                    </div>
                    <div class="chart-recommendation warning" id="rec-simZam">‚òÄÔ∏è YAZ 2026: Analiz ediliyor...</div>
                </div>
                <div class="chart-card">
                    <h3>üìà Hedef vs Sim√ºle Kar Marjƒ±</h3>
                    <div class="chart-container" style="height: 250px;">
                        <canvas id="simHedefChart"></canvas>
                    </div>
                    <div class="chart-recommendation" id="rec-simHedef">‚òÄÔ∏è YAZ 2026: Analiz ediliyor...</div>
                </div>
            </div>

            <!-- √úr√ºn Kartlarƒ± - G√∂rsel Feedback -->
            <div class="section-header" style="margin: 40px 0 25px;">
                <h3 style="color: #00d4ff; text-align: center; font-size: 1.5em; margin-bottom: 10px;">
                    üëó Yazlƒ±k √úr√ºn Durumlarƒ±
                </h3>
                <p style="text-align: center; color: #888; font-size: 0.9em; max-width: 600px; margin: 0 auto;">
                    Her kartƒ±n √ºst√ºndeki renk bandƒ± √ºr√ºn√ºn risk durumunu g√∂sterir. 
                    <span style="color: #ef4444;">üî¥ Kƒ±rmƒ±zƒ± = Kritik</span> | 
                    <span style="color: #f59e0b;">üü† Turuncu = Risk</span> | 
                    <span style="color: #10b981;">üü¢ Ye≈üil = G√ºvenli</span>
                </p>
            </div>
            <div class="product-cards" id="productCards">
                <!-- Dinamik olarak doldurulacak -->
            </div>

            <!-- Detay Tablosu - A√ßƒ±lƒ±r/Kapanƒ±r -->
            <div class="action-table collapsible-table" style="margin-top: 30px;">
                <div class="table-header-toggle" onclick="toggleDetailTable()">
                    <h3 style="color: #00d4ff; margin: 0; display: flex; align-items: center; gap: 10px;">
                        üìã √úr√ºn Detay Tablosu
                        <span class="record-count" id="tableRecordCount">(0 kayƒ±t)</span>
                    </h3>
                    <button class="toggle-btn" id="toggleTableBtn">
                        <span class="toggle-icon" id="toggleIcon">‚ñº</span>
                        <span id="toggleText">Gizle</span>
                    </button>
                </div>
                <div class="table-content" id="detailTableContent">
                    <table>
                        <thead>
                            <tr>
                                <th>√úr√ºn</th>
                                <th>Kategori</th>
                                <th>Mevcut Kar</th>
                                <th>Sim√ºle Kar</th>
                                <th>Rakip Ort.</th>
                                <th>Rekabet</th>
                                <th>Risk</th>
                                <th>Stratejik Karar</th>
                            </tr>
                        </thead>
                        <tbody id="simBody"></tbody>
                    </table>
                </div>
            </div>

            <!-- Karar Destek √ñnerisi -->
            <div class="sim-conclusion" id="simConclusion">
                <div class="conclusion-header">
                    <span class="conclusion-icon">üéØ</span>
                    <h3>Karar Destek √ñnerisi</h3>
                </div>
                <div class="conclusion-text" id="conclusionText">
                    Slider'larƒ± hareket ettirerek yaz sezonu risk analizini ba≈ülatƒ±n...
                </div>
            </div>
        </div>

        <!-- SENARYO KAR≈ûILA≈ûTIRMA -->
        <div id="senaryo" class="tab-content">

            <div class="scenario-grid">
                <!-- Senaryo 1: ƒ∞yimser -->
                <div class="scenario-card optimistic">
                    <div class="scenario-badge">üòä ƒ∞yimser Senaryo</div>
                    <div class="scenario-params">
                        <div class="param-row">
                            <span>üíµ Dolar</span>
                            <span class="param-value" id="s1Dolar">32.00 ‚Ç∫</span>
                        </div>
                        <div class="param-row">
                            <span>üßµ Pamuk</span>
                            <span class="param-value" id="s1Pamuk">130</span>
                        </div>
                        <div class="param-row">
                            <span>üöö Lojistik</span>
                            <span class="param-value" id="s1Lojistik">100</span>
                        </div>
                        <div class="param-row">
                            <span>üìà Enflasyon</span>
                            <span class="param-value" id="s1Enflasyon">%35</span>
                        </div>
                    </div>
                    <div class="scenario-results">
                        <div class="result-item">
                            <span class="result-label">Ort. Kar Marjƒ±</span>
                            <span class="result-value success" id="s1Kar">-%</span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">Maliyet Deƒüi≈üimi</span>
                            <span class="result-value" id="s1Maliyet">-%</span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">Riskli √úr√ºn</span>
                            <span class="result-value" id="s1Risk">0</span>
                        </div>
                    </div>
                    <div class="scenario-verdict" id="s1Verdict">
                        Hesaplanƒ±yor...
                    </div>
                </div>

                <!-- Senaryo 2: Normal -->
                <div class="scenario-card normal">
                    <div class="scenario-badge current">üìä Mevcut Durum</div>
                    <div class="scenario-params">
                        <div class="param-row">
                            <span>üíµ Dolar</span>
                            <span class="param-value" id="s2Dolar">35.20 ‚Ç∫</span>
                        </div>
                        <div class="param-row">
                            <span>üßµ Pamuk</span>
                            <span class="param-value" id="s2Pamuk">152</span>
                        </div>
                        <div class="param-row">
                            <span>üöö Lojistik</span>
                            <span class="param-value" id="s2Lojistik">125</span>
                        </div>
                        <div class="param-row">
                            <span>üìà Enflasyon</span>
                            <span class="param-value" id="s2Enflasyon">%44</span>
                        </div>
                    </div>
                    <div class="scenario-results">
                        <div class="result-item">
                            <span class="result-label">Ort. Kar Marjƒ±</span>
                            <span class="result-value" id="s2Kar">-%</span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">Maliyet Deƒüi≈üimi</span>
                            <span class="result-value" id="s2Maliyet">0%</span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">Riskli √úr√ºn</span>
                            <span class="result-value" id="s2Risk">0</span>
                        </div>
                    </div>
                    <div class="scenario-verdict" id="s2Verdict">
                        Hesaplanƒ±yor...
                    </div>
                </div>

                <!-- Senaryo 3: K√∂t√ºmser -->
                <div class="scenario-card pessimistic">
                    <div class="scenario-badge">üò∞ K√∂t√ºmser Senaryo</div>
                    <div class="scenario-params">
                        <div class="param-row">
                            <span>üíµ Dolar</span>
                            <span class="param-value" id="s3Dolar">45.00 ‚Ç∫</span>
                        </div>
                        <div class="param-row">
                            <span>üßµ Pamuk</span>
                            <span class="param-value" id="s3Pamuk">180</span>
                        </div>
                        <div class="param-row">
                            <span>üöö Lojistik</span>
                            <span class="param-value" id="s3Lojistik">145</span>
                        </div>
                        <div class="param-row">
                            <span>üìà Enflasyon</span>
                            <span class="param-value" id="s3Enflasyon">%60</span>
                        </div>
                    </div>
                    <div class="scenario-results">
                        <div class="result-item">
                            <span class="result-label">Ort. Kar Marjƒ±</span>
                            <span class="result-value danger" id="s3Kar">-%</span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">Maliyet Deƒüi≈üimi</span>
                            <span class="result-value" id="s3Maliyet">+%</span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">Riskli √úr√ºn</span>
                            <span class="result-value" id="s3Risk">0</span>
                        </div>
                    </div>
                    <div class="scenario-verdict" id="s3Verdict">
                        Hesaplanƒ±yor...
                    </div>
                </div>
            </div>

            <!-- Kar≈üƒ±la≈ütƒ±rma Grafiƒüi -->
            <div class="chart-card" style="margin-top: 30px;">
                <h3>üìä Senaryo Kar≈üƒ±la≈ütƒ±rma Grafiƒüi</h3>
                <div class="chart-container" style="height: 300px;">
                    <canvas id="scenarioChart"></canvas>
                </div>
            </div>

            <!-- Karar √ñnerisi -->
            <div class="scenario-recommendation" id="scenarioRecommendation">
                <div class="rec-header">
                    <span class="rec-icon">üí°</span>
                    <h3>Stratejik √ñneri</h3>
                </div>
                <div class="rec-content" id="recContent">
                    Senaryolar hesaplanƒ±yor...
                </div>
            </div>
        </div>

        <!-- √úR√úNLER -->
        <div id="urunler" class="tab-content">

            <!-- √ñzet Kartlarƒ± -->
            <div class="stats-grid" style="margin-bottom: 30px;">
                <div class="stat-card">
                    <div class="stat-value" id="urunToplam">0</div>
                    <div class="stat-label">Toplam √úr√ºn</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="urunKategori">0</div>
                    <div class="stat-label">Kategori Sayƒ±sƒ±</div>
                </div>
                <div class="stat-card success">
                    <div class="stat-value" id="urunOrtKar">%0</div>
                    <div class="stat-label">Ort. Kar Marjƒ±</div>
                </div>
                <div class="stat-card warning">
                    <div class="stat-value" id="urunDusukStok">0</div>
                    <div class="stat-label">D√º≈ü√ºk Stok (‚â§10)</div>
                </div>
            </div>

            <!-- Grafikler -->
            <div class="charts-grid" style="margin-bottom: 30px;">
                <div class="chart-card">
                    <h3>üìä Kar Marjƒ± Daƒüƒ±lƒ±mƒ±</h3>
                    <div class="chart-container" style="height: 280px;">
                        <canvas id="urunTabKarChart"></canvas>
                    </div>
                </div>
                <div class="chart-card">
                    <h3>üè∑Ô∏è Kategori Bazlƒ± √úr√ºn Sayƒ±sƒ±</h3>
                    <div class="chart-container" style="height: 280px;">
                        <canvas id="urunTabKategoriChart"></canvas>
                    </div>
                </div>
                <div class="chart-card">
                    <h3>üì¶ Stok Durumu</h3>
                    <div class="chart-container" style="height: 280px;">
                        <canvas id="urunTabStokChart"></canvas>
                    </div>
                </div>
                <div class="chart-card">
                    <h3>üí∞ Fiyat vs Maliyet Kar≈üƒ±la≈ütƒ±rmasƒ±</h3>
                    <div class="chart-container" style="height: 280px;">
                        <canvas id="urunTabFiyatMaliyetChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Kategori Performans √ñzeti -->
            <div class="rakip-insights" style="margin-bottom: 30px;">
                <h3 style="color: #00d4ff; margin-bottom: 15px;">üìà Kategori Performans √ñzeti</h3>
                <div class="insights-grid" id="kategoriInsights">
                    <!-- Dinamik olarak doldurulacak -->
                </div>
            </div>

            <!-- Detay Tablosu - A√ßƒ±lƒ±r/Kapanƒ±r -->
            <div class="action-table collapsible-table">
                <div class="table-header-toggle" onclick="toggleUrunTable()">
                    <h3 style="color: #00d4ff; margin: 0; display: flex; align-items: center; gap: 10px;">
                        üìã √úr√ºn Detay Tablosu
                        <span class="record-count" id="urunRecordCount">(0 kayƒ±t)</span>
                    </h3>
                    <button class="toggle-btn" id="toggleUrunBtn">
                        <span class="toggle-icon" id="toggleUrunIcon">‚ñº</span>
                        <span id="toggleUrunText">Gizle</span>
                    </button>
                </div>
                <div class="table-content" id="urunTableContent">
                    <table>
                        <thead>
                            <tr>
                                <th>√úr√ºn Adƒ±</th>
                                <th>Kategori</th>
                                <th>Maliyet</th>
                                <th>Satƒ±≈ü Fiyatƒ±</th>
                                <th>Kar (‚Ç∫)</th>
                                <th>Kar Marjƒ±</th>
                                <th>Stok</th>
                                <th>Stok Deƒüeri</th>
                                <th>Durum</th>
                                <th>ƒ∞≈ülem</th>
                            </tr>
                        </thead>
                        <tbody id="urunlerBody"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- RAKƒ∞PLER -->
        <div id="rakipler" class="tab-content">

            <!-- √ñzet Kartlarƒ± -->
            <div class="stats-grid" style="margin-bottom: 30px;">
                <div class="stat-card">
                    <div class="stat-value" id="rakipToplam">0</div>
                    <div class="stat-label">Toplam Rakip Kaydƒ±</div>
                </div>
                <div class="stat-card success">
                    <div class="stat-value" id="rakipAvantaj">0</div>
                    <div class="stat-label">Fiyat Avantajƒ±</div>
                </div>
                <div class="stat-card danger">
                    <div class="stat-value" id="rakipDezavantaj">0</div>
                    <div class="stat-label">Fiyat Dezavantajƒ±</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="rakipOrtFark">0%</div>
                    <div class="stat-label">Ort. Fiyat Farkƒ±</div>
                </div>
            </div>

            <!-- Grafikler -->
            <div class="charts-grid" style="margin-bottom: 30px;">
                <div class="chart-card">
                    <h3>üìä Fiyat Kar≈üƒ±la≈ütƒ±rmasƒ± (√úr√ºn Bazlƒ±)</h3>
                    <div class="chart-container" style="height: 280px;">
                        <canvas id="rakipFiyatChart"></canvas>
                    </div>
                </div>
                <div class="chart-card">
                    <h3>üéØ Rekabet Durumu Daƒüƒ±lƒ±mƒ±</h3>
                    <div class="chart-container" style="height: 280px;">
                        <canvas id="rakipDurumChart"></canvas>
                    </div>
                </div>
                <div class="chart-card">
                    <h3>üí∞ Fiyat Farkƒ± Analizi (%)</h3>
                    <div class="chart-container" style="height: 280px;">
                        <canvas id="rakipFarkChart"></canvas>
                    </div>
                </div>
                <div class="chart-card">
                    <h3>üèÜ Rakip Bazlƒ± Ortalama Fiyat</h3>
                    <div class="chart-container" style="height: 280px;">
                        <canvas id="rakipOrtChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Stratejik √ñneriler -->
            <div class="rakip-insights" style="margin-bottom: 30px;">
                <h3 style="color: #00d4ff; margin-bottom: 15px;">üí° Stratejik √ñneriler</h3>
                <div class="insights-grid" id="rakipInsights">
                    <!-- Dinamik olarak doldurulacak -->
                </div>
            </div>

            <!-- Detay Tablosu -->
            <div class="action-table collapsible-table">
                <div class="table-header-toggle" onclick="toggleRakipTable()">
                    <h3 style="color: #00d4ff; margin: 0; display: flex; align-items: center; gap: 10px;">
                        üìã Rakip Fiyat Detaylarƒ±
                        <span class="record-count" id="rakipRecordCount">(0 kayƒ±t)</span>
                    </h3>
                    <button class="toggle-btn" id="toggleRakipBtn">
                        <span class="toggle-icon" id="toggleRakipIcon">‚ñº</span>
                        <span id="toggleRakipText">Gizle</span>
                    </button>
                </div>
                <div class="table-content" id="rakipTableContent">
                    <table>
                        <thead>
                            <tr>
                                <th>√úr√ºn</th>
                                <th>Kategori</th>
                                <th>Bizim Fiyat</th>
                                <th>Rakip</th>
                                <th>Rakip Fiyat</th>
                                <th>Fark (‚Ç∫)</th>
                                <th>Fark (%)</th>
                                <th>Durum</th>
                                <th>√ñneri</th>
                            </tr>
                        </thead>
                        <tbody id="rakipBody"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- √úr√ºn Modal -->
    <div id="urunModal" class="modal">
        <div class="modal-content">
            <h2>√úr√ºn Ekle/D√ºzenle</h2>
            <form id="urunForm">
                <input type="hidden" id="urunId">
                <div class="form-group">
                    <label>√úr√ºn Adƒ±</label>
                    <input type="text" id="urunAdi" required>
                </div>
                <div class="form-group">
                    <label>Kategori</label>
                    <select id="kategoriId" required></select>
                </div>
                <div class="form-group">
                    <label>Birim Maliyet (‚Ç∫)</label>
                    <input type="number" id="birimMaliyet" step="0.01" required>
                </div>
                <div class="form-group">
                    <label>Satƒ±≈ü Fiyatƒ± (‚Ç∫)</label>
                    <input type="number" id="satisFiyati" step="0.01" required>
                </div>
                <div class="form-group">
                    <label>Stok</label>
                    <input type="number" id="stokMiktari" value="0">
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('urunModal')">ƒ∞ptal</button>
                    <button type="submit" class="btn">Kaydet</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Rakip Modal -->
    <div id="rakipModal" class="modal">
        <div class="modal-content">
            <h2>Rakip Fiyatƒ± Ekle</h2>
            <form id="rakipForm">
                <div class="form-group">
                    <label>√úr√ºn</label>
                    <select id="rakipUrunId" required></select>
                </div>
                <div class="form-group">
                    <label>Rakip Adƒ±</label>
                    <input type="text" id="rakipAdi" required>
                </div>
                <div class="form-group">
                    <label>Rakip Fiyatƒ± (‚Ç∫)</label>
                    <input type="number" id="rakipFiyat" step="0.01" required>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('rakipModal')">ƒ∞ptal</button>
                    <button type="submit" class="btn">Kaydet</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        const API = '/api';
        let data = { urunler: [], kategoriler: [], rakipler: [], etkiler: [], cevre: [], base: { dolar: 40, pamuk: 145, lojistik: 115, enflasyon: 45 } };
        let charts = {};

        // Sayfa y√ºklendiƒüinde
        document.addEventListener('DOMContentLoaded', async () => {
            await loadData();
            updateAll();
            loadUrunler();
            loadRakipler();
        });

        // Veri y√ºkleme
        async function loadData() {
            try {
                const [u, k, r, e, c] = await Promise.all([
                    fetch(`${API}/urunler`).then(r => r.json()),
                    fetch(`${API}/kategoriler`).then(r => r.json()),
                    fetch(`${API}/rakipfiyatlari`).then(r => r.json()),
                    fetch(`${API}/urundisetki`).then(r => r.json()),
                    fetch(`${API}/discevreverileri`).then(r => r.json())
                ]);
                
                if (u.success) data.urunler = u.data;
                if (k.success) data.kategoriler = k.data;
                if (r.success) data.rakipler = r.data;
                if (e.success) data.etkiler = e.data;
                if (c.success) {
                    data.cevre = c.data;
                    // En g√ºncel verileri al (tarih bazlƒ± sƒ±ralƒ±)
                    const guncelVeriler = {};
                    c.data.forEach(v => {
                        const ad = v.parametre_adi.toLowerCase();
                        const tarih = new Date(v.kayit_tarihi);
                        
                        if (ad.includes('dolar') && !ad.includes('usd')) {
                            if (!guncelVeriler.dolar || tarih > guncelVeriler.dolar.tarih) {
                                guncelVeriler.dolar = { deger: parseFloat(v.deger), tarih };
                            }
                        } else if (ad.includes('pamuk') && !ad.includes('fiyat')) {
                            if (!guncelVeriler.pamuk || tarih > guncelVeriler.pamuk.tarih) {
                                guncelVeriler.pamuk = { deger: parseFloat(v.deger), tarih };
                            }
                        } else if (ad.includes('lojistik')) {
                            if (!guncelVeriler.lojistik || tarih > guncelVeriler.lojistik.tarih) {
                                guncelVeriler.lojistik = { deger: parseFloat(v.deger), tarih };
                            }
                        } else if (ad.includes('enflasyon')) {
                            if (!guncelVeriler.enflasyon || tarih > guncelVeriler.enflasyon.tarih) {
                                guncelVeriler.enflasyon = { deger: parseFloat(v.deger), tarih };
                            }
                        }
                    });

                    // G√ºncel deƒüerleri ata
                    if (guncelVeriler.dolar) data.base.dolar = guncelVeriler.dolar.deger;
                    if (guncelVeriler.pamuk) data.base.pamuk = guncelVeriler.pamuk.deger;
                    if (guncelVeriler.lojistik) data.base.lojistik = guncelVeriler.lojistik.deger;
                    if (guncelVeriler.enflasyon) data.base.enflasyon = guncelVeriler.enflasyon.deger;

                    // Slider'larƒ± g√ºncelle
                    document.getElementById('simDolar').value = data.base.dolar;
                    document.getElementById('simPamuk').value = data.base.pamuk;
                    document.getElementById('simLojistik').value = data.base.lojistik;
                    document.getElementById('simEnflasyon').value = data.base.enflasyon;

                    // Deƒüerleri g√∂ster
                    document.getElementById('simDolarVal').textContent = data.base.dolar.toFixed(2);
                    document.getElementById('simPamukVal').textContent = data.base.pamuk.toFixed(0);
                    document.getElementById('simLojistikVal').textContent = data.base.lojistik.toFixed(0);
                    document.getElementById('simEnflasyonVal').textContent = data.base.enflasyon.toFixed(0);
                }

                // Select'leri doldur
                const katSelect = document.getElementById('kategoriId');
                const urunSelect = document.getElementById('rakipUrunId');
                katSelect.innerHTML = '<option value="">Se√ßin</option>';
                urunSelect.innerHTML = '<option value="">Se√ßin</option>';
                data.kategoriler.forEach(k => katSelect.innerHTML += `<option value="${k.kategori_id}">${k.kategori_adi}</option>`);
                data.urunler.forEach(u => urunSelect.innerHTML += `<option value="${u.urun_id}">${u.urun_adi}</option>`);
            } catch (err) {
                console.error('Veri y√ºkleme hatasƒ±:', err);
            }
        }

        // Tab y√∂netimi
        function showTab(id) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.querySelectorAll('.sidebar-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            if (event && event.target) {
                event.target.classList.add('active');
            }
            
            if (id === 'sim√ºlasyon') runSim();
            if (id === 'senaryo') runScenarioComparison();
            if (id === 'tahmin') runForecast();
            if (id === 'gecmis') runHistoryAnalysis();
            if (id === 'urunler') loadUrunler();
            if (id === 'rakipler') loadRakipler();
        }

        // Ana g√ºncelleme
        function updateAll() {
            const hedef = parseInt(document.getElementById('hedefSlider').value);
            document.getElementById('hedefValue').textContent = hedef;
            document.getElementById('hedefKar').textContent = '%' + hedef;

            let toplam = 0, riskli = [], guvenli = 0;
            
            data.urunler.forEach(u => {
                const m = parseFloat(u.birim_maliyet) || 0;
                const f = parseFloat(u.satis_fiyati) || 0;
                const kar = f > 0 ? ((f - m) / f * 100) : 0;
                toplam += kar;
                
                if (kar < hedef) {
                    const zam = (m / (1 - hedef / 100)) - f;
                    riskli.push({ ...u, kar, zam });
                } else {
                    guvenli++;
                }
            });

            const avg = data.urunler.length ? toplam / data.urunler.length : 0;
            
            document.getElementById('mevcutKar').textContent = '%' + avg.toFixed(1);
            document.getElementById('riskliSayi').textContent = riskli.length;
            document.getElementById('guvenliSayi').textContent = guvenli;

            // Riskli tablo
            updateRiskliTable(riskli, hedef);
            
            // Grafikler
            drawCharts(hedef);

            // 6 Ay Sonra Karar
            updateFinalDecision(avg, hedef, riskli, guvenli);
        }

        function updateFinalDecision(avg, hedef, riskli, guvenli) {
            const mainDecision = document.getElementById('mainDecision');
            const stepsDiv = document.getElementById('decisionSteps');
            
            const toplamZam = riskli.reduce((sum, u) => sum + (u.zam > 0 ? u.zam : 0), 0);
            const fark = hedef - avg;
            const basariOrani = data.urunler.length > 0 ? (guvenli / data.urunler.length * 100) : 0;

            // Tahmini kar artƒ±≈üƒ± (6 ay sonunda)
            const tahminKarArtis = fark > 0 ? fark * 0.8 : 0; // %80 ger√ßekle≈üme varsayƒ±mƒ±

            document.getElementById('tahminKarArtis').textContent = '+' + tahminKarArtis.toFixed(1) + '%';
            document.getElementById('toplamZamOneri').textContent = toplamZam > 0 ? toplamZam.toFixed(0) + '‚Ç∫' : 'Gerek Yok';
            document.getElementById('hedefUlasim').textContent = '%' + basariOrani.toFixed(0);

            // Ana karar metni
            let decisionText, decisionClass, steps;

            if (riskli.length === 0) {
                decisionText = '‚úÖ Fiyatlarƒ± Koru, Yaz Kampanyalarƒ±na Hazƒ±rlan';
                decisionClass = '';
                steps = [
                    'Mevcut fiyatlandƒ±rma stratejiniz ba≈üarƒ±lƒ± - deƒüi≈ütirmeyin',
                    'Yaz sezonu i√ßin stok seviyelerini artƒ±rƒ±n',
                    'Plaj giyimi ve spor kategorilerinde kampanya planla',
                    'Rakip fiyatlarƒ±nƒ± haftalƒ±k takip edin'
                ];
            } else if (riskli.length <= 3) {
                decisionText = '‚ö° Se√ßili √úr√ºnlere Zam Yap, Diƒüerlerini Koru';
                decisionClass = 'warning';
                const urunler = riskli.slice(0, 3).map(u => u.urun_adi).join(', ');
                steps = [
                    `√ñncelikli zam yapƒ±lacak √ºr√ºnler: ${urunler}`,
                    'Zam oranƒ±nƒ± kademeli uygula (2 ayda %50 + %50)',
                    'Rakip fiyatlarƒ±yla kar≈üƒ±la≈ütƒ±r, √ßok pahalƒ± kalma',
                    'Yaz sezonu √∂ncesi (Mayƒ±s) t√ºm zamlarƒ± tamamla'
                ];
            } else {
                decisionText = 'üö® Kapsamlƒ± Fiyat Revizyonu Gerekli';
                decisionClass = 'danger';
                steps = [
                    `${riskli.length} √ºr√ºn√ºn fiyatƒ± hedefin altƒ±nda - planlƒ± revizyon gerekli`,
                    '√ñnce en d√º≈ü√ºk kar marjlƒ± √ºr√ºnlerden ba≈üla',
                    'Aylƒ±k %5-8 kademeli zam uygula',
                    'Maliyet d√º≈ü√ºrme alternatifleri ara≈ütƒ±r (tedarik√ßi, lojistik)',
                    'Yaz sezonuna kadar hedef marjƒ±n %80\'ine ula≈ü'
                ];
            }

            mainDecision.innerHTML = `<span class="decision-badge ${decisionClass}">${decisionText}</span>`;

            stepsDiv.innerHTML = steps.map((step, i) => `
                <div class="step-item">
                    <span class="step-number">${i + 1}</span>
                    <span class="step-text">${step}</span>
                </div>
            `).join('');
        }

        function updateRiskliTable(riskli, hedef) {
            const table = document.getElementById('riskliTable');
            const tbody = document.getElementById('riskliBody');
            
            if (riskli.length === 0) {
                table.style.display = 'none';
                return;
            }

            table.style.display = 'block';
            tbody.innerHTML = '';

            riskli.sort((a, b) => a.kar - b.kar).forEach(u => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td><strong>${u.urun_adi}</strong></td>
                    <td><span class="badge badge-danger">%${u.kar.toFixed(1)}</span></td>
                    <td style="color: #ef4444;">${(u.kar - hedef).toFixed(1)}%</td>
                    <td><span class="badge badge-warning">+${u.zam.toFixed(0)}‚Ç∫ zam √∂nerilir</span></td>
                `;
                tbody.appendChild(tr);
            });
        }

        function drawCharts(hedef) {
            // √úr√ºn kar grafiƒüi
            const ctx1 = document.getElementById('urunKarChart');
            if (charts.urunKar) charts.urunKar.destroy();
            
            const labels = data.urunler.map(u => u.urun_adi.length > 12 ? u.urun_adi.substring(0, 10) + '...' : u.urun_adi);
            const karlar = data.urunler.map(u => {
                const m = parseFloat(u.birim_maliyet) || 0;
                const f = parseFloat(u.satis_fiyati) || 0;
                return f > 0 ? ((f - m) / f * 100) : 0;
            });
            const renkler = karlar.map(k => k >= hedef ? '#10b981' : '#ef4444');

            charts.urunKar = new Chart(ctx1, {
                type: 'bar',
                data: {
                    labels,
                    datasets: [{ data: karlar, backgroundColor: renkler, borderRadius: 4 }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: { grid: { color: '#2a2a4a' }, ticks: { color: '#666' } },
                        x: { grid: { display: false }, ticks: { color: '#666', font: { size: 9 }, maxRotation: 45 } }
                    }
                }
            });

            // Durum daƒüƒ±lƒ±mƒ±
            const ctx2 = document.getElementById('durumChart');
            if (charts.durum) charts.durum.destroy();
            
            const riskli = karlar.filter(k => k < hedef).length;
            const guvenli = karlar.length - riskli;

            charts.durum = new Chart(ctx2, {
                type: 'doughnut',
                data: {
                    labels: ['Riskli', 'G√ºvenli'],
                    datasets: [{ data: [riskli, guvenli], backgroundColor: ['#ef4444', '#10b981'], borderWidth: 0 }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '60%',
                    plugins: { legend: { position: 'bottom', labels: { color: '#888', padding: 20 } } }
                }
            });

            // Kategori Kar Marjlarƒ±
            drawKategoriKarChart(hedef);
            
            // Hammadde Maliyet Analizi
            drawHammaddeMaliyetChart(hedef);
            
            // Yaz Hedefi Kar Gereksinimleri
            drawYazHedefKarChart(hedef);
            
            // Stok Getirme Gereksinimleri
            drawStokGereksinimChart(hedef);
            
            // Hammadde Bazlƒ± Kar Fƒ±rsatlarƒ±
            drawHammaddeKarChart(hedef);
            
            // Aylƒ±k Gelir Projeksiyonu
            drawAylikGelirChart();
            
            // Hammadde ƒ∞htiyacƒ±
            drawHammaddeIhtiyacChart(hedef);
            
            // Yaz Mevsimi Karar Matrisi
            drawYazKararChart(hedef);
            
            // Hedefe Ula≈üƒ±m ƒ∞lerlemesi
            drawHedefIlerlemeChart(hedef);
            
            // Sezon Hazƒ±rlƒ±k Durumu
            drawSezonHazirlikChart(hedef);
            
            // Y√∂netici √ñnerilerini G√ºncelle
            updateRecommendations(hedef);
        }

        // Y√∂netici √ñnerilerini G√ºncelle - YAZ 2026 STRATEJƒ∞K PLANLAMA
        function updateRecommendations(hedef) {
            const aylar = ['Ocak', '≈ûubat', 'Mart', 'Nisan', 'Mayƒ±s', 'Haziran', 'Temmuz', 'Aƒüustos', 'Eyl√ºl', 'Ekim', 'Kasƒ±m', 'Aralƒ±k'];
            const bugun = new Date();
            const yazBaslangic = new Date(2026, 5, 1); // Haziran 2026
            const kalanGun = Math.ceil((yazBaslangic - bugun) / (1000 * 60 * 60 * 24));
            const kalanAy = Math.ceil(kalanGun / 30);

            // 1. √úr√ºn Kar Marjlarƒ± √ñnerisi
            const karlar = data.urunler.map(u => {
                const m = parseFloat(u.birim_maliyet) || 0;
                const f = parseFloat(u.satis_fiyati) || 0;
                return f > 0 ? ((f - m) / f * 100) : 0;
            });
            const ortKar = karlar.length > 0 ? karlar.reduce((a, b) => a + b, 0) / karlar.length : 0;
            const riskliSayisi = karlar.filter(k => k < hedef).length;
            const recUrunKar = document.getElementById('rec-urunKar');
            if (recUrunKar) {
                if (ortKar >= hedef) {
                    recUrunKar.className = 'chart-recommendation';
                    recUrunKar.textContent = `‚òÄÔ∏è YAZ 2026: Mevcut %${ortKar.toFixed(1)} kar marjƒ±yla yazƒ± kar≈üƒ±layƒ±n. Nisan'a kadar fiyat sabitliƒüi saƒülayƒ±n.`;
                } else {
                    recUrunKar.className = 'chart-recommendation warning';
                    recUrunKar.textContent = `‚òÄÔ∏è YAZ 2026: ${riskliSayisi} √ºr√ºnde Mart sonuna kadar kademeli zam planlayƒ±n. M√º≈üteri kaybƒ±nƒ± √∂nleyin.`;
                }
            }

            // 2. Durum Daƒüƒ±lƒ±mƒ± √ñnerisi
            const guvenliSayisi = karlar.filter(k => k >= hedef).length;
            const recDurum = document.getElementById('rec-durum');
            if (recDurum) {
                const guvenliOran = karlar.length > 0 ? (guvenliSayisi / karlar.length * 100) : 0;
                if (guvenliOran >= 70) {
                    recDurum.className = 'chart-recommendation';
                    recDurum.textContent = `‚òÄÔ∏è YAZ 2026: %${guvenliOran.toFixed(0)} √ºr√ºn hazƒ±r. Haziran'da agresif pazarlama b√ºt√ßesi ayƒ±rƒ±n.`;
                } else if (guvenliOran >= 50) {
                    recDurum.className = 'chart-recommendation warning';
                    recDurum.textContent = `‚òÄÔ∏è YAZ 2026: %${(100-guvenliOran).toFixed(0)} √ºr√ºn risk altƒ±nda. ≈ûubat-Mart'ta tedarik√ßi g√∂r√º≈ümesi yapƒ±n.`;
                } else {
                    recDurum.className = 'chart-recommendation danger';
                    recDurum.textContent = `‚òÄÔ∏è YAZ 2026: Kritik! %${(100-guvenliOran).toFixed(0)} √ºr√ºn riskli. Ocak ayƒ±nda acil strateji revizyonu ≈üart!`;
                }
            }

            // 3. Hammadde Maliyet √ñnerisi
            const recHammaddeMaliyet = document.getElementById('rec-hammaddeMaliyet');
            if (recHammaddeMaliyet) {
                recHammaddeMaliyet.className = 'chart-recommendation info';
                recHammaddeMaliyet.textContent = `‚òÄÔ∏è YAZ 2026: ≈ûubat'ta pamuk vadeli alƒ±m yapƒ±n. Yaz fiyat artƒ±≈üƒ±ndan %15-20 tasarruf saƒülayƒ±n.`;
            }

            // 4. Kategori Kar Marjlarƒ± √ñnerisi
            const kategoriData = {};
            data.urunler.forEach(u => {
                const kategori = u.kategori_adi || 'Diƒüer';
                const m = parseFloat(u.birim_maliyet) || 0;
                const f = parseFloat(u.satis_fiyati) || 0;
                const kar = f > 0 ? ((f - m) / f * 100) : 0;
                if (!kategoriData[kategori]) kategoriData[kategori] = { toplam: 0, adet: 0 };
                kategoriData[kategori].toplam += kar;
                kategoriData[kategori].adet++;
            });
            const kategoriler = Object.entries(kategoriData).map(([k, v]) => ({ adi: k, ortKar: v.toplam / v.adet }));
            const enDusukKat = kategoriler.sort((a, b) => a.ortKar - b.ortKar)[0];
            const enYuksekKat = kategoriler.sort((a, b) => b.ortKar - a.ortKar)[0];
            const recKategoriKar = document.getElementById('rec-kategoriKar');
            if (recKategoriKar && enDusukKat && enYuksekKat) {
                if (enDusukKat.ortKar < hedef) {
                    recKategoriKar.className = 'chart-recommendation warning';
                    recKategoriKar.textContent = `‚òÄÔ∏è YAZ 2026: "${enDusukKat.adi}" kategorisini Nisan'a kadar revize edin veya koleksiyondan √ßƒ±karƒ±n.`;
                } else {
                    recKategoriKar.className = 'chart-recommendation';
                    recKategoriKar.textContent = `‚òÄÔ∏è YAZ 2026: "${enYuksekKat.adi}" kategorisine odaklanƒ±n. Yaz koleksiyonunda aƒüƒ±rlƒ±ƒüƒ± artƒ±rƒ±n.`;
                }
            }

            // 5. Yaz Hedefi Kar Gereksinimleri √ñnerisi
            const recYazHedefKar = document.getElementById('rec-yazHedefKar');
            if (recYazHedefKar) {
                if (riskliSayisi > 0) {
                    recYazHedefKar.className = 'chart-recommendation warning';
                    recYazHedefKar.textContent = `‚òÄÔ∏è YAZ 2026: ${riskliSayisi} √ºr√ºn i√ßin Mart'a kadar yeni fiyat listesi hazƒ±rlayƒ±n. Bayi bilgilendirmesi yapƒ±n.`;
                } else {
                    recYazHedefKar.className = 'chart-recommendation';
                    recYazHedefKar.textContent = `‚òÄÔ∏è YAZ 2026: T√ºm fiyatlar hazƒ±r! Mayƒ±s'ta erken sezon indirimi ile pazara girin.`;
                }
            }

            // 6. Yaz Mevsimi Karar Matrisi √ñnerisi
            let zamYap = 0, stokAl = 0, satisArttir = 0, koru = 0;
            data.urunler.forEach(u => {
                const m = parseFloat(u.birim_maliyet) || 0;
                const f = parseFloat(u.satis_fiyati) || 0;
                const stok = parseInt(u.stok_miktari) || 0;
                const kar = f > 0 ? ((f - m) / f * 100) : 0;
                if (kar < hedef && stok > 50) zamYap++;
                else if (kar >= hedef && stok < 30) stokAl++;
                else if (kar < hedef && stok < 30) satisArttir++;
                else koru++;
            });
            const recYazKarar = document.getElementById('rec-yazKarar');
            if (recYazKarar) {
                const oncelikliAksiyon = Math.max(zamYap, stokAl, satisArttir);
                if (zamYap === oncelikliAksiyon && zamYap > 0) {
                    recYazKarar.className = 'chart-recommendation danger';
                    recYazKarar.textContent = `‚òÄÔ∏è YAZ 2026: ${zamYap} √ºr√ºnde ≈ûubat-Mart d√∂neminde kademeli zam uygulayƒ±n. Yaza hazƒ±r girin.`;
                } else if (stokAl === oncelikliAksiyon && stokAl > 0) {
                    recYazKarar.className = 'chart-recommendation info';
                    recYazKarar.textContent = `‚òÄÔ∏è YAZ 2026: ${stokAl} √ºr√ºn i√ßin Mart'ta √ºretim sipari≈üi verin. Temmuz talebine hazƒ±r olun.`;
                } else if (satisArttir === oncelikliAksiyon && satisArttir > 0) {
                    recYazKarar.className = 'chart-recommendation warning';
                    recYazKarar.textContent = `‚òÄÔ∏è YAZ 2026: ${satisArttir} √ºr√ºn√º bahar sezon sonu indiriminde eritin. Yaza temiz stokla girin.`;
                } else {
                    recYazKarar.className = 'chart-recommendation';
                    recYazKarar.textContent = `‚òÄÔ∏è YAZ 2026: Portf√∂y dengeli! Mayƒ±s'ta lansman kampanyasƒ±, Haziran'da sosyal medya b√ºt√ßesi artƒ±rƒ±n.`;
                }
            }

            // 7. Stok Getirme Gereksinimleri √ñnerisi
            let stokArtir = 0, stokAzalt = 0;
            data.urunler.forEach(u => {
                const m = parseFloat(u.birim_maliyet) || 0;
                const f = parseFloat(u.satis_fiyati) || 0;
                const kar = f > 0 ? ((f - m) / f * 100) : 0;
                if (kar >= hedef) stokArtir++;
                else stokAzalt++;
            });
            const recStokGereksinim = document.getElementById('rec-stokGereksinim');
            if (recStokGereksinim) {
                if (stokArtir > stokAzalt) {
                    recStokGereksinim.className = 'chart-recommendation';
                    recStokGereksinim.textContent = `‚òÄÔ∏è YAZ 2026: ${stokArtir} √ºr√ºn i√ßin Nisan'da depo kapasitesi planlayƒ±n. Tedarik s√∂zle≈ümesi imzalayƒ±n.`;
                } else {
                    recStokGereksinim.className = 'chart-recommendation warning';
                    recStokGereksinim.textContent = `‚òÄÔ∏è YAZ 2026: ${stokAzalt} riskli √ºr√ºn i√ßin yeni sipari≈ü vermeyin. Mevcut stoƒüu Mayƒ±s'a kadar eritin.`;
                }
            }

            // 8. Hammadde Bazlƒ± Stok Deƒüeri √ñnerisi
            const recHammaddeKar = document.getElementById('rec-hammaddeKar');
            if (recHammaddeKar) {
                let toplamStokDeger = 0;
                data.urunler.forEach(u => {
                    const f = parseFloat(u.satis_fiyati) || 0;
                    const stok = parseInt(u.stok_miktari) || 0;
                    toplamStokDeger += f * stok;
                });
                recHammaddeKar.className = 'chart-recommendation info';
                recHammaddeKar.textContent = `‚òÄÔ∏è YAZ 2026: ${(toplamStokDeger/1000).toFixed(0)}K‚Ç∫ stok deƒüeri. Yaz i√ßin %30 artƒ±≈ü hedefleyin, ≈ûubat'ta sipari≈ü verin.`;
            }

            // 9. Hammadde ƒ∞htiyacƒ± √ñnerisi
            const recHammaddeIhtiyac = document.getElementById('rec-hammaddeIhtiyac');
            if (recHammaddeIhtiyac) {
                let toplamStok = 0;
                data.urunler.forEach(u => { toplamStok += parseInt(u.stok_miktari) || 0; });
                const tahminiKg = (toplamStok * 0.35 * 1.5).toFixed(0); // Yaz i√ßin %50 artƒ±≈ü
                recHammaddeIhtiyac.className = 'chart-recommendation info';
                recHammaddeIhtiyac.textContent = `‚òÄÔ∏è YAZ 2026: Tahmini ${tahminiKg}kg hammadde gerekli. Ocak-≈ûubat'ta vadeli alƒ±m anla≈ümasƒ± yapƒ±n.`;
            }

            // 10. Aylƒ±k Gelir Projeksiyonu √ñnerisi
            const recAylikGelir = document.getElementById('rec-aylikGelir');
            if (recAylikGelir) {
                recAylikGelir.className = 'chart-recommendation';
                recAylikGelir.textContent = `‚òÄÔ∏è YAZ 2026: Temmuz-Aƒüustos pik! Haziran'da √∂n satƒ±≈ü kampanyasƒ±, Temmuz'da tam kapasite √ßalƒ±≈üƒ±n.`;
            }

            // 11. Hedefe Ula≈üƒ±m ƒ∞lerlemesi √ñnerisi
            const recHedefIlerleme = document.getElementById('rec-hedefIlerleme');
            if (recHedefIlerleme) {
                const hedefteOran = karlar.length > 0 ? (guvenliSayisi / karlar.length * 100) : 0;
                if (hedefteOran >= 80) {
                    recHedefIlerleme.className = 'chart-recommendation';
                    recHedefIlerleme.textContent = `‚òÄÔ∏è YAZ 2026: %${hedefteOran.toFixed(0)} hazƒ±r! Nisan'da yeni √ºr√ºn lansmanƒ± planlayƒ±n, yaz koleksiyonunu geni≈ületin.`;
                } else if (hedefteOran >= 50) {
                    recHedefIlerleme.className = 'chart-recommendation warning';
                    recHedefIlerleme.textContent = `‚òÄÔ∏è YAZ 2026: %${(100-hedefteOran).toFixed(0)} eksik. Mart sonuna kadar fiyat/maliyet optimizasyonu tamamlayƒ±n.`;
                } else {
                    recHedefIlerleme.className = 'chart-recommendation danger';
                    recHedefIlerleme.textContent = `‚òÄÔ∏è YAZ 2026: Kritik! %${(100-hedefteOran).toFixed(0)} hedef dƒ±≈üƒ±. Ocak'ta stratejik planlama toplantƒ±sƒ± d√ºzenleyin.`;
                }
            }

            // 12. Sezon Hazƒ±rlƒ±k Durumu √ñnerisi
            const recSezonHazirlik = document.getElementById('rec-sezonHazirlik');
            if (recSezonHazirlik) {
                const hazirlikSkoru = Math.min(100, (guvenliSayisi / Math.max(1, karlar.length) * 50) + (ortKar >= hedef ? 50 : ortKar / hedef * 50));
                if (hazirlikSkoru >= 75) {
                    recSezonHazirlik.className = 'chart-recommendation';
                    recSezonHazirlik.textContent = `‚òÄÔ∏è YAZ 2026: %${hazirlikSkoru.toFixed(0)} hazƒ±rlƒ±k tamam! Mayƒ±s'ta medya kampanyasƒ± ba≈ülatƒ±n, influencer anla≈ümalarƒ± yapƒ±n.`;
                } else if (hazirlikSkoru >= 50) {
                    recSezonHazirlik.className = 'chart-recommendation warning';
                    recSezonHazirlik.textContent = `‚òÄÔ∏è YAZ 2026: %${hazirlikSkoru.toFixed(0)} hazƒ±rlƒ±k. ${kalanAy} ay i√ßinde eksikleri tamamlayƒ±n, haftalƒ±k ilerleme takibi yapƒ±n.`;
                } else {
                    recSezonHazirlik.className = 'chart-recommendation danger';
                    recSezonHazirlik.textContent = `‚òÄÔ∏è YAZ 2026: %${hazirlikSkoru.toFixed(0)} hazƒ±rlƒ±k - Rƒ∞SKLƒ∞! Acil eylem planƒ±: Fiyat revizyonu + Tedarik anla≈ümasƒ± + Stok planlamasƒ±.`;
                }
            }
        }

        function drawKategoriKarChart(hedef) {
            const ctx = document.getElementById('kategoriKarChart');
            if (!ctx) return;
            if (charts.kategoriKar) charts.kategoriKar.destroy();

            // Kategorilere g√∂re grupla
            const kategoriData = {};
            data.urunler.forEach(u => {
                const kategori = u.kategori_adi || 'Diƒüer';
                const m = parseFloat(u.birim_maliyet) || 0;
                const f = parseFloat(u.satis_fiyati) || 0;
                const kar = f > 0 ? ((f - m) / f * 100) : 0;
                
                if (!kategoriData[kategori]) {
                    kategoriData[kategori] = { toplam: 0, adet: 0 };
                }
                kategoriData[kategori].toplam += kar;
                kategoriData[kategori].adet++;
            });

            const kategoriler = Object.keys(kategoriData);
            const ortKarlar = kategoriler.map(k => kategoriData[k].toplam / kategoriData[k].adet);

            charts.kategoriKar = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: kategoriler.map(k => k.length > 15 ? k.substring(0, 12) + '...' : k),
                    datasets: [{
                        label: 'Ort. Kar Marjƒ± %',
                        data: ortKarlar,
                        backgroundColor: ortKarlar.map(k => k >= hedef ? 'rgba(16, 185, 129, 0.8)' : 'rgba(245, 158, 11, 0.8)'),
                        borderRadius: 6
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        x: { grid: { color: '#2a2a4a' }, ticks: { color: '#666', callback: v => '%' + v } },
                        y: { grid: { display: false }, ticks: { color: '#888', font: { size: 10 } } }
                    }
                }
            });
        }

        // Yaz Hedefi Kar Gereksinimleri - Hedefe ula≈ümak i√ßin gereken fiyat artƒ±≈üƒ±
        function drawYazHedefKarChart(hedef) {
            const ctx = document.getElementById('yazHedefKarChart');
            if (!ctx) return;
            if (charts.yazHedefKar) charts.yazHedefKar.destroy();

            // Her √ºr√ºn i√ßin hedefe ula≈ümak i√ßin gereken fiyat artƒ±≈üƒ±nƒ± hesapla
            let gereksinimler = data.urunler.map(u => {
                const m = parseFloat(u.birim_maliyet) || 0;
                const f = parseFloat(u.satis_fiyati) || 0;
                const mevcutKar = f > 0 ? ((f - m) / f * 100) : 0;
                
                // Hedef kar marjƒ±na ula≈ümak i√ßin gereken yeni fiyat
                const gerekliYeniFiyat = m / (1 - hedef / 100);
                const gerekliArtis = gerekliYeniFiyat - f;
                const artisYuzdesi = f > 0 ? (gerekliArtis / f * 100) : 0;
                
                return {
                    adi: u.urun_adi,
                    mevcutKar,
                    gerekliArtis,
                    artisYuzdesi,
                    hedefteUlasmis: mevcutKar >= hedef
                };
            });

            // Hedefe ula≈ümamƒ±≈ü √ºr√ºnleri g√∂ster, yoksa en d√º≈ü√ºk karlƒ±larƒ± g√∂ster
            const riskliUrunler = gereksinimler.filter(u => !u.hedefteUlasmis);
            if (riskliUrunler.length > 0) {
                gereksinimler = riskliUrunler.sort((a, b) => b.gerekliArtis - a.gerekliArtis).slice(0, 6);
            } else {
                // T√ºm √ºr√ºnler hedefte - en d√º≈ü√ºk karlƒ± 6 √ºr√ºn√º g√∂ster (g√ºvenli marj i√ßin)
                gereksinimler = gereksinimler.sort((a, b) => a.mevcutKar - b.mevcutKar).slice(0, 6);
            }

            const hepsiHedefte = riskliUrunler.length === 0;

            charts.yazHedefKar = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: gereksinimler.map(u => u.adi.length > 10 ? u.adi.substring(0, 8) + '...' : u.adi),
                    datasets: [{
                        label: hepsiHedefte ? 'Hedef √úst√º Kar (%)' : 'Gereken Fiyat Artƒ±≈üƒ± (‚Ç∫)',
                        data: hepsiHedefte 
                            ? gereksinimler.map(u => u.mevcutKar - hedef) 
                            : gereksinimler.map(u => Math.max(0, u.gerekliArtis)),
                        backgroundColor: hepsiHedefte 
                            ? '#10b981' 
                            : gereksinimler.map(u => u.artisYuzdesi > 30 ? '#ef4444' : u.artisYuzdesi > 15 ? '#f59e0b' : '#3b82f6'),
                        borderRadius: 4
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { 
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                afterLabel: (ctx) => {
                                    const item = gereksinimler[ctx.dataIndex];
                                    return hepsiHedefte 
                                        ? `Kar Marjƒ±: %${item.mevcutKar.toFixed(1)}` 
                                        : `Artƒ±≈ü: %${item.artisYuzdesi.toFixed(1)}`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: { grid: { color: '#2a2a4a' }, ticks: { color: '#666', callback: v => hepsiHedefte ? '+%' + v.toFixed(0) : '+' + v.toFixed(0) + '‚Ç∫' } },
                        y: { grid: { display: false }, ticks: { color: '#888', font: { size: 9 } } }
                    }
                }
            });
        }

        // Kar Marjƒ± Hedefine G√∂re Stok Gereksinimleri
        function drawStokGereksinimChart(hedef) {
            const ctx = document.getElementById('stokGereksinimChart');
            if (!ctx) return;
            if (charts.stokGereksinim) charts.stokGereksinim.destroy();

            // Her √ºr√ºn i√ßin hedef kar marjƒ±na g√∂re ne kadar stok getirilmesi gerektiƒüini hesapla
            const stokGereksinimleri = data.urunler.map(u => {
                const m = parseFloat(u.birim_maliyet) || 0;
                const f = parseFloat(u.satis_fiyati) || 0;
                const stok = parseInt(u.stok_miktari) || 0;
                const mevcutKar = f > 0 ? ((f - m) / f * 100) : 0;
                
                // Hedefin √ºst√ºndeyse stok artƒ±rƒ±lmalƒ±, altƒ±ndaysa stoƒüu azalt
                let gerekliStok = stok;
                let oneri = '';
                let renk = '#6b7280';
                
                if (mevcutKar >= hedef) {
                    // Karlƒ± √ºr√ºn - daha fazla stok al (kar marjƒ± ne kadar y√ºksekse o kadar √ßok)
                    const karFazlasi = mevcutKar - hedef;
                    const carpan = 1 + (karFazlasi / 50); // Her %50 fazla kar i√ßin 2x stok
                    gerekliStok = Math.round(stok * carpan);
                    oneri = '+' + (gerekliStok - stok);
                    renk = '#10b981'; // Ye≈üil
                } else {
                    // Riskli √ºr√ºn - stoƒüu azalt veya zam yap
                    const karEksigi = hedef - mevcutKar;
                    const carpan = Math.max(0.3, 1 - (karEksigi / 50));
                    gerekliStok = Math.round(stok * carpan);
                    oneri = (gerekliStok - stok).toString();
                    renk = '#ef4444'; // Kƒ±rmƒ±zƒ±
                }
                
                return {
                    adi: u.urun_adi,
                    mevcutStok: stok,
                    gerekliStok,
                    fark: gerekliStok - stok,
                    mevcutKar,
                    renk
                };
            }).sort((a, b) => Math.abs(b.fark) - Math.abs(a.fark)).slice(0, 6);

            charts.stokGereksinim = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: stokGereksinimleri.map(u => u.adi.length > 10 ? u.adi.substring(0, 8) + '...' : u.adi),
                    datasets: [
                        {
                            label: 'Mevcut Stok',
                            data: stokGereksinimleri.map(u => u.mevcutStok),
                            backgroundColor: 'rgba(107, 114, 128, 0.5)',
                            borderRadius: 4
                        },
                        {
                            label: '√ñnerilen Stok',
                            data: stokGereksinimleri.map(u => u.gerekliStok),
                            backgroundColor: stokGereksinimleri.map(u => u.renk + 'CC'),
                            borderRadius: 4
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { 
                        legend: { labels: { color: '#888', font: { size: 9 } } },
                        tooltip: {
                            callbacks: {
                                afterLabel: (ctx) => {
                                    const item = stokGereksinimleri[ctx.dataIndex];
                                    return [`Kar Marjƒ±: %${item.mevcutKar.toFixed(1)}`, `Fark: ${item.fark > 0 ? '+' : ''}${item.fark} adet`];
                                }
                            }
                        }
                    },
                    scales: {
                        y: { grid: { color: '#2a2a4a' }, ticks: { color: '#666' } },
                        x: { grid: { display: false }, ticks: { color: '#888', font: { size: 8 } } }
                    }
                }
            });
        }

        // Hammadde Bazlƒ± Kar Fƒ±rsatlarƒ± - Kategoriye g√∂re hammadde maliyeti ve kar potansiyeli
        // Hammadde Bazlƒ± Kar Fƒ±rsatlarƒ± - Kategoriye g√∂re mevcut kar ve stok deƒüeri
        function drawHammaddeKarChart(hedef) {
            const ctx = document.getElementById('hammaddeKarChart');
            if (!ctx) return;
            if (charts.hammaddeKar) charts.hammaddeKar.destroy();

            // Hammadde t√ºrlerini kategoriden √ßƒ±kar
            const hammaddeler = {
                'Pamuk': { toplamKar: 0, urunSayisi: 0, stokDegeri: 0, icon: 'üßµ' },
                'Polyester': { toplamKar: 0, urunSayisi: 0, stokDegeri: 0, icon: 'üî∑' },
                'Keten': { toplamKar: 0, urunSayisi: 0, stokDegeri: 0, icon: 'üåæ' },
                'ƒ∞pek': { toplamKar: 0, urunSayisi: 0, stokDegeri: 0, icon: '‚ú®' },
                'Y√ºn': { toplamKar: 0, urunSayisi: 0, stokDegeri: 0, icon: 'üêë' },
                'Denim': { toplamKar: 0, urunSayisi: 0, stokDegeri: 0, icon: 'üëñ' }
            };

            // √úr√ºnleri hammadde kategorilerine daƒüƒ±t
            data.urunler.forEach(u => {
                const m = parseFloat(u.birim_maliyet) || 0;
                const f = parseFloat(u.satis_fiyati) || 0;
                const stok = parseInt(u.stok_miktari) || 0;
                const karTL = (f - m) * stok; // Mevcut toplam kar
                const stokDegeri = f * stok;
                
                const kat = u.kategori_adi?.toLowerCase() || u.urun_adi.toLowerCase();
                let hammadde = 'Pamuk'; // varsayƒ±lan
                
                if (kat.includes('kot') || kat.includes('jean') || kat.includes('denim')) hammadde = 'Denim';
                else if (kat.includes('ipek') || kat.includes('silk')) hammadde = 'ƒ∞pek';
                else if (kat.includes('keten') || kat.includes('linen')) hammadde = 'Keten';
                else if (kat.includes('y√ºn') || kat.includes('wool') || kat.includes('kazak')) hammadde = 'Y√ºn';
                else if (kat.includes('polyester') || kat.includes('spor') || kat.includes('mayo')) hammadde = 'Polyester';
                
                hammaddeler[hammadde].toplamKar += karTL;
                hammaddeler[hammadde].urunSayisi++;
                hammaddeler[hammadde].stokDegeri += stokDegeri;
            });

            // Aktif hammaddeleri al ve stok deƒüerine g√∂re sƒ±rala
            let aktifHammaddeler = Object.entries(hammaddeler)
                .filter(([_, v]) => v.urunSayisi > 0)
                .sort((a, b) => b[1].stokDegeri - a[1].stokDegeri);

            // Eƒüer hi√ß aktif hammadde yoksa varsayƒ±lan deƒüerlerle g√∂ster
            if (aktifHammaddeler.length === 0) {
                aktifHammaddeler = [
                    ['Pamuk', { toplamKar: 15000, urunSayisi: 5, stokDegeri: 45000, icon: 'üßµ' }],
                    ['Polyester', { toplamKar: 8000, urunSayisi: 3, stokDegeri: 25000, icon: 'üî∑' }],
                    ['Denim', { toplamKar: 12000, urunSayisi: 4, stokDegeri: 35000, icon: 'üëñ' }]
                ];
            }

            charts.hammaddeKar = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: aktifHammaddeler.map(([h, v]) => v.icon + ' ' + h),
                    datasets: [{
                        label: 'Stok Deƒüeri (‚Ç∫)',
                        data: aktifHammaddeler.map(([_, v]) => v.stokDegeri),
                        backgroundColor: ['#10b981', '#3b82f6', '#f59e0b', '#8b5cf6', '#ec4899', '#6366f1'],
                        borderRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { 
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                afterLabel: (ctx) => {
                                    const item = aktifHammaddeler[ctx.dataIndex][1];
                                    return [`√úr√ºn: ${item.urunSayisi} adet`, `Toplam Kar: ${(item.toplamKar/1000).toFixed(1)}K‚Ç∫`];
                                }
                            }
                        }
                    },
                    scales: {
                        y: { grid: { color: '#2a2a4a' }, ticks: { color: '#666', callback: v => (v/1000).toFixed(0) + 'K‚Ç∫' } },
                        x: { grid: { display: false }, ticks: { color: '#888', font: { size: 10 } } }
                    }
                }
            });
        }

        function drawAylikGelirChart() {
            const ctx = document.getElementById('aylikGelirChart');
            if (!ctx) return;
            if (charts.aylikGelir) charts.aylikGelir.destroy();

            // Aylƒ±k satƒ±≈ü projeksiyonu (yaz sezonu odaklƒ±)
            const aylar = ['Oca', '≈ûub', 'Mar', 'Nis', 'May', 'Haz', 'Tem', 'Aƒüu'];
            const katsayilar = [0.6, 0.7, 0.85, 0.95, 1.1, 1.3, 1.4, 1.25]; // Yaz aylarƒ±nda artƒ±≈ü

            const toplamGelir = data.urunler.reduce((sum, u) => {
                const f = parseFloat(u.satis_fiyati) || 0;
                const stok = parseInt(u.stok_miktari) || 0;
                return sum + (f * stok * 0.1); // Aylƒ±k %10 satƒ±≈ü varsayƒ±mƒ±
            }, 0);

            const aylikGelirler = katsayilar.map(k => toplamGelir * k);

            charts.aylikGelir = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: aylar,
                    datasets: [{
                        label: 'Tahmini Gelir',
                        data: aylikGelirler,
                        borderColor: '#00d4ff',
                        backgroundColor: 'rgba(0, 212, 255, 0.1)',
                        fill: true,
                        tension: 0.4,
                        pointRadius: 5,
                        pointBackgroundColor: '#00d4ff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: { grid: { color: '#2a2a4a' }, ticks: { color: '#666', callback: v => (v/1000).toFixed(0) + 'K‚Ç∫' } },
                        x: { grid: { display: false }, ticks: { color: '#888' } }
                    }
                }
            });
        }

        // Hammadde ƒ∞htiyacƒ± - Yaz sezonu i√ßin gereken hammadde miktarƒ± (kg)
        function drawHammaddeIhtiyacChart(hedef) {
            const ctx = document.getElementById('hammaddeIhtiyacChart');
            if (!ctx) return;
            if (charts.hammaddeIhtiyac) charts.hammaddeIhtiyac.destroy();

            // Hammadde t√ºrleri ve ortalama kg/√ºr√ºn deƒüerleri
            const hammaddeBilgi = {
                'Pamuk': { kgPerUrun: 0.35, renk: '#ffffff', icon: 'üßµ' },      // Beyaz
                'Polyester': { kgPerUrun: 0.25, renk: '#06b6d4', icon: 'üî∑' },  // Cyan/Turkuaz
                'Keten': { kgPerUrun: 0.40, renk: '#84cc16', icon: 'üåæ' },      // Lime Ye≈üil
                'Denim': { kgPerUrun: 0.55, renk: '#1e3a8a', icon: 'üëñ' },      // Koyu Mavi (Kot rengi)
                'ƒ∞pek': { kgPerUrun: 0.15, renk: '#fbbf24', icon: '‚ú®' },       // Altƒ±n Sarƒ±sƒ±
                'Y√ºn': { kgPerUrun: 0.45, renk: '#a3a3a3', icon: 'üêë' }         // Gri (Y√ºn rengi)
            };

            // Her hammadde i√ßin toplam ihtiya√ß hesapla
            const ihtiyaclar = {
                'Pamuk': { kg: 0, urunSayisi: 0 },
                'Polyester': { kg: 0, urunSayisi: 0 },
                'Keten': { kg: 0, urunSayisi: 0 },
                'Denim': { kg: 0, urunSayisi: 0 },
                'ƒ∞pek': { kg: 0, urunSayisi: 0 },
                'Y√ºn': { kg: 0, urunSayisi: 0 }
            };

            // √úr√ºnleri hammadde kategorilerine daƒüƒ±t ve stok miktarƒ±na g√∂re kg hesapla
            data.urunler.forEach(u => {
                const stok = parseInt(u.stok_miktari) || 0;
                const kat = u.kategori_adi?.toLowerCase() || u.urun_adi.toLowerCase();
                let hammadde = 'Pamuk'; // varsayƒ±lan
                
                if (kat.includes('kot') || kat.includes('jean') || kat.includes('denim')) hammadde = 'Denim';
                else if (kat.includes('ipek') || kat.includes('silk')) hammadde = 'ƒ∞pek';
                else if (kat.includes('keten') || kat.includes('linen')) hammadde = 'Keten';
                else if (kat.includes('y√ºn') || kat.includes('wool') || kat.includes('kazak')) hammadde = 'Y√ºn';
                else if (kat.includes('polyester') || kat.includes('spor') || kat.includes('mayo')) hammadde = 'Polyester';
                
                const kgIhtiyac = stok * hammaddeBilgi[hammadde].kgPerUrun;
                ihtiyaclar[hammadde].kg += kgIhtiyac;
                ihtiyaclar[hammadde].urunSayisi += stok;
            });

            // Aktif hammaddeleri al ve kg'a g√∂re sƒ±rala
            let aktifHammaddeler = Object.entries(ihtiyaclar)
                .filter(([_, v]) => v.kg > 0)
                .map(([h, v]) => ({
                    adi: h,
                    kg: v.kg,
                    urunSayisi: v.urunSayisi,
                    ...hammaddeBilgi[h]
                }))
                .sort((a, b) => b.kg - a.kg);

            // Eƒüer veri yoksa varsayƒ±lan deƒüerler
            if (aktifHammaddeler.length === 0) {
                aktifHammaddeler = [
                    { adi: 'Pamuk', kg: 175, urunSayisi: 500, renk: '#ffffff', icon: 'üßµ', kgPerUrun: 0.35 },
                    { adi: 'Polyester', kg: 75, urunSayisi: 300, renk: '#06b6d4', icon: 'üî∑', kgPerUrun: 0.25 },
                    { adi: 'Denim', kg: 110, urunSayisi: 200, renk: '#1e3a8a', icon: 'üëñ', kgPerUrun: 0.55 },
                    { adi: 'Keten', kg: 40, urunSayisi: 100, renk: '#84cc16', icon: 'üåæ', kgPerUrun: 0.40 }
                ];
            }

            // Toplam hammadde ihtiyacƒ±
            const toplamKg = aktifHammaddeler.reduce((sum, h) => sum + h.kg, 0);

            charts.hammaddeIhtiyac = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: aktifHammaddeler.map(h => h.icon + ' ' + h.adi),
                    datasets: [{
                        data: aktifHammaddeler.map(h => h.kg),
                        backgroundColor: aktifHammaddeler.map(h => h.renk),
                        borderWidth: 2,
                        borderColor: '#1a1a2e'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '55%',
                    plugins: { 
                        legend: { 
                            position: 'right', 
                            labels: { color: '#888', font: { size: 9 }, padding: 8 } 
                        },
                        tooltip: {
                            callbacks: {
                                label: (ctx) => {
                                    const h = aktifHammaddeler[ctx.dataIndex];
                                    const yuzde = (h.kg / toplamKg * 100).toFixed(1);
                                    return [`${h.kg.toFixed(1)} kg (%${yuzde})`, `${h.urunSayisi} adet √ºr√ºn`];
                                }
                            }
                        }
                    }
                }
            });
        }

        // Hammadde Maliyet Analizi - Giysi hammaddelerinin maliyet daƒüƒ±lƒ±mƒ±
        function drawHammaddeMaliyetChart(hedef) {
            const ctx = document.getElementById('hammaddeMaliyetChart');
            if (!ctx) return;
            if (charts.hammaddeMaliyet) charts.hammaddeMaliyet.destroy();

            // Yaz sezonu hammadde maliyetleri (tahmini deƒüerler)
            const hammaddeler = [
                { adi: 'Pamuk', yuzde: 35, fiyat: 85, trend: '+12%', renk: '#10b981', icon: 'üßµ' },
                { adi: 'Polyester', yuzde: 25, fiyat: 45, trend: '+5%', renk: '#3b82f6', icon: 'üî∑' },
                { adi: 'Keten', yuzde: 15, fiyat: 120, trend: '+18%', renk: '#f59e0b', icon: 'üåæ' },
                { adi: 'Denim', yuzde: 12, fiyat: 95, trend: '+8%', renk: '#6366f1', icon: 'üëñ' },
                { adi: 'ƒ∞pek', yuzde: 8, fiyat: 250, trend: '+22%', renk: '#ec4899', icon: '‚ú®' },
                { adi: 'Y√ºn', yuzde: 5, fiyat: 180, trend: '-3%', renk: '#8b5cf6', icon: 'üêë' }
            ];

            // √úr√ºnlerden ger√ßek maliyet verisi √ßek
            let toplamMaliyet = 0;
            data.urunler.forEach(u => {
                toplamMaliyet += parseFloat(u.birim_maliyet) || 0;
            });
            const ortMaliyet = data.urunler.length > 0 ? toplamMaliyet / data.urunler.length : 100;

            // Hammadde maliyetlerini ger√ßek verilere g√∂re ayarla
            hammaddeler.forEach(h => {
                h.hesaplananMaliyet = (ortMaliyet * h.yuzde / 100).toFixed(0);
            });

            charts.hammaddeMaliyet = new Chart(ctx, {
                type: 'polarArea',
                data: {
                    labels: hammaddeler.map(h => h.icon + ' ' + h.adi),
                    datasets: [{
                        data: hammaddeler.map(h => h.yuzde),
                        backgroundColor: hammaddeler.map(h => h.renk + 'CC'),
                        borderColor: hammaddeler.map(h => h.renk),
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { 
                        legend: { 
                            position: 'right', 
                            labels: { color: '#888', font: { size: 9 }, padding: 6 } 
                        },
                        tooltip: {
                            callbacks: {
                                label: (ctx) => {
                                    const h = hammaddeler[ctx.dataIndex];
                                    return [`Kullanƒ±m: %${h.yuzde}`, `Birim Fiyat: ${h.fiyat}‚Ç∫/kg`, `Trend: ${h.trend}`];
                                }
                            }
                        }
                    },
                    scales: {
                        r: { 
                            grid: { color: '#2a2a4a' }, 
                            ticks: { display: false },
                            pointLabels: { display: false }
                        }
                    }
                }
            });
        }

        // Yaz Mevsimi Karar Matrisi
        function drawYazKararChart(hedef) {
            const ctx = document.getElementById('yazKararChart');
            if (!ctx) return;
            if (charts.yazKarar) charts.yazKarar.destroy();

            // √úr√ºnleri kar ve stok durumuna g√∂re kategorize et
            let zamYap = 0, stokAl = 0, satisArttir = 0, koru = 0;
            
            data.urunler.forEach(u => {
                const m = parseFloat(u.birim_maliyet) || 0;
                const f = parseFloat(u.satis_fiyati) || 0;
                const stok = parseInt(u.stok_miktari) || 0;
                const kar = f > 0 ? ((f - m) / f * 100) : 0;
                
                if (kar < hedef && stok > 50) zamYap++;
                else if (kar >= hedef && stok < 30) stokAl++;
                else if (kar < hedef && stok < 30) satisArttir++;
                else koru++;
            });

            charts.yazKarar = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['üî∫ Zam Yap', 'üì¶ Stok Al', 'üì¢ Satƒ±≈ü Arttƒ±r', '‚úÖ Koru'],
                    datasets: [{
                        data: [zamYap, stokAl, satisArttir, koru],
                        backgroundColor: ['#ef4444', '#3b82f6', '#f59e0b', '#10b981'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '50%',
                    plugins: { 
                        legend: { position: 'bottom', labels: { color: '#888', padding: 10, font: { size: 9 } } }
                    }
                }
            });
        }

        // Hedefe Ula≈üƒ±m ƒ∞lerlemesi
        function drawHedefIlerlemeChart(hedef) {
            const ctx = document.getElementById('hedefIlerlemeChart');
            if (!ctx) return;
            if (charts.hedefIlerleme) charts.hedefIlerleme.destroy();

            // Her kategorinin hedefe ne kadar yakƒ±n olduƒüunu g√∂ster
            const kategoriData = {};
            data.urunler.forEach(u => {
                const kategori = u.kategori_adi || 'Diƒüer';
                const m = parseFloat(u.birim_maliyet) || 0;
                const f = parseFloat(u.satis_fiyati) || 0;
                const kar = f > 0 ? ((f - m) / f * 100) : 0;
                
                if (!kategoriData[kategori]) {
                    kategoriData[kategori] = { toplam: 0, adet: 0 };
                }
                kategoriData[kategori].toplam += kar;
                kategoriData[kategori].adet++;
            });

            const kategoriler = Object.keys(kategoriData);
            const ilerlemeler = kategoriler.map(k => {
                const ort = kategoriData[k].toplam / kategoriData[k].adet;
                return Math.min(100, (ort / hedef) * 100);
            });

            charts.hedefIlerleme = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: kategoriler.map(k => k.length > 12 ? k.substring(0, 10) + '...' : k),
                    datasets: [{
                        label: 'Hedefe Ula≈üƒ±m %',
                        data: ilerlemeler,
                        backgroundColor: ilerlemeler.map(i => i >= 100 ? '#10b981' : i >= 80 ? '#f59e0b' : '#ef4444'),
                        borderRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: { 
                            grid: { color: '#2a2a4a' }, 
                            ticks: { color: '#666', callback: v => '%' + v },
                            max: 120
                        },
                        x: { grid: { display: false }, ticks: { color: '#888', font: { size: 9 }, maxRotation: 45 } }
                    }
                }
            });
        }

        // Sezon Hazƒ±rlƒ±k Durumu
        function drawSezonHazirlikChart(hedef) {
            const ctx = document.getElementById('sezonHazirlikChart');
            if (!ctx) return;
            if (charts.sezonHazirlik) charts.sezonHazirlik.destroy();

            // Yaz sezonu i√ßin hazƒ±rlƒ±k metrikleri
            let toplam = data.urunler.length;
            let karHedefinde = 0, stokYeterli = 0, fiyatRekabetci = 0;

            data.urunler.forEach(u => {
                const m = parseFloat(u.birim_maliyet) || 0;
                const f = parseFloat(u.satis_fiyati) || 0;
                const stok = parseInt(u.stok_miktari) || 0;
                const kar = f > 0 ? ((f - m) / f * 100) : 0;
                
                if (kar >= hedef) karHedefinde++;
                if (stok >= 20) stokYeterli++;
                
                // Rakip fiyat kontrol√º
                const rakipler = data.rakipler.filter(r => r.urun_id === u.urun_id);
                if (rakipler.length > 0) {
                    const ortRakip = rakipler.reduce((sum, r) => sum + parseFloat(r.rakip_fiyat), 0) / rakipler.length;
                    if (f <= ortRakip * 1.1) fiyatRekabetci++;
                } else {
                    fiyatRekabetci++; // Rakip yoksa rekabet√ßi say
                }
            });

            charts.sezonHazirlik = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: ['Kar Hedefi', 'Stok Durumu', 'Fiyat Rekabeti'],
                    datasets: [{
                        label: 'Hazƒ±rlƒ±k %',
                        data: [
                            (karHedefinde / toplam * 100).toFixed(0),
                            (stokYeterli / toplam * 100).toFixed(0),
                            (fiyatRekabetci / toplam * 100).toFixed(0)
                        ],
                        backgroundColor: 'rgba(0, 212, 255, 0.2)',
                        borderColor: '#00d4ff',
                        borderWidth: 2,
                        pointBackgroundColor: '#00d4ff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        r: {
                            beginAtZero: true,
                            max: 100,
                            grid: { color: '#2a2a4a' },
                            angleLines: { color: '#2a2a4a' },
                            pointLabels: { color: '#888', font: { size: 9 } },
                            ticks: { display: false }
                        }
                    }
                }
            });
        }

        // Yaz Sezonu Sim√ºlasyon - Backend API Kullanarak (Stored Procedure)
        async function runYazSimulasyon() {
            const dolar = parseFloat(document.getElementById('simDolar').value);
            const pamuk = parseFloat(document.getElementById('simPamuk').value);
            const lojistik = parseFloat(document.getElementById('simLojistik').value);
            const enflasyon = parseFloat(document.getElementById('simEnflasyon').value);

            // Slider deƒüerlerini g√∂ster
            document.getElementById('simDolarVal').textContent = dolar.toFixed(2);
            document.getElementById('simPamukVal').textContent = pamuk.toFixed(0);
            document.getElementById('simLojistikVal').textContent = lojistik.toFixed(0);
            document.getElementById('simEnflasyonVal').textContent = enflasyon.toFixed(0);

            // Oran hesapla (baz deƒüerlere g√∂re)
            const dolarOran = dolar / data.base.dolar;
            const pamukOran = pamuk / data.base.pamuk;
            const lojistikOran = lojistik / data.base.lojistik;
            const enflasyonOran = enflasyon / data.base.enflasyon;

            // Deƒüi≈üim y√ºzdeleri
            const dolarDegisim = ((dolarOran - 1) * 100).toFixed(1);
            const pamukDegisim = ((pamukOran - 1) * 100).toFixed(1);

            try {
                // Backend API'ye istek at (Stored Procedure √ßaƒürƒ±sƒ±)
                const response = await fetch('/api/simulasyon', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ dolarOran, pamukOran, lojistikOran, enflasyonOran })
                });

                const result = await response.json();

                if (!result.success) {
                    console.error('Sim√ºlasyon hatasƒ±:', result.error);
                    return;
                }

                // Sonu√ßlarƒ± i≈üle
                renderYazSimulasyonSonuclari(result.data, result.ozet, dolarDegisim, pamukDegisim);

            } catch (error) {
                console.error('API hatasƒ±:', error);
            }
        }

        function renderYazSimulasyonSonuclari(urunler, ozet, dolarDegisim, pamukDegisim) {
            // √ñzet kartlarƒ± g√ºncelle
            document.getElementById('simKar').textContent = '%' + ozet.ortalama_kar_marji;
            document.getElementById('simKritik').textContent = ozet.kritik_sayisi;
            document.getElementById('simRiskli').textContent = ozet.riskli_sayisi;
            document.getElementById('simZam').textContent = ozet.toplam_zam_gereksinimi > 0 ? '+' + parseFloat(ozet.toplam_zam_gereksinimi).toFixed(0) + '‚Ç∫' : '0‚Ç∫';

            // Kart renklerini g√ºncelle
            document.getElementById('kartKritik').className = 'stat-card' + (ozet.kritik_sayisi > 0 ? ' danger' : '');
            document.getElementById('kartRisk').className = 'stat-card' + (ozet.riskli_sayisi > 0 ? ' warning' : '');

            // √úr√ºn kartlarƒ±nƒ± olu≈ütur
            const cardsContainer = document.getElementById('productCards');
            cardsContainer.innerHTML = urunler.map(u => {
                const riskClass = u.risk_durumu === 'KRƒ∞Tƒ∞K' ? 'risk-kritik' : 
                                  u.risk_durumu === 'Rƒ∞SK' ? 'risk-risk' : 'risk-guvenli';
                const badgeClass = u.risk_durumu === 'KRƒ∞Tƒ∞K' ? 'badge-kritik' : 
                                   u.risk_durumu === 'Rƒ∞SK' ? 'badge-risk' : 'badge-guvenli';
                
                const rekabetClass = u.rekabet_durumu === 'REKABET G√úC√ú D√ú≈û√úK' ? 'rekabet-dusuk' :
                                     u.rekabet_durumu === 'REKABET AVANTAJI' ? 'rekabet-avantaj' : 'rekabet-ortalama';

                const mevcutKar = parseFloat(u.mevcut_kar_marji);
                const yeniKar = parseFloat(u.yeni_kar_marji);
                const karFark = yeniKar - mevcutKar;
                const gerekZam = parseFloat(u.gereken_zam);
                
                // Kar deƒüi≈üim rengi ve ikon
                const karDegisimRenk = karFark >= 0 ? '#10b981' : '#ef4444';
                const karDegisimIcon = karFark >= 0 ? 'üìà' : 'üìâ';

                return `
                    <div class="product-card ${riskClass}">
                        <div class="product-card-header">
                            <div>
                                <div class="product-card-name">${u.urun_adi}</div>
                                <div class="product-card-category">${u.kategori_adi}</div>
                            </div>
                            <span class="product-card-badge ${badgeClass}">${u.risk_durumu}</span>
                        </div>
                        
                        <!-- Kar Marjƒ± Deƒüi≈üimi - Ana G√∂rsel -->
                        <div class="product-card-arrow">
                            <div class="arrow-from">%${mevcutKar.toFixed(1)}</div>
                            <div class="arrow-icon">${karDegisimIcon} ‚Üí</div>
                            <div class="arrow-to" style="color: ${u.risk_durumu === 'KRƒ∞Tƒ∞K' ? '#ef4444' : u.risk_durumu === 'Rƒ∞SK' ? '#f59e0b' : '#10b981'};">%${yeniKar.toFixed(1)}</div>
                        </div>

                        <div class="product-card-stats">
                            <div class="product-stat">
                                <div class="product-stat-icon">üí∞</div>
                                <div class="product-stat-value" style="color: #00d4ff;">${parseFloat(u.satis_fiyati).toFixed(0)}‚Ç∫</div>
                                <div class="product-stat-label">Satƒ±≈ü Fiyatƒ±</div>
                            </div>
                            <div class="product-stat">
                                <div class="product-stat-icon">üì¶</div>
                                <div class="product-stat-value" style="color: #888;">${parseFloat(u.mevcut_maliyet).toFixed(0)}‚Ç∫</div>
                                <div class="product-stat-label">Maliyet</div>
                            </div>
                        </div>

                        ${gerekZam > 0 ? `
                        <div class="product-card-action">
                            <div class="action-label">üí° Hedef i√ßin gereken zam</div>
                            <div class="action-value" style="color: #f59e0b;">
                                <span>+${gerekZam.toFixed(0)}‚Ç∫</span>
                                <span style="font-size: 0.7em; color: #888;">‚Üí ${(parseFloat(u.satis_fiyati) + gerekZam).toFixed(0)}‚Ç∫ yeni fiyat</span>
                            </div>
                        </div>
                        ` : `
                        <div class="product-card-action">
                            <div class="action-label">‚úÖ Durum</div>
                            <div class="action-value" style="color: #10b981;">Hedef √úst√ºnde - Zam Gerekmiyor</div>
                        </div>
                        `}

                        ${u.ortalama_rakip_fiyat ? `<div class="product-card-rekabet ${rekabetClass}">${u.rekabet_durumu} (Rakip: ${parseFloat(u.ortalama_rakip_fiyat).toFixed(0)}‚Ç∫)</div>` : ''}
                        
                        ${u.risk_durumu === 'KRƒ∞Tƒ∞K' ? `<div class="product-card-warning">üö® ${u.stratejik_oneri}</div>` : ''}
                    </div>
                `;
            }).join('');

            // Tabloyu g√ºncelle
            const tbody = document.getElementById('simBody');
            tbody.innerHTML = urunler.map(u => {
                const rowClass = u.risk_durumu === 'KRƒ∞Tƒ∞K' ? 'row-critical' : u.risk_durumu === 'Rƒ∞SK' ? 'row-warning' : '';
                const rekabetClass = u.rekabet_durumu === 'REKABET G√úC√ú D√ú≈û√úK' ? 'color: #ef4444;' :
                                     u.rekabet_durumu === 'REKABET AVANTAJI' ? 'color: #10b981;' : 'color: #3b82f6;';
                
                return `
                    <tr class="${rowClass}">
                        <td><strong>${u.urun_adi}</strong></td>
                        <td>${u.kategori_adi}</td>
                        <td>%${parseFloat(u.mevcut_kar_marji).toFixed(1)}</td>
                        <td style="color: ${u.risk_durumu === 'KRƒ∞Tƒ∞K' ? '#ef4444' : u.risk_durumu === 'Rƒ∞SK' ? '#f59e0b' : '#10b981'}; font-weight: 600;">%${parseFloat(u.yeni_kar_marji).toFixed(1)}</td>
                        <td>${u.ortalama_rakip_fiyat ? parseFloat(u.ortalama_rakip_fiyat).toFixed(0) + '‚Ç∫' : '-'}</td>
                        <td style="${rekabetClass}">${u.rekabet_durumu}</td>
                        <td><span class="badge ${u.risk_durumu === 'KRƒ∞Tƒ∞K' ? 'badge-critical' : u.risk_durumu === 'Rƒ∞SK' ? 'badge-danger' : 'badge-success'}">${u.risk_durumu}</span></td>
                        <td style="font-size: 0.85em;">${u.stratejik_oneri}</td>
                    </tr>
                `;
            }).join('');

            // Kayƒ±t sayƒ±sƒ±nƒ± g√ºncelle
            document.getElementById('tableRecordCount').textContent = `(${urunler.length} kayƒ±t)`;

            // Grafikleri √ßiz
            drawYazSimCharts(urunler, ozet);

            // Bildirimleri g√ºncelle
            updateYazNotifications(urunler, ozet, dolarDegisim, pamukDegisim);

            // Sonu√ß metnini g√ºncelle
            updateYazConclusion(urunler, ozet, dolarDegisim, pamukDegisim);
        }

        function drawYazSimCharts(urunler, ozet) {
            // Kar Marjƒ± Kar≈üƒ±la≈ütƒ±rma Grafiƒüi
            const ctx1 = document.getElementById('simKarChart');
            if (charts.simKar) charts.simKar.destroy();

            charts.simKar = new Chart(ctx1, {
                type: 'bar',
                data: {
                    labels: urunler.map(u => u.urun_adi.length > 12 ? u.urun_adi.substring(0, 10) + '...' : u.urun_adi),
                    datasets: [
                        {
                            label: 'Mevcut Kar %',
                            data: urunler.map(u => parseFloat(u.mevcut_kar_marji)),
                            backgroundColor: 'rgba(136, 136, 136, 0.6)',
                            borderRadius: 4
                        },
                        {
                            label: 'Sim√ºle Kar %',
                            data: urunler.map(u => parseFloat(u.yeni_kar_marji)),
                            backgroundColor: urunler.map(u => {
                                if (u.risk_durumu === 'KRƒ∞Tƒ∞K') return 'rgba(239, 68, 68, 0.8)';
                                if (u.risk_durumu === 'Rƒ∞SK') return 'rgba(245, 158, 11, 0.8)';
                                return 'rgba(16, 185, 129, 0.8)';
                            }),
                            borderRadius: 4
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { labels: { color: '#888' } }
                    },
                    scales: {
                        x: { grid: { display: false }, ticks: { color: '#888', maxRotation: 45, font: { size: 9 } } },
                        y: { grid: { color: '#2a2a4a' }, ticks: { color: '#888', callback: v => '%' + v }, min: 0, max: 80 }
                    }
                }
            });

            // Risk Daƒüƒ±lƒ±mƒ± Grafiƒüi
            const ctx2 = document.getElementById('simRiskChart');
            if (charts.simRisk) charts.simRisk.destroy();

            charts.simRisk = new Chart(ctx2, {
                type: 'doughnut',
                data: {
                    labels: ['Kritik', 'Riskli', 'G√ºvenli'],
                    datasets: [{
                        data: [ozet.kritik_sayisi, ozet.riskli_sayisi, ozet.guvenli_sayisi],
                        backgroundColor: ['#ef4444', '#f59e0b', '#10b981'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'bottom', labels: { color: '#888', padding: 20 } }
                    },
                    cutout: '60%'
                }
            });

            // 3. Maliyet Artƒ±≈ü Oranlarƒ± Grafiƒüi
            const ctx3 = document.getElementById('simMaliyetArtisChart');
            if (charts.simMaliyetArtis) charts.simMaliyetArtis.destroy();

            const maliyetArtislari = urunler.map(u => {
                const mevcut = parseFloat(u.mevcut_maliyet) || 0;
                const simule = parseFloat(u.simule_maliyet) || mevcut;
                return mevcut > 0 ? ((simule - mevcut) / mevcut * 100) : 0;
            });

            charts.simMaliyetArtis = new Chart(ctx3, {
                type: 'bar',
                data: {
                    labels: urunler.map(u => u.urun_adi.length > 10 ? u.urun_adi.substring(0, 8) + '...' : u.urun_adi),
                    datasets: [{
                        label: 'Maliyet Artƒ±≈üƒ± %',
                        data: maliyetArtislari,
                        backgroundColor: maliyetArtislari.map(v => v > 15 ? '#ef4444' : v > 8 ? '#f59e0b' : '#3b82f6'),
                        borderRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    indexAxis: 'y',
                    plugins: { legend: { display: false } },
                    scales: {
                        x: { grid: { color: '#2a2a4a' }, ticks: { color: '#888', callback: v => '%' + v } },
                        y: { grid: { display: false }, ticks: { color: '#888', font: { size: 9 } } }
                    }
                }
            });

            // 4. Kategori Bazlƒ± Ortalama Kar Grafiƒüi
            const ctx4 = document.getElementById('simKategoriKarChart');
            if (charts.simKategoriKar) charts.simKategoriKar.destroy();

            const kategoriKarlar = {};
            urunler.forEach(u => {
                const kategori = u.kategori_adi || 'Diƒüer';
                if (!kategoriKarlar[kategori]) {
                    kategoriKarlar[kategori] = { total: 0, count: 0 };
                }
                kategoriKarlar[kategori].total += parseFloat(u.yeni_kar_marji) || 0;
                kategoriKarlar[kategori].count++;
            });

            const kategoriLabels = Object.keys(kategoriKarlar);
            const kategoriAvg = kategoriLabels.map(k => kategoriKarlar[k].total / kategoriKarlar[k].count);

            charts.simKategoriKar = new Chart(ctx4, {
                type: 'bar',
                data: {
                    labels: kategoriLabels,
                    datasets: [{
                        label: 'Ort. Kar Marjƒ± %',
                        data: kategoriAvg,
                        backgroundColor: kategoriAvg.map(v => v >= 25 ? '#10b981' : v >= 15 ? '#f59e0b' : '#ef4444'),
                        borderRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        x: { grid: { display: false }, ticks: { color: '#888' } },
                        y: { grid: { color: '#2a2a4a' }, ticks: { color: '#888', callback: v => '%' + v }, min: 0, max: 60 }
                    }
                }
            });

            // 5. √ñnerilen Zam Tutarlarƒ± Grafiƒüi
            const ctx5 = document.getElementById('simZamChart');
            if (charts.simZam) charts.simZam.destroy();

            const zamGerekenler = urunler.filter(u => parseFloat(u.gereken_zam) > 0);
            
            charts.simZam = new Chart(ctx5, {
                type: 'bar',
                data: {
                    labels: zamGerekenler.map(u => u.urun_adi.length > 10 ? u.urun_adi.substring(0, 8) + '...' : u.urun_adi),
                    datasets: [{
                        label: '√ñnerilen Zam (‚Ç∫)',
                        data: zamGerekenler.map(u => parseFloat(u.gereken_zam)),
                        backgroundColor: zamGerekenler.map(u => {
                            const zam = parseFloat(u.gereken_zam);
                            return zam > 50 ? '#ef4444' : zam > 20 ? '#f59e0b' : '#00d4ff';
                        }),
                        borderRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        x: { grid: { display: false }, ticks: { color: '#888', maxRotation: 45, font: { size: 9 } } },
                        y: { grid: { color: '#2a2a4a' }, ticks: { color: '#888', callback: v => v + '‚Ç∫' } }
                    }
                }
            });

            // 6. Hedef vs Sim√ºle Kar Marjƒ± Grafiƒüi
            const ctx6 = document.getElementById('simHedefChart');
            if (charts.simHedef) charts.simHedef.destroy();

            const hedefKar = parseFloat(document.getElementById('simHedef')?.value) || 25;
            const simuleKarlar = urunler.map(u => parseFloat(u.yeni_kar_marji) || 0);
            const hedefLine = urunler.map(() => hedefKar);

            charts.simHedef = new Chart(ctx6, {
                type: 'line',
                data: {
                    labels: urunler.map(u => u.urun_adi.length > 8 ? u.urun_adi.substring(0, 6) + '...' : u.urun_adi),
                    datasets: [
                        {
                            label: 'Sim√ºle Kar %',
                            data: simuleKarlar,
                            borderColor: '#00d4ff',
                            backgroundColor: 'rgba(0, 212, 255, 0.1)',
                            fill: true,
                            tension: 0.3,
                            pointRadius: 4,
                            pointBackgroundColor: simuleKarlar.map(v => v >= hedefKar ? '#10b981' : '#ef4444')
                        },
                        {
                            label: 'Hedef %' + hedefKar,
                            data: hedefLine,
                            borderColor: '#f59e0b',
                            borderDash: [8, 4],
                            borderWidth: 2,
                            pointRadius: 0,
                            fill: false
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { labels: { color: '#888' } } },
                    scales: {
                        x: { grid: { display: false }, ticks: { color: '#888', font: { size: 8 }, maxRotation: 45 } },
                        y: { grid: { color: '#2a2a4a' }, ticks: { color: '#888', callback: v => '%' + v }, min: 0, max: 60 }
                    }
                }
            });

            // Y√∂netici √∂nerilerini g√ºncelle
            updateSimRecommendations(urunler, ozet, kategoriKarlar, zamGerekenler, maliyetArtislari, hedefKar);
        }

        // Ne Olur Analizi - Yaz 2026 Stratejik √ñneriler
        function updateSimRecommendations(urunler, ozet, kategoriKarlar, zamGerekenler, maliyetArtislari, hedefKar) {
            const dolarDegisim = parseFloat(document.getElementById('simDolar')?.value) || 0;
            const pamukDegisim = parseFloat(document.getElementById('simPamuk')?.value) || 0;

            // 1. Kar Marjƒ± Kar≈üƒ±la≈ütƒ±rmasƒ± √ñnerisi
            const recSimKar = document.getElementById('rec-simKar');
            if (recSimKar) {
                const ortMevcutKar = urunler.reduce((sum, u) => sum + parseFloat(u.mevcut_kar_marji), 0) / urunler.length;
                const ortSimuleKar = urunler.reduce((sum, u) => sum + parseFloat(u.yeni_kar_marji), 0) / urunler.length;
                const karDususu = ortMevcutKar - ortSimuleKar;
                
                if (karDususu > 10) {
                    recSimKar.className = 'chart-recommendation danger';
                    recSimKar.textContent = `‚òÄÔ∏è YAZ 2026: Kritik! Kar marjƒ± %${karDususu.toFixed(1)} d√º≈üecek. ≈ûubat'a kadar tedarik√ßi anla≈ümasƒ± yenileyin.`;
                } else if (karDususu > 5) {
                    recSimKar.className = 'chart-recommendation warning';
                    recSimKar.textContent = `‚òÄÔ∏è YAZ 2026: Kar marjƒ± %${karDususu.toFixed(1)} d√º≈üecek. Mart'ta kademeli fiyat artƒ±≈üƒ± planlayƒ±n.`;
                } else {
                    recSimKar.className = 'chart-recommendation';
                    recSimKar.textContent = `‚òÄÔ∏è YAZ 2026: Kar marjƒ± stabil. Mevcut fiyatlandƒ±rmayla yaz sezonuna girin, pazarlamaya odaklanƒ±n.`;
                }
            }

            // 2. Risk Daƒüƒ±lƒ±mƒ± √ñnerisi
            const recSimRisk = document.getElementById('rec-simRisk');
            if (recSimRisk) {
                const toplamUrun = ozet.kritik_sayisi + ozet.riskli_sayisi + ozet.guvenli_sayisi;
                const riskOrani = ((ozet.kritik_sayisi + ozet.riskli_sayisi) / toplamUrun * 100);
                
                if (ozet.kritik_sayisi > 0) {
                    recSimRisk.className = 'chart-recommendation danger';
                    recSimRisk.textContent = `‚òÄÔ∏è YAZ 2026: ${ozet.kritik_sayisi} kritik √ºr√ºn var! Ocak'ta bu √ºr√ºnleri koleksiyondan √ßƒ±karƒ±n veya acil zam yapƒ±n.`;
                } else if (riskOrani > 30) {
                    recSimRisk.className = 'chart-recommendation warning';
                    recSimRisk.textContent = `‚òÄÔ∏è YAZ 2026: %${riskOrani.toFixed(0)} √ºr√ºn risk altƒ±nda. ≈ûubat sonuna kadar fiyat revizyonu tamamlayƒ±n.`;
                } else {
                    recSimRisk.className = 'chart-recommendation';
                    recSimRisk.textContent = `‚òÄÔ∏è YAZ 2026: %${(100-riskOrani).toFixed(0)} √ºr√ºn g√ºvenli. Haziran'da agresif satƒ±≈ü kampanyasƒ± ba≈ülatƒ±n.`;
                }
            }

            // 3. Maliyet Artƒ±≈ü Oranlarƒ± √ñnerisi
            const recSimMaliyet = document.getElementById('rec-simMaliyet');
            if (recSimMaliyet) {
                const ortMaliyetArtis = maliyetArtislari.reduce((a, b) => a + b, 0) / maliyetArtislari.length;
                const maxArtis = Math.max(...maliyetArtislari);
                
                if (maxArtis > 20) {
                    recSimMaliyet.className = 'chart-recommendation danger';
                    recSimMaliyet.textContent = `‚òÄÔ∏è YAZ 2026: Maliyet %${maxArtis.toFixed(0)}'e kadar artabilir! Ocak-≈ûubat'ta alternatif tedarik√ßi bulun.`;
                } else if (ortMaliyetArtis > 10) {
                    recSimMaliyet.className = 'chart-recommendation warning';
                    recSimMaliyet.textContent = `‚òÄÔ∏è YAZ 2026: Ort. maliyet %${ortMaliyetArtis.toFixed(1)} artacak. Mart'ta toplu hammadde alƒ±mƒ± yapƒ±n.`;
                } else {
                    recSimMaliyet.className = 'chart-recommendation';
                    recSimMaliyet.textContent = `‚òÄÔ∏è YAZ 2026: Maliyet artƒ±≈üƒ± kontrol altƒ±nda. Mevcut tedarik√ßilerle yaz s√∂zle≈ümesi imzalayƒ±n.`;
                }
            }

            // 4. Kategori Bazlƒ± Kar √ñnerisi
            const recSimKategori = document.getElementById('rec-simKategori');
            if (recSimKategori) {
                const kategoriList = Object.entries(kategoriKarlar).map(([k, v]) => ({
                    adi: k, 
                    ortKar: v.total / v.count
                })).sort((a, b) => a.ortKar - b.ortKar);
                
                const enDusuk = kategoriList[0];
                const enYuksek = kategoriList[kategoriList.length - 1];
                
                if (enDusuk && enDusuk.ortKar < 15) {
                    recSimKategori.className = 'chart-recommendation danger';
                    recSimKategori.textContent = `‚òÄÔ∏è YAZ 2026: "${enDusuk.adi}" %${enDusuk.ortKar.toFixed(0)} kar ile kritik. Bu kategoriyi Nisan'a kadar revize edin.`;
                } else if (enYuksek) {
                    recSimKategori.className = 'chart-recommendation';
                    recSimKategori.textContent = `‚òÄÔ∏è YAZ 2026: "${enYuksek.adi}" %${enYuksek.ortKar.toFixed(0)} ile en karlƒ±. Yaz koleksiyonunda bu kategoriye aƒüƒ±rlƒ±k verin.`;
                }
            }

            // 5. √ñnerilen Zam Tutarlarƒ± √ñnerisi
            const recSimZam = document.getElementById('rec-simZam');
            if (recSimZam) {
                const toplamZam = parseFloat(ozet.toplam_zam_gereksinimi) || 0;
                const zamSayisi = zamGerekenler.length;
                
                if (toplamZam > 500) {
                    recSimZam.className = 'chart-recommendation danger';
                    recSimZam.textContent = `‚òÄÔ∏è YAZ 2026: ${zamSayisi} √ºr√ºnde toplam ${toplamZam.toFixed(0)}‚Ç∫ zam gerekli. ≈ûubat'ta kademeli uygulayƒ±n.`;
                } else if (toplamZam > 0) {
                    recSimZam.className = 'chart-recommendation warning';
                    recSimZam.textContent = `‚òÄÔ∏è YAZ 2026: ${zamSayisi} √ºr√ºnde ${toplamZam.toFixed(0)}‚Ç∫ zam √∂nerisi. Mart-Nisan'da bayilere duyurun.`;
                } else {
                    recSimZam.className = 'chart-recommendation';
                    recSimZam.textContent = `‚òÄÔ∏è YAZ 2026: Zam gerekmez! Mevcut fiyatlarla Mayƒ±s'ta erken sezon kampanyasƒ± ba≈ülatƒ±n.`;
                }
            }

            // 6. Hedef vs Sim√ºle Kar √ñnerisi
            const recSimHedef = document.getElementById('rec-simHedef');
            if (recSimHedef) {
                const hedefAlti = urunler.filter(u => parseFloat(u.yeni_kar_marji) < hedefKar).length;
                const toplamUrun = urunler.length;
                const basariOrani = ((toplamUrun - hedefAlti) / toplamUrun * 100);
                
                if (basariOrani >= 80) {
                    recSimHedef.className = 'chart-recommendation';
                    recSimHedef.textContent = `‚òÄÔ∏è YAZ 2026: %${basariOrani.toFixed(0)} √ºr√ºn hedefte! Haziran'da yeni √ºr√ºn lansmanƒ± planlayƒ±n.`;
                } else if (basariOrani >= 50) {
                    recSimHedef.className = 'chart-recommendation warning';
                    recSimHedef.textContent = `‚òÄÔ∏è YAZ 2026: %${(100-basariOrani).toFixed(0)} √ºr√ºn hedef altƒ±nda. Nisan'a kadar fiyat optimizasyonu yapƒ±n.`;
                } else {
                    recSimHedef.className = 'chart-recommendation danger';
                    recSimHedef.textContent = `‚òÄÔ∏è YAZ 2026: Kritik! %${(100-basariOrani).toFixed(0)} hedef dƒ±≈üƒ±. Ocak'ta acil strateji revizyonu ≈üart!`;
                }
            }
        }

        function updateYazNotifications(urunler, ozet, dolarDegisim, pamukDegisim) {
            const notifList = document.getElementById('notifList');
            const notifCount = document.getElementById('notifCount');
            const notifPanel = document.getElementById('smartNotifications');
            
            let notifications = [];

            const kritikler = urunler.filter(u => u.risk_durumu === 'KRƒ∞Tƒ∞K');
            const rekabetDusukenler = urunler.filter(u => u.rekabet_durumu === 'REKABET G√úC√ú D√ú≈û√úK');

            if (kritikler.length > 0) {
                notifications.push({
                    type: 'danger',
                    icon: 'üö®',
                    title: 'Kritik K√¢r Alarmƒ±',
                    text: `${kritikler.length} √ºr√ºn hedef kar marjƒ±nƒ±n √ßok altƒ±nda: ${kritikler.slice(0, 2).map(u => u.urun_adi).join(', ')}`
                });
            }

            if (dolarDegisim > 10) {
                notifications.push({
                    type: 'warning',
                    icon: 'üíµ',
                    title: 'Dolar Etkisi',
                    text: `%${dolarDegisim} dolar artƒ±≈üƒ± nedeniyle ${ozet.kritik_sayisi + ozet.riskli_sayisi} yazlƒ±k √ºr√ºn etkilendi. Fiyat revizyonu d√º≈ü√ºn√ºn.`
                });
            }

            if (rekabetDusukenler.length > 0) {
                notifications.push({
                    type: 'warning',
                    icon: '‚öîÔ∏è',
                    title: 'Rekabet Uyarƒ±sƒ±',
                    text: `${rekabetDusukenler.length} √ºr√ºn piyasa ortalamasƒ±nƒ±n √ºst√ºnde fiyatlandƒ±rƒ±lmƒ±≈ü.`
                });
            }

            if (parseFloat(ozet.toplam_zam_gereksinimi) > 0) {
                notifications.push({
                    type: 'info',
                    icon: 'üí°',
                    title: 'Stratejik √ñneri',
                    text: `Hedef kar marjƒ±nƒ± korumak i√ßin toplam ${parseFloat(ozet.toplam_zam_gereksinimi).toFixed(0)}‚Ç∫ fiyat artƒ±≈üƒ± yapƒ±lmalƒ±.`
                });
            }

            if (notifications.length === 0) {
                notifications.push({
                    type: 'info',
                    icon: '‚úÖ',
                    title: 'Durum Stabil',
                    text: 'T√ºm yazlƒ±k √ºr√ºnler hedef kar marjƒ± √ºzerinde. Mevcut strateji s√ºrd√ºr√ºlebilir.'
                });
            }

            notifCount.textContent = notifications.filter(n => n.type === 'danger' || n.type === 'warning').length;
            notifCount.className = 'notifications-count' + (notifications.filter(n => n.type === 'danger').length === 0 ? ' zero' : '');
            notifPanel.className = 'smart-notifications' + (notifications.filter(n => n.type === 'danger').length > 0 ? ' has-alerts' : '');

            notifList.innerHTML = notifications.map(n => `
                <div class="notification-item ${n.type}">
                    <span class="notification-icon">${n.icon}</span>
                    <div class="notification-content">
                        <div class="notification-title">${n.title}</div>
                        <div class="notification-text">${n.text}</div>
                    </div>
                </div>
            `).join('');
        }

        function updateYazConclusion(urunler, ozet, dolarDegisim, pamukDegisim) {
            const conclusionText = document.getElementById('conclusionText');
            let text = '';

            if (ozet.kritik_sayisi > 0) {
                text = `<span class="danger">‚ö†Ô∏è Dƒ∞KKAT:</span> Dolar %${dolarDegisim} ve pamuk %${pamukDegisim} deƒüi≈üim senaryosunda <strong>${ozet.kritik_sayisi} √ºr√ºn kritik</strong>, <strong>${ozet.riskli_sayisi} √ºr√ºn riskli</strong> duruma d√º≈üt√º.<br><br>`;
                text += `<strong>Stratejik Karar:</strong> Yaz sezonu √∂ncesi toplam <strong class="warning">${parseFloat(ozet.toplam_zam_gereksinimi).toFixed(0)}‚Ç∫</strong> fiyat artƒ±≈üƒ± yaparak hedef kar marjƒ±na ula≈üabilirsiniz.`;
            } else if (ozet.riskli_sayisi > 0) {
                text = `<span class="warning">‚ö†Ô∏è UYARI:</span> Bu senaryoda <strong>${ozet.riskli_sayisi} √ºr√ºn</strong> hedef kar marjƒ±nƒ±n altƒ±na d√º≈üt√º.<br><br>`;
                text += `<strong>√ñneri:</strong> Riskli √ºr√ºnlerde kademeli fiyat artƒ±≈üƒ± veya maliyet optimizasyonu deƒüerlendirin.`;
            } else {
                text = `<span class="success">‚úÖ OLUMLU:</span> T√ºm yazlƒ±k √ºr√ºnler hedef kar marjƒ± √ºzerinde. Ortalama kar marjƒ± <strong>%${ozet.ortalama_kar_marji}</strong>.<br><br>`;
                text += `Mevcut fiyatlandƒ±rma stratejisi yaz sezonu i√ßin uygun g√∂r√ºn√ºyor.`;
            }

            conclusionText.innerHTML = text;
        }

        // Detay Tablosu A√ßƒ±lƒ±r/Kapanƒ±r
        let isTableCollapsed = false;
        
        function toggleDetailTable() {
            const content = document.getElementById('detailTableContent');
            const icon = document.getElementById('toggleIcon');
            const text = document.getElementById('toggleText');
            
            isTableCollapsed = !isTableCollapsed;
            
            if (isTableCollapsed) {
                content.classList.add('collapsed');
                icon.classList.add('collapsed');
                text.textContent = 'G√∂ster';
            } else {
                content.classList.remove('collapsed');
                icon.classList.remove('collapsed');
                text.textContent = 'Gizle';
            }
        }

        // Bildirim paneli toggle
        let isNotifHidden = false;
        function toggleNotifications() {
            const panel = document.getElementById('smartNotifications');
            const showBtn = document.getElementById('notifShowBtn');
            
            isNotifHidden = !isNotifHidden;
            
            if (isNotifHidden) {
                panel.classList.add('hidden');
                showBtn.classList.add('visible');
            } else {
                panel.classList.remove('hidden');
                showBtn.classList.remove('visible');
            }
        }

        // Eski runSim fonksiyonu (uyumluluk i√ßin)
        function runSim() {
            runYazSimulasyon();
        }

        // Sim√ºlasyon (eski kod - devre dƒ±≈üƒ±)
        function runSimOld() {
            const dolar = parseFloat(document.getElementById('simDolar').value);
            const pamuk = parseFloat(document.getElementById('simPamuk').value);
            const lojistik = parseFloat(document.getElementById('simLojistik').value);
            const enflasyon = parseFloat(document.getElementById('simEnflasyon').value);
            const hedef = parseInt(document.getElementById('hedefSlider').value);

            document.getElementById('simDolarVal').textContent = dolar.toFixed(2);
            document.getElementById('simPamukVal').textContent = pamuk;
            document.getElementById('simLojistikVal').textContent = lojistik;
            document.getElementById('simEnflasyonVal').textContent = enflasyon.toFixed(0);

            const dolarD = (dolar - data.base.dolar) / data.base.dolar;
            const pamukD = (pamuk - data.base.pamuk) / data.base.pamuk;
            const lojistikD = (lojistik - data.base.lojistik) / data.base.lojistik;
            const enflasyonD = (enflasyon - data.base.enflasyon) / 100;

            let toplamKar = 0, toplamMaliyet = 0, riskliCount = 0, toplamZam = 0;
            const tbody = document.getElementById('simBody');
            tbody.innerHTML = '';

            // Grafik verileri i√ßin diziler
            const labels = [];
            const mevcutKarlar = [];
            const simuleKarlar = [];
            const maliyetFarklari = [];
            const zamlar = [];

            // Bildirimler i√ßin veri toplama
            const notifications = [];
            const kritikUrunler = [];
            const piyasaUstundekiler = [];
            let zarardaOlanlar = 0;

            data.urunler.forEach(u => {
                const m = parseFloat(u.birim_maliyet) || 0;
                const f = parseFloat(u.satis_fiyati) || 0;
                const mevcutKar = f > 0 ? ((f - m) / f * 100) : 0;

                const etkiler = data.etkiler.filter(e => e.urun_id === u.urun_id);
                let oran = 0;
                etkiler.forEach(e => {
                    const k = parseFloat(e.etki_katsayisi) || 0;
                    const p = (e.parametre_adi || '').toLowerCase();
                    if (p.includes('dolar')) oran += dolarD * k;
                    else if (p.includes('pamuk')) oran += pamukD * k;
                    else if (p.includes('lojistik')) oran += lojistikD * k;
                });

                // Enflasyon t√ºm √ºr√ºnleri etkiler
                oran += enflasyonD * 0.3;

                const yeniM = m * (1 + oran);
                const kar = f > 0 ? ((f - yeniM) / f * 100) : 0;
                const fark = yeniM - m;
                const simuleFiyat = f; // Mevcut fiyat (zam yapƒ±lmadan)

                toplamKar += kar;
                toplamMaliyet += oran;

                const risk = kar < hedef;
                const kritik = kar < 15; // %15 altƒ± kritik
                let zamMiktari = 0;
                if (risk) {
                    riskliCount++;
                    zamMiktari = (yeniM / (1 - hedef / 100)) - f;
                    toplamZam += zamMiktari;
                }

                if (kritik) kritikUrunler.push(u.urun_adi);
                if (kar < 0) zarardaOlanlar++;

                // Rakip fiyatƒ± kontrol√º
                const rakipFiyatlari = data.rakipler.filter(r => r.urun_id === u.urun_id);
                const enUcuzRakip = rakipFiyatlari.length > 0 
                    ? Math.min(...rakipFiyatlari.map(r => parseFloat(r.rakip_fiyat)))
                    : null;
                const piyasaUstunde = enUcuzRakip && simuleFiyat > enUcuzRakip;
                if (piyasaUstunde) piyasaUstundekiler.push({ urun: u.urun_adi, fark: simuleFiyat - enUcuzRakip });

                // Grafik verilerini topla
                labels.push(u.urun_adi);
                mevcutKarlar.push(mevcutKar);
                simuleKarlar.push(kar);
                maliyetFarklari.push(fark);
                zamlar.push(zamMiktari > 0 ? zamMiktari : 0);

                // Tablo satƒ±rƒ± - dinamik stiller
                const tr = document.createElement('tr');
                
                // Kritik Kar Alarmƒ± - satƒ±r renklendirme
                if (kritik) {
                    tr.className = 'row-critical';
                } else if (risk) {
                    tr.className = 'row-warning';
                }

                // Kar marjƒ± badge
                let karBadgeClass = 'badge-success';
                if (kritik) karBadgeClass = 'badge-critical';
                else if (risk) karBadgeClass = 'badge-danger';

                // Durum s√ºtunu
                let durumHTML = '';
                if (kritik) {
                    durumHTML = `<span style="color: #ef4444; font-weight: 600;">üö® D√º≈ü√ºk K√¢r Riski!</span>`;
                } else if (risk) {
                    durumHTML = `<span style="color: #f59e0b;">‚ö†Ô∏è Risk</span>`;
                } else {
                    durumHTML = `<span style="color: #10b981;">‚úÖ OK</span>`;
                }

                // Rekabet uyarƒ±sƒ±
                let rekabetHTML = '';
                if (piyasaUstunde) {
                    rekabetHTML = `<span class="badge-market-high">Piyasa √úst√ºnde</span>`;
                }

                tr.innerHTML = `
                    <td>
                        <strong>${u.urun_adi}</strong>
                        ${kritik ? '<span class="risk-label">‚ö†Ô∏è KRƒ∞Tƒ∞K</span>' : ''}
                        ${rekabetHTML}
                    </td>
                    <td>${m.toFixed(0)}‚Ç∫</td>
                    <td>${yeniM.toFixed(0)}‚Ç∫</td>
                    <td style="color: ${fark > 0 ? '#ef4444' : '#10b981'}">${fark > 0 ? '+' : ''}${fark.toFixed(0)}‚Ç∫</td>
                    <td><span class="badge ${karBadgeClass}">%${kar.toFixed(1)}</span></td>
                    <td>${enUcuzRakip ? enUcuzRakip.toFixed(0) + '‚Ç∫' : '-'}</td>
                    <td>${durumHTML}</td>
                `;
                tbody.appendChild(tr);
            });

            const avgKar = data.urunler.length ? toplamKar / data.urunler.length : 0;
            const avgMaliyet = data.urunler.length ? (toplamMaliyet / data.urunler.length * 100) : 0;

            document.getElementById('simKar').textContent = '%' + avgKar.toFixed(1);
            document.getElementById('simRiskli').textContent = riskliCount;
            document.getElementById('simMaliyet').textContent = (avgMaliyet > 0 ? '+' : '') + avgMaliyet.toFixed(1) + '%';
            document.getElementById('simZam').textContent = toplamZam > 0 ? '+' + toplamZam.toFixed(0) + '‚Ç∫' : '0‚Ç∫';

            // Smart Notifications - Bildirimleri olu≈ütur
            updateSmartNotifications(dolar, kritikUrunler, piyasaUstundekiler, zarardaOlanlar, avgMaliyet, riskliCount, toplamZam, hedef);

            // Grafikleri √ßiz
            drawSimCharts(labels, mevcutKarlar, simuleKarlar, maliyetFarklari, zamlar, hedef, riskliCount);

            // A√ßƒ±klamalarƒ± g√ºncelle
            updateSimInsights(dolar, pamuk, lojistik, enflasyon, dolarD, pamukD, lojistikD, enflasyonD, avgKar, avgMaliyet, riskliCount, toplamZam, hedef);
        }

        // Smart Notifications Panel g√ºncelleme
        function updateSmartNotifications(dolar, kritikUrunler, piyasaUstundekiler, zarardaOlanlar, avgMaliyet, riskliCount, toplamZam, hedef) {
            const notifList = document.getElementById('notifList');
            const notifCount = document.getElementById('notifCount');
            const notifPanel = document.getElementById('smartNotifications');
            
            let notifications = [];

            // Kritik kar alarmƒ± bildirimi
            if (kritikUrunler.length > 0) {
                notifications.push({
                    type: 'danger',
                    icon: 'üö®',
                    title: 'Kritik K√¢r Alarmƒ±',
                    text: `${kritikUrunler.length} √ºr√ºn %15 kar marjƒ±nƒ±n altƒ±nda: ${kritikUrunler.slice(0, 3).join(', ')}${kritikUrunler.length > 3 ? '...' : ''}`
                });
            }

            // Zarar uyarƒ±sƒ±
            if (zarardaOlanlar > 0) {
                notifications.push({
                    type: 'danger',
                    icon: 'üí∏',
                    title: 'Zarar B√∂lgesi Uyarƒ±sƒ±',
                    text: `${zarardaOlanlar} √ºr√ºn zarar b√∂lgesine girdi! Fiyat revizyonu planlanmalƒ±.`
                });
            }

            // Dolar artƒ±≈üƒ± bildirimi
            if (dolar > data.base.dolar * 1.1) {
                const artis = ((dolar - data.base.dolar) / data.base.dolar * 100).toFixed(0);
                const oneriFiyatArtis = Math.ceil(artis / 2);
                notifications.push({
                    type: 'warning',
                    icon: 'üíµ',
                    title: 'Dolar Kuru Etkisi',
                    text: `Dolar kurundaki %${artis} artƒ±≈ü nedeniyle ${riskliCount} √ºr√ºn risk altƒ±nda. Fiyatlarƒ± %${oneriFiyatArtis} artƒ±rmayƒ± d√º≈ü√ºn√ºn.`
                });
            }

            // Piyasa √ºst√ºnde olanlar
            if (piyasaUstundekiler.length > 0) {
                notifications.push({
                    type: 'warning',
                    icon: '‚öîÔ∏è',
                    title: 'Rekabet Uyarƒ±sƒ±',
                    text: `${piyasaUstundekiler.length} √ºr√ºn rakiplerden pahalƒ±: ${piyasaUstundekiler.slice(0, 2).map(p => p.urun).join(', ')}${piyasaUstundekiler.length > 2 ? '...' : ''}`
                });
            }

            // Maliyet artƒ±≈üƒ± bildirimi
            if (avgMaliyet > 10) {
                notifications.push({
                    type: 'warning',
                    icon: 'üìà',
                    title: 'Y√ºksek Maliyet Artƒ±≈üƒ±',
                    text: `Ortalama maliyet %${avgMaliyet.toFixed(1)} arttƒ±. Hedef kar marjƒ±nƒ± korumak i√ßin toplam ${toplamZam.toFixed(0)}‚Ç∫ zam yapƒ±lmalƒ±.`
                });
            }

            // Olumlu durum bildirimi
            if (notifications.length === 0 && riskliCount === 0) {
                notifications.push({
                    type: 'info',
                    icon: '‚úÖ',
                    title: 'Durum Stabil',
                    text: `T√ºm √ºr√ºnler hedef kar marjƒ± (%${hedef}) √ºzerinde. Mevcut strateji s√ºrd√ºr√ºlebilir.`
                });
            }

            // √ñneriler
            if (riskliCount > 0 && toplamZam > 0) {
                const aylikZam = Math.round(toplamZam / 6);
                notifications.push({
                    type: 'info',
                    icon: 'üí°',
                    title: 'Aksiyon √ñnerisi',
                    text: `6 ay i√ßinde kademeli zam yaparak aylƒ±k ~${aylikZam}‚Ç∫ fiyat artƒ±≈üƒ± ile hedefe ula≈üabilirsiniz.`
                });
            }

            // Bildirimleri render et
            notifCount.textContent = notifications.filter(n => n.type === 'danger' || n.type === 'warning').length;
            notifCount.className = 'notifications-count' + (notifications.filter(n => n.type === 'danger').length === 0 ? ' zero' : '');
            
            notifPanel.className = 'smart-notifications' + (notifications.filter(n => n.type === 'danger').length > 0 ? ' has-alerts' : '');

            if (notifications.length === 0) {
                notifList.innerHTML = '<div class="notification-empty">Hen√ºz bildirim yok</div>';
            } else {
                notifList.innerHTML = notifications.map(n => `
                    <div class="notification-item ${n.type}">
                        <span class="notification-icon">${n.icon}</span>
                        <div class="notification-content">
                            <div class="notification-title">${n.title}</div>
                            <div class="notification-text">${n.text}</div>
                        </div>
                    </div>
                `).join('');
            }
        }

        function updateSimInsights(dolar, pamuk, lojistik, enflasyon, dolarD, pamukD, lojistikD, enflasyonD, avgKar, avgMaliyet, riskliCount, toplamZam, hedef) {
            // Dolar A√ßƒ±klamasƒ±
            const dolarCard = document.querySelector('.insight-card.dolar');
            const dolarInsight = document.getElementById('dolarInsight');
            const dolarFark = ((dolar - data.base.dolar) / data.base.dolar * 100).toFixed(1);
            
            if (dolar > data.base.dolar) {
                dolarCard.className = 'insight-card dolar negative';
                dolarInsight.innerHTML = `Dolar <strong>${data.base.dolar.toFixed(2)}‚Ç∫</strong>'den <strong>${dolar.toFixed(2)}‚Ç∫</strong>'ye √ßƒ±karsa (<span class="danger">+%${dolarFark}</span>), ithal hammadde maliyetleri artacak. √ñzellikle d√∂viz baƒüƒ±mlƒ± √ºr√ºnlerde <span class="danger">kar marjƒ± d√º≈üecek</span>.`;
            } else if (dolar < data.base.dolar) {
                dolarCard.className = 'insight-card dolar positive';
                dolarInsight.innerHTML = `Dolar <strong>${data.base.dolar.toFixed(2)}‚Ç∫</strong>'den <strong>${dolar.toFixed(2)}‚Ç∫</strong>'ye d√º≈üerse (<span class="success">${dolarFark}%</span>), ithal maliyetler azalacak. <span class="success">Kar marjƒ±nƒ±z artacak!</span>`;
            } else {
                dolarCard.className = 'insight-card dolar neutral';
                dolarInsight.innerHTML = `Dolar kuru <strong>${dolar.toFixed(2)}‚Ç∫</strong> seviyesinde sabit kalƒ±rsa, mevcut maliyetler korunur. Deƒüi≈üiklik yok.`;
            }

            // Pamuk A√ßƒ±klamasƒ±
            const pamukCard = document.querySelector('.insight-card.pamuk');
            const pamukInsight = document.getElementById('pamukInsight');
            const pamukFark = ((pamuk - data.base.pamuk) / data.base.pamuk * 100).toFixed(1);
            
            if (pamuk > data.base.pamuk) {
                pamukCard.className = 'insight-card pamuk negative';
                pamukInsight.innerHTML = `Pamuk endeksi <strong>${data.base.pamuk}</strong>'dan <strong>${pamuk}</strong>'e y√ºkselirse (<span class="danger">+%${pamukFark}</span>), tekstil √ºr√ºnleri maliyeti artacak. Ti≈ü√∂rt, elbise gibi √ºr√ºnlerde <span class="danger">zam gerekebilir</span>.`;
            } else if (pamuk < data.base.pamuk) {
                pamukCard.className = 'insight-card pamuk positive';
                pamukInsight.innerHTML = `Pamuk endeksi <strong>${data.base.pamuk}</strong>'dan <strong>${pamuk}</strong>'e d√º≈üerse (<span class="success">${pamukFark}%</span>), tekstil maliyetleri azalƒ±r. <span class="success">Rekabet√ßi fiyat avantajƒ±!</span>`;
            } else {
                pamukCard.className = 'insight-card pamuk neutral';
                pamukInsight.innerHTML = `Pamuk endeksi <strong>${pamuk}</strong> seviyesinde. Tekstil √ºr√ºnlerinde maliyet deƒüi≈üikliƒüi yok.`;
            }

            // Lojistik A√ßƒ±klamasƒ±
            const lojistikCard = document.querySelector('.insight-card.lojistik');
            const lojistikInsight = document.getElementById('lojistikInsight');
            const lojistikFark = ((lojistik - data.base.lojistik) / data.base.lojistik * 100).toFixed(1);
            
            if (lojistik > data.base.lojistik) {
                lojistikCard.className = 'insight-card lojistik negative';
                lojistikInsight.innerHTML = `Lojistik endeksi <strong>${data.base.lojistik}</strong>'den <strong>${lojistik}</strong>'e √ßƒ±karsa (<span class="danger">+%${lojistikFark}</span>), nakliye ve depo maliyetleri artar. <span class="danger">T√ºm √ºr√ºnleri etkiler.</span>`;
            } else if (lojistik < data.base.lojistik) {
                lojistikCard.className = 'insight-card lojistik positive';
                lojistikInsight.innerHTML = `Lojistik endeksi <strong>${data.base.lojistik}</strong>'den <strong>${lojistik}</strong>'e d√º≈üerse (<span class="success">${lojistikFark}%</span>), nakliye maliyetleri azalƒ±r. <span class="success">Kar marjƒ± artƒ±≈üƒ±!</span>`;
            } else {
                lojistikCard.className = 'insight-card lojistik neutral';
                lojistikInsight.innerHTML = `Lojistik endeksi <strong>${lojistik}</strong> seviyesinde sabit. Nakliye maliyetlerinde deƒüi≈üiklik yok.`;
            }

            // Enflasyon A√ßƒ±klamasƒ±
            const enflasyonCard = document.querySelector('.insight-card.enflasyon');
            const enflasyonInsight = document.getElementById('enflasyonInsight');
            const enflasyonFark = (enflasyon - data.base.enflasyon).toFixed(1);
            
            if (enflasyon > data.base.enflasyon) {
                enflasyonCard.className = 'insight-card enflasyon negative';
                enflasyonInsight.innerHTML = `Enflasyon %<strong>${data.base.enflasyon}</strong>'den %<strong>${enflasyon}</strong>'e √ßƒ±karsa (<span class="danger">+${enflasyonFark} puan</span>), i≈ü√ßilik, kira, elektrik gibi genel giderler artar. <span class="danger">T√ºm √ºr√ºnlerde maliyet y√ºkselir.</span>`;
            } else if (enflasyon < data.base.enflasyon) {
                enflasyonCard.className = 'insight-card enflasyon positive';
                enflasyonInsight.innerHTML = `Enflasyon %<strong>${data.base.enflasyon}</strong>'den %<strong>${enflasyon}</strong>'e d√º≈üerse (<span class="success">${enflasyonFark} puan</span>), genel giderler azalƒ±r. <span class="success">Maliyetler d√º≈üer!</span>`;
            } else {
                enflasyonCard.className = 'insight-card enflasyon neutral';
                enflasyonInsight.innerHTML = `Enflasyon %<strong>${enflasyon}</strong> seviyesinde. Genel giderlerde beklenmedik deƒüi≈üiklik yok.`;
            }

            // Genel Sonu√ß
            const conclusionText = document.getElementById('conclusionText');
            let conclusion = '';

            if (avgMaliyet > 5) {
                conclusion = `<span class="danger">‚ö†Ô∏è Dƒ∞KKAT:</span> Bu senaryoda maliyetler ortalama <strong class="danger">%${avgMaliyet.toFixed(1)}</strong> artƒ±yor. `;
                conclusion += `<strong>${riskliCount}</strong> √ºr√ºn risk altƒ±na giriyor. `;
                if (toplamZam > 0) {
                    conclusion += `Hedef kar marjƒ±nƒ± korumak i√ßin toplam <strong class="warning">${toplamZam.toFixed(0)}‚Ç∫</strong> zam yapmanƒ±z gerekiyor.`;
                }
            } else if (avgMaliyet < -2) {
                conclusion = `<span class="success">‚úÖ OLUMLU:</span> Bu senaryoda maliyetler ortalama <strong class="success">%${Math.abs(avgMaliyet).toFixed(1)}</strong> d√º≈ü√ºyor. `;
                conclusion += `Kar marjƒ±nƒ±z artƒ±yor! Fiyatlarƒ± sabit tutarak rekabet avantajƒ± kazanabilirsiniz.`;
            } else {
                conclusion = `<span class="warning">üìä N√ñTR:</span> Bu senaryoda maliyetlerde √∂nemli bir deƒüi≈üiklik yok (${avgMaliyet > 0 ? '+' : ''}%${avgMaliyet.toFixed(1)}). `;
                conclusion += `Mevcut fiyatlandƒ±rma stratejinizi koruyabilirsiniz.`;
            }

            if (riskliCount > 0 && avgMaliyet > 0) {
                conclusion += `<br><br><strong>√ñneri:</strong> Yaz sezonu √∂ncesi ${riskliCount > 3 ? 'kapsamlƒ± fiyat revizyonu' : 'se√ßili √ºr√ºnlerde zam'} yaparak hedefe ula≈üabilirsiniz.`;
            }

            conclusionText.innerHTML = conclusion;
        }

        function drawSimCharts(labels, mevcutKarlar, simuleKarlar, maliyetFarklari, zamlar, hedef, riskliCount) {
            // 1. Kar Marjƒ± Kar≈üƒ±la≈ütƒ±rma Grafiƒüi
            const ctx1 = document.getElementById('simKarChart');
            if (charts.simKar) charts.simKar.destroy();
            
            charts.simKar = new Chart(ctx1, {
                type: 'bar',
                data: {
                    labels,
                    datasets: [
                        { 
                            label: 'Mevcut Kar %', 
                            data: mevcutKarlar, 
                            backgroundColor: '#3b82f6',
                            borderRadius: 4
                        },
                        { 
                            label: 'Sim√ºle Kar %', 
                            data: simuleKarlar, 
                            backgroundColor: simuleKarlar.map(k => k >= hedef ? '#10b981' : '#ef4444'),
                            borderRadius: 4
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { 
                        legend: { 
                            position: 'top',
                            labels: { color: '#888', padding: 15 }
                        }
                    },
                    scales: {
                        y: { grid: { color: '#2a2a4a' }, ticks: { color: '#666' } },
                        x: { grid: { display: false }, ticks: { color: '#666', font: { size: 9 } } }
                    }
                }
            });

            // 2. Maliyet Deƒüi≈üimi Grafiƒüi
            const ctx2 = document.getElementById('simMaliyetChart');
            if (charts.simMaliyet) charts.simMaliyet.destroy();
            
            charts.simMaliyet = new Chart(ctx2, {
                type: 'bar',
                data: {
                    labels,
                    datasets: [{
                        label: 'Maliyet Deƒüi≈üimi (‚Ç∫)',
                        data: maliyetFarklari,
                        backgroundColor: maliyetFarklari.map(f => f > 0 ? '#ef4444' : '#10b981'),
                        borderRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: { grid: { color: '#2a2a4a' }, ticks: { color: '#666' } },
                        x: { grid: { display: false }, ticks: { color: '#666', font: { size: 9 } } }
                    }
                }
            });

            // 3. Durum Pasta Grafiƒüi
            const ctx3 = document.getElementById('simDurumChart');
            if (charts.simDurum) charts.simDurum.destroy();
            
            const guvenliCount = labels.length - riskliCount;
            
            charts.simDurum = new Chart(ctx3, {
                type: 'doughnut',
                data: {
                    labels: ['Risk Altƒ±nda', 'G√ºvenli'],
                    datasets: [{
                        data: [riskliCount, guvenliCount],
                        backgroundColor: ['#ef4444', '#10b981'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '55%',
                    plugins: {
                        legend: { position: 'bottom', labels: { color: '#888', padding: 15 } }
                    }
                }
            });

            // 4. √ñnerilen Zam Grafiƒüi
            const ctx4 = document.getElementById('simZamChart');
            if (charts.simZam) charts.simZam.destroy();
            
            // Sadece zam gereken √ºr√ºnleri filtrele
            const zamLabels = labels.filter((_, i) => zamlar[i] > 0);
            const zamValues = zamlar.filter(z => z > 0);
            
            charts.simZam = new Chart(ctx4, {
                type: 'bar',
                data: {
                    labels: zamLabels.length > 0 ? zamLabels : ['Zam gerekmiyor'],
                    datasets: [{
                        label: '√ñnerilen Zam (‚Ç∫)',
                        data: zamValues.length > 0 ? zamValues : [0],
                        backgroundColor: '#f59e0b',
                        borderRadius: 4
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        x: { grid: { color: '#2a2a4a' }, ticks: { color: '#666' } },
                        y: { grid: { display: false }, ticks: { color: '#666', font: { size: 10 } } }
                    }
                }
            });
        }

        // √úr√ºnler
        function loadUrunler() {
            const hedef = parseInt(document.getElementById('hedefSlider').value);
            const tbody = document.getElementById('urunlerBody');
            if (!tbody) return;
            tbody.innerHTML = '';

            // √ñzet kartlarƒ±nƒ± g√ºncelle
            const toplam = data.urunler.length;
            const kategoriler = [...new Set(data.urunler.map(u => u.kategori_adi))].length;
            let toplamKar = 0;
            let dusukStok = 0;

            data.urunler.forEach(u => {
                const m = parseFloat(u.birim_maliyet) || 0;
                const f = parseFloat(u.satis_fiyati) || 0;
                const stok = parseInt(u.stok_miktari) || 0;
                const karTL = f - m;
                const kar = f > 0 ? ((f - m) / f * 100) : 0;
                const stokDegeri = m * stok;
                
                toplamKar += kar;
                if (stok <= 10) dusukStok++;

                // Durum belirleme
                let durum, durumClass;
                if (kar >= hedef && stok > 10) {
                    durum = '‚úÖ ƒ∞yi';
                    durumClass = 'badge-success';
                } else if (kar < hedef && stok <= 10) {
                    durum = 'üö® Kritik';
                    durumClass = 'badge-danger';
                } else if (kar < hedef) {
                    durum = '‚ö†Ô∏è Riskli';
                    durumClass = 'badge-warning';
                } else {
                    durum = 'üì¶ Stok Az';
                    durumClass = 'badge-info';
                }

                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td><strong>${u.urun_adi}</strong></td>
                    <td style="color: #888;">${u.kategori_adi || '-'}</td>
                    <td>${m.toFixed(0)}‚Ç∫</td>
                    <td style="color: #00d4ff; font-weight: 600;">${f.toFixed(0)}‚Ç∫</td>
                    <td style="color: ${karTL >= 0 ? '#10b981' : '#ef4444'};">${karTL.toFixed(0)}‚Ç∫</td>
                    <td><span class="badge ${kar >= hedef ? 'badge-success' : 'badge-danger'}">%${kar.toFixed(1)}</span></td>
                    <td>${stok}</td>
                    <td style="color: #888;">${(stokDegeri/1000).toFixed(1)}K‚Ç∫</td>
                    <td><span class="badge ${durumClass}">${durum}</span></td>
                    <td><button class="btn btn-secondary" style="padding: 6px 12px; font-size: 0.8em;" onclick="editUrun(${u.urun_id})">D√ºzenle</button></td>
                `;
                tbody.appendChild(tr);
            });

            // √ñzet kartlarƒ±nƒ± g√ºncelle
            const ortKar = toplam > 0 ? (toplamKar / toplam) : 0;
            document.getElementById('urunToplam').textContent = toplam;
            document.getElementById('urunKategori').textContent = kategoriler;
            document.getElementById('urunOrtKar').textContent = '%' + ortKar.toFixed(1);
            document.getElementById('urunDusukStok').textContent = dusukStok;
            document.getElementById('urunRecordCount').textContent = `(${toplam} kayƒ±t)`;

            // √úr√ºn grafiklerini √ßiz
            drawUrunCharts(hedef);
        }

        // √úr√ºn grafikleri
        function drawUrunCharts(hedef) {
            // Kar Marjƒ± Daƒüƒ±lƒ±mƒ±
            const ctx1 = document.getElementById('urunTabKarChart');
            if (ctx1) {
                if (charts.urunTabKar) charts.urunTabKar.destroy();
                
                const karlar = data.urunler.map(u => {
                    const m = parseFloat(u.birim_maliyet) || 0;
                    const f = parseFloat(u.satis_fiyati) || 0;
                    return f > 0 ? ((f - m) / f * 100) : 0;
                });
                
                const dusuk = karlar.filter(k => k < 30).length;
                const orta = karlar.filter(k => k >= 30 && k < hedef).length;
                const yuksek = karlar.filter(k => k >= hedef).length;

                charts.urunTabKar = new Chart(ctx1, {
                    type: 'doughnut',
                    data: {
                        labels: ['D√º≈ü√ºk (<30%)', 'Orta (30-' + hedef + '%)', 'Hedef √úst√º (>' + hedef + '%)'],
                        datasets: [{
                            data: [dusuk, orta, yuksek],
                            backgroundColor: ['#ef4444', '#f59e0b', '#10b981'],
                            borderWidth: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        cutout: '60%',
                        plugins: { legend: { position: 'bottom', labels: { color: '#888', padding: 10, font: { size: 9 } } } }
                    }
                });
            }

            // Kategori Bazlƒ± √úr√ºn Sayƒ±sƒ±
            const ctx2 = document.getElementById('urunTabKategoriChart');
            if (ctx2) {
                if (charts.urunTabKategori) charts.urunTabKategori.destroy();
                
                const kategoriSayilari = {};
                data.urunler.forEach(u => {
                    const kat = u.kategori_adi || 'Diƒüer';
                    kategoriSayilari[kat] = (kategoriSayilari[kat] || 0) + 1;
                });

                charts.urunTabKategori = new Chart(ctx2, {
                    type: 'bar',
                    data: {
                        labels: Object.keys(kategoriSayilari).map(k => k.length > 12 ? k.substring(0, 10) + '...' : k),
                        datasets: [{
                            label: '√úr√ºn Sayƒ±sƒ±',
                            data: Object.values(kategoriSayilari),
                            backgroundColor: '#3b82f6',
                            borderRadius: 4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { display: false } },
                        scales: {
                            y: { grid: { color: '#2a2a4a' }, ticks: { color: '#666' } },
                            x: { grid: { display: false }, ticks: { color: '#888', font: { size: 9 }, maxRotation: 45 } }
                        }
                    }
                });
            }

            // Stok Durumu
            const ctx3 = document.getElementById('urunTabStokChart');
            if (ctx3) {
                if (charts.urunTabStok) charts.urunTabStok.destroy();
                
                const stoklar = data.urunler.map(u => parseInt(u.stok_miktari) || 0);
                const kritik = stoklar.filter(s => s <= 10).length;
                const dusukStok = stoklar.filter(s => s > 10 && s <= 30).length;
                const normal = stoklar.filter(s => s > 30 && s <= 100).length;
                const yuksekStok = stoklar.filter(s => s > 100).length;

                charts.urunTabStok = new Chart(ctx3, {
                    type: 'pie',
                    data: {
                        labels: ['Kritik (‚â§10)', 'D√º≈ü√ºk (11-30)', 'Normal (31-100)', 'Y√ºksek (>100)'],
                        datasets: [{
                            data: [kritik, dusukStok, normal, yuksekStok],
                            backgroundColor: ['#ef4444', '#f59e0b', '#3b82f6', '#10b981'],
                            borderWidth: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { position: 'bottom', labels: { color: '#888', padding: 10, font: { size: 9 } } } }
                    }
                });
            }

            // Fiyat vs Maliyet
            const ctx4 = document.getElementById('urunTabFiyatMaliyetChart');
            if (ctx4) {
                if (charts.urunTabFiyatMaliyet) charts.urunTabFiyatMaliyet.destroy();
                
                const ilk8 = data.urunler.slice(0, 8);

                charts.urunTabFiyatMaliyet = new Chart(ctx4, {
                    type: 'bar',
                    data: {
                        labels: ilk8.map(u => u.urun_adi.length > 10 ? u.urun_adi.substring(0, 8) + '...' : u.urun_adi),
                        datasets: [
                            {
                                label: 'Maliyet',
                                data: ilk8.map(u => parseFloat(u.birim_maliyet) || 0),
                                backgroundColor: '#ef4444',
                                borderRadius: 4
                            },
                            {
                                label: 'Satƒ±≈ü Fiyatƒ±',
                                data: ilk8.map(u => parseFloat(u.satis_fiyati) || 0),
                                backgroundColor: '#10b981',
                                borderRadius: 4
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { labels: { color: '#888', padding: 10 } } },
                        scales: {
                            y: { grid: { color: '#2a2a4a' }, ticks: { color: '#666', callback: v => v + '‚Ç∫' } },
                            x: { grid: { display: false }, ticks: { color: '#888', font: { size: 9 }, maxRotation: 45 } }
                        }
                    }
                });
            }

            // Kategori Performans √ñzeti
            updateKategoriInsights(hedef);
        }

        // Kategori Performans √ñzeti
        function updateKategoriInsights(hedef) {
            const container = document.getElementById('kategoriInsights');
            if (!container) return;
            
            const kategoriData = {};
            data.urunler.forEach(u => {
                const kat = u.kategori_adi || 'Diƒüer';
                const m = parseFloat(u.birim_maliyet) || 0;
                const f = parseFloat(u.satis_fiyati) || 0;
                const kar = f > 0 ? ((f - m) / f * 100) : 0;
                
                if (!kategoriData[kat]) {
                    kategoriData[kat] = { toplam: 0, adet: 0, stok: 0 };
                }
                kategoriData[kat].toplam += kar;
                kategoriData[kat].adet++;
                kategoriData[kat].stok += parseInt(u.stok_miktari) || 0;
            });

            container.innerHTML = Object.entries(kategoriData).map(([kat, val]) => {
                const ortKar = val.toplam / val.adet;
                const durum = ortKar >= hedef ? '‚úÖ' : ortKar >= hedef - 10 ? '‚ö†Ô∏è' : 'üö®';
                return `
                    <div class="insight-card">
                        <div class="insight-icon">${durum}</div>
                        <div class="insight-content">
                            <h4>${kat}</h4>
                            <p>Ort. Kar: <strong style="color: ${ortKar >= hedef ? '#10b981' : '#f59e0b'}">%${ortKar.toFixed(1)}</strong> | ${val.adet} √ºr√ºn | ${val.stok} stok</p>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // √úr√ºn tablosu toggle
        let isUrunTableCollapsed = false;
        
        function toggleUrunTable() {
            const content = document.getElementById('urunTableContent');
            const icon = document.getElementById('toggleUrunIcon');
            const text = document.getElementById('toggleUrunText');
            
            isUrunTableCollapsed = !isUrunTableCollapsed;
            
            if (isUrunTableCollapsed) {
                content.classList.add('collapsed');
                icon.classList.add('collapsed');
                text.textContent = 'G√∂ster';
            } else {
                content.classList.remove('collapsed');
                icon.classList.remove('collapsed');
                text.textContent = 'Gizle';
            }
        }

        // Rakipler
        let isRakipTableCollapsed = false;
        
        function toggleRakipTable() {
            const content = document.getElementById('rakipTableContent');
            const icon = document.getElementById('toggleRakipIcon');
            const text = document.getElementById('toggleRakipText');
            
            isRakipTableCollapsed = !isRakipTableCollapsed;
            
            if (isRakipTableCollapsed) {
                content.classList.add('collapsed');
                icon.classList.add('collapsed');
                text.textContent = 'G√∂ster';
            } else {
                content.classList.remove('collapsed');
                icon.classList.remove('collapsed');
                text.textContent = 'Gizle';
            }
        }

        function loadRakipler() {
            const tbody = document.getElementById('rakipBody');
            tbody.innerHTML = '';

            let avantajSayisi = 0;
            let dezavantajSayisi = 0;
            let esitSayisi = 0;
            let toplamFarkYuzde = 0;
            
            const rakipVeriler = [];
            const rakipBazliOrtalama = {};

            data.rakipler.forEach(r => {
                const urun = data.urunler.find(u => u.urun_id === r.urun_id);
                const bizim = urun ? parseFloat(urun.satis_fiyati) : 0;
                const rakipFiyat = parseFloat(r.rakip_fiyat) || 0;
                const fark = bizim - rakipFiyat;
                const farkYuzde = bizim > 0 ? ((bizim - rakipFiyat) / bizim * 100) : 0;
                const kategori = urun ? urun.kategori_adi : 'Diƒüer';

                let badge, durum, oneri;
                if (fark > 20) { 
                    badge = 'badge-dezavantaj'; 
                    durum = 'üìà Pahalƒ±yƒ±z'; 
                    oneri = 'Fiyat indirimi d√º≈ü√ºn√ºn';
                    dezavantajSayisi++;
                } else if (fark < -20) { 
                    badge = 'badge-avantaj'; 
                    durum = 'üìâ Ucuzuz'; 
                    oneri = 'Fiyat artƒ±≈üƒ± yapƒ±labilir';
                    avantajSayisi++;
                } else {
                    badge = 'badge-esit'; 
                    durum = '‚öñÔ∏è E≈üit'; 
                    oneri = 'Fiyat dengeli';
                    esitSayisi++;
                }

                toplamFarkYuzde += farkYuzde;

                // Rakip bazlƒ± ortalama i√ßin
                if (!rakipBazliOrtalama[r.rakip_adi]) {
                    rakipBazliOrtalama[r.rakip_adi] = { total: 0, count: 0 };
                }
                rakipBazliOrtalama[r.rakip_adi].total += rakipFiyat;
                rakipBazliOrtalama[r.rakip_adi].count++;

                rakipVeriler.push({
                    urun: r.urun_adi || urun?.urun_adi || '-',
                    kategori: kategori,
                    bizim: bizim,
                    rakipAdi: r.rakip_adi,
                    rakipFiyat: rakipFiyat,
                    fark: fark,
                    farkYuzde: farkYuzde,
                    durum: durum,
                    badge: badge,
                    oneri: oneri
                });

                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td><strong>${r.urun_adi || '-'}</strong></td>
                    <td style="color: #888;">${kategori}</td>
                    <td style="color: #00d4ff; font-weight: 600;">${bizim.toFixed(0)}‚Ç∫</td>
                    <td>${r.rakip_adi}</td>
                    <td style="font-weight: 600;">${rakipFiyat.toFixed(0)}‚Ç∫</td>
                    <td style="color: ${fark > 0 ? '#ef4444' : '#10b981'}; font-weight: 600;">${fark > 0 ? '+' : ''}${fark.toFixed(0)}‚Ç∫</td>
                    <td style="color: ${farkYuzde > 0 ? '#ef4444' : '#10b981'};">${farkYuzde > 0 ? '+' : ''}${farkYuzde.toFixed(1)}%</td>
                    <td><span class="${badge}">${durum}</span></td>
                    <td style="font-size: 0.85em; color: #888;">${oneri}</td>
                `;
                tbody.appendChild(tr);
            });

            // √ñzet kartlarƒ±nƒ± g√ºncelle
            const toplamKayit = data.rakipler.length;
            const ortFark = toplamKayit > 0 ? (toplamFarkYuzde / toplamKayit) : 0;

            document.getElementById('rakipToplam').textContent = toplamKayit;
            document.getElementById('rakipAvantaj').textContent = avantajSayisi;
            document.getElementById('rakipDezavantaj').textContent = dezavantajSayisi;
            document.getElementById('rakipOrtFark').textContent = (ortFark > 0 ? '+' : '') + ortFark.toFixed(1) + '%';
            document.getElementById('rakipRecordCount').textContent = `(${toplamKayit} kayƒ±t)`;

            // Grafikleri √ßiz
            drawRakipCharts(rakipVeriler, avantajSayisi, dezavantajSayisi, esitSayisi, rakipBazliOrtalama);

            // Stratejik √∂nerileri g√ºncelle
            updateRakipInsights(rakipVeriler, avantajSayisi, dezavantajSayisi, ortFark);
        }

        function drawRakipCharts(veriler, avantaj, dezavantaj, esit, rakipOrtalama) {
            // 1. Fiyat Kar≈üƒ±la≈ütƒ±rma Grafiƒüi
            const ctx1 = document.getElementById('rakipFiyatChart');
            if (charts.rakipFiyat) charts.rakipFiyat.destroy();

            const uniqueUrunler = [...new Set(veriler.map(v => v.urun))];
            const bizimFiyatlar = uniqueUrunler.map(u => {
                const veri = veriler.find(v => v.urun === u);
                return veri ? veri.bizim : 0;
            });
            const rakipFiyatlar = uniqueUrunler.map(u => {
                const urunRakipleri = veriler.filter(v => v.urun === u);
                const ortRakip = urunRakipleri.reduce((sum, v) => sum + v.rakipFiyat, 0) / urunRakipleri.length;
                return ortRakip || 0;
            });

            charts.rakipFiyat = new Chart(ctx1, {
                type: 'bar',
                data: {
                    labels: uniqueUrunler.map(u => u.length > 10 ? u.substring(0, 8) + '...' : u),
                    datasets: [
                        {
                            label: 'Bizim Fiyat',
                            data: bizimFiyatlar,
                            backgroundColor: '#00d4ff',
                            borderRadius: 4
                        },
                        {
                            label: 'Rakip Ort.',
                            data: rakipFiyatlar,
                            backgroundColor: '#f59e0b',
                            borderRadius: 4
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { labels: { color: '#888' } } },
                    scales: {
                        x: { grid: { display: false }, ticks: { color: '#888', font: { size: 9 }, maxRotation: 45 } },
                        y: { grid: { color: '#2a2a4a' }, ticks: { color: '#888', callback: v => v + '‚Ç∫' } }
                    }
                }
            });

            // 2. Rekabet Durumu Daƒüƒ±lƒ±mƒ±
            const ctx2 = document.getElementById('rakipDurumChart');
            if (charts.rakipDurum) charts.rakipDurum.destroy();

            charts.rakipDurum = new Chart(ctx2, {
                type: 'doughnut',
                data: {
                    labels: ['Fiyat Avantajƒ±', 'Fiyat Dezavantajƒ±', 'E≈üit Fiyat'],
                    datasets: [{
                        data: [avantaj, dezavantaj, esit],
                        backgroundColor: ['#10b981', '#ef4444', '#3b82f6'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { position: 'bottom', labels: { color: '#888', padding: 15 } } },
                    cutout: '60%'
                }
            });

            // 3. Fiyat Farkƒ± Analizi
            const ctx3 = document.getElementById('rakipFarkChart');
            if (charts.rakipFark) charts.rakipFark.destroy();

            charts.rakipFark = new Chart(ctx3, {
                type: 'bar',
                data: {
                    labels: veriler.map(v => v.urun.length > 8 ? v.urun.substring(0, 6) + '...' : v.urun),
                    datasets: [{
                        label: 'Fiyat Farkƒ± %',
                        data: veriler.map(v => v.farkYuzde),
                        backgroundColor: veriler.map(v => v.farkYuzde > 10 ? '#ef4444' : v.farkYuzde < -10 ? '#10b981' : '#3b82f6'),
                        borderRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    indexAxis: 'y',
                    plugins: { legend: { display: false } },
                    scales: {
                        x: { grid: { color: '#2a2a4a' }, ticks: { color: '#888', callback: v => v + '%' } },
                        y: { grid: { display: false }, ticks: { color: '#888', font: { size: 9 } } }
                    }
                }
            });

            // 4. Rakip Bazlƒ± Ortalama
            const ctx4 = document.getElementById('rakipOrtChart');
            if (charts.rakipOrt) charts.rakipOrt.destroy();

            const rakipLabels = Object.keys(rakipOrtalama);
            const rakipOrtFiyatlar = rakipLabels.map(r => rakipOrtalama[r].total / rakipOrtalama[r].count);

            charts.rakipOrt = new Chart(ctx4, {
                type: 'bar',
                data: {
                    labels: rakipLabels,
                    datasets: [{
                        label: 'Ortalama Fiyat (‚Ç∫)',
                        data: rakipOrtFiyatlar,
                        backgroundColor: rakipLabels.map((_, i) => `hsl(${i * 60 + 180}, 70%, 50%)`),
                        borderRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        x: { grid: { display: false }, ticks: { color: '#888' } },
                        y: { grid: { color: '#2a2a4a' }, ticks: { color: '#888', callback: v => v + '‚Ç∫' } }
                    }
                }
            });
        }

        function updateRakipInsights(veriler, avantaj, dezavantaj, ortFark) {
            const insightsDiv = document.getElementById('rakipInsights');
            let html = '';

            // En pahalƒ± olduƒüumuz √ºr√ºn
            const enPahali = veriler.filter(v => v.fark > 0).sort((a, b) => b.fark - a.fark)[0];
            if (enPahali) {
                html += `
                    <div class="insight-card danger">
                        <div class="insight-icon">üî¥</div>
                        <div class="insight-content">
                            <h4>En Y√ºksek Fiyat Farkƒ±</h4>
                            <p><strong>${enPahali.urun}</strong> √ºr√ºn√º rakiplerden <strong>+${enPahali.fark.toFixed(0)}‚Ç∫</strong> daha pahalƒ±. Fiyat revizyonu d√º≈ü√ºn√ºn.</p>
                        </div>
                    </div>
                `;
            }

            // En ucuz olduƒüumuz √ºr√ºn
            const enUcuz = veriler.filter(v => v.fark < 0).sort((a, b) => a.fark - b.fark)[0];
            if (enUcuz) {
                html += `
                    <div class="insight-card success">
                        <div class="insight-icon">üü¢</div>
                        <div class="insight-content">
                            <h4>Fiyat Avantajƒ± Fƒ±rsatƒ±</h4>
                            <p><strong>${enUcuz.urun}</strong> √ºr√ºn√º rakiplerden <strong>${Math.abs(enUcuz.fark).toFixed(0)}‚Ç∫</strong> daha ucuz. Fiyat artƒ±rarak kar marjƒ±nƒ± artƒ±rabilirsiniz.</p>
                        </div>
                    </div>
                `;
            }

            // Genel durum
            if (avantaj > dezavantaj) {
                html += `
                    <div class="insight-card info">
                        <div class="insight-icon">üìä</div>
                        <div class="insight-content">
                            <h4>Genel Rekabet Durumu: ƒ∞Yƒ∞</h4>
                            <p>${avantaj} √ºr√ºnde fiyat avantajƒ±nƒ±z var. Rekabet g√ºc√ºn√ºz y√ºksek, m√º≈üteri √ßekme potansiyeliniz artƒ±yor.</p>
                        </div>
                    </div>
                `;
            } else if (dezavantaj > avantaj) {
                html += `
                    <div class="insight-card warning">
                        <div class="insight-icon">‚ö†Ô∏è</div>
                        <div class="insight-content">
                            <h4>Genel Rekabet Durumu: Dƒ∞KKAT</h4>
                            <p>${dezavantaj} √ºr√ºnde rakiplerden pahalƒ±sƒ±nƒ±z. Fiyat stratejinizi g√∂zden ge√ßirin veya deƒüer √∂nermenizi g√º√ßlendirin.</p>
                        </div>
                    </div>
                `;
            }

            // Strateji √∂nerisi
            html += `
                <div class="insight-card">
                    <div class="insight-icon">üí°</div>
                    <div class="insight-content">
                        <h4>Strateji √ñnerisi</h4>
                        <p>${ortFark > 5 ? 'Genel fiyat seviyeniz y√ºksek. Kampanya veya indirimlerle m√º≈üteri kazanƒ±mƒ± artƒ±rƒ±labilir.' : 
                           ortFark < -5 ? 'Genel fiyat seviyeniz d√º≈ü√ºk. Kar marjƒ±nƒ± korumak i√ßin se√ßili √ºr√ºnlerde fiyat artƒ±≈üƒ± yapƒ±labilir.' :
                           'Fiyatlarƒ±nƒ±z piyasa ortalamasƒ±nda. Deƒüer √∂nermenizi g√º√ßlendirerek rekabet avantajƒ± saƒülayabilirsiniz.'}</p>
                    </div>
                </div>
            `;

            insightsDiv.innerHTML = html;
        }

        // Modal
        function openModal(id) {
            document.getElementById(id).classList.add('show');
        }

        function closeModal(id) {
            document.getElementById(id).classList.remove('show');
        }

        function editUrun(id) {
            const u = data.urunler.find(x => x.urun_id === id);
            if (u) {
                document.getElementById('urunId').value = u.urun_id;
                document.getElementById('urunAdi').value = u.urun_adi;
                document.getElementById('kategoriId').value = u.kategori_id;
                document.getElementById('birimMaliyet').value = u.birim_maliyet;
                document.getElementById('satisFiyati').value = u.satis_fiyati;
                document.getElementById('stokMiktari').value = u.stok_miktari;
                openModal('urunModal');
            }
        }

        // Form submit
        document.getElementById('urunForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const id = document.getElementById('urunId').value;
            const body = {
                urun_adi: document.getElementById('urunAdi').value,
                kategori_id: parseInt(document.getElementById('kategoriId').value),
                birim_maliyet: parseFloat(document.getElementById('birimMaliyet').value),
                satis_fiyati: parseFloat(document.getElementById('satisFiyati').value),
                stok_miktari: parseInt(document.getElementById('stokMiktari').value) || 0
            };

            const res = await fetch(id ? `${API}/urunler/${id}` : `${API}/urunler`, {
                method: id ? 'PUT' : 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(body)
            });

            if ((await res.json()).success) {
                closeModal('urunModal');
                await loadData();
                updateAll();
                loadUrunler();
            }
        });

        document.getElementById('rakipForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const body = {
                urun_id: parseInt(document.getElementById('rakipUrunId').value),
                rakip_adi: document.getElementById('rakipAdi').value,
                rakip_fiyat: parseFloat(document.getElementById('rakipFiyat').value),
                tarih: new Date().toISOString().split('T')[0]
            };

            const res = await fetch(`${API}/rakipfiyatlari`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(body)
            });

            if ((await res.json()).success) {
                closeModal('rakipModal');
                await loadData();
                loadRakipler();
            }
        });

        // Modal dƒ±≈üƒ± tƒ±klama
        document.querySelectorAll('.modal').forEach(m => {
            m.addEventListener('click', (e) => {
                if (e.target === m) m.classList.remove('show');
            });
        });

        // Aksiyon Takvimi
        function toggleAction(el) {
            const item = el.closest('.action-item');
            if (item.classList.contains('completed')) {
                item.classList.remove('completed');
                el.textContent = '‚òê';
            } else {
                item.classList.add('completed');
                el.textContent = '‚úÖ';
            }
            updateCalendarProgress();
            saveCalendarState();
        }

        function updateCalendarProgress() {
            const total = document.querySelectorAll('.action-item').length;
            const completed = document.querySelectorAll('.action-item.completed').length;
            const pending = total - completed;
            const percent = total > 0 ? Math.round((completed / total) * 100) : 0;

            document.getElementById('totalActions').textContent = total;
            document.getElementById('completedActions').textContent = completed;
            document.getElementById('pendingActions').textContent = pending;
            document.getElementById('progressPercent').textContent = percent + '%';
            document.getElementById('progressBar').style.width = percent + '%';
        }

        function saveCalendarState() {
            const completed = [];
            document.querySelectorAll('.action-item').forEach((item, index) => {
                if (item.classList.contains('completed')) {
                    completed.push(index);
                }
            });
            localStorage.setItem('calendarState', JSON.stringify(completed));
        }

        function loadCalendarState() {
            const saved = localStorage.getItem('calendarState');
            if (saved) {
                const completed = JSON.parse(saved);
                document.querySelectorAll('.action-item').forEach((item, index) => {
                    if (completed.includes(index)) {
                        item.classList.add('completed');
                        item.querySelector('.action-check').textContent = '‚úÖ';
                    }
                });
            }
            updateCalendarProgress();
        }

        // Sayfa y√ºklendiƒüinde takvim durumunu y√ºkle
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(loadCalendarState, 100);
        });

        // Ge√ßmi≈ü Veriler Analizi
        function runHistoryAnalysis() {
            // Veritabanƒ±ndan gelen verileri parse et
            const dolarVerileri = [];
            const pamukVerileri = [];
            
            data.cevre.forEach(v => {
                const ad = v.parametre_adi.toLowerCase();
                const tarih = new Date(v.kayit_tarihi);
                const yil = tarih.getFullYear();
                const deger = parseFloat(v.deger);
                
                if (ad.includes('dolar')) {
                    dolarVerileri.push({ yil, deger });
                } else if (ad.includes('pamuk')) {
                    pamukVerileri.push({ yil, deger });
                }
            });

            // Yƒ±la g√∂re sƒ±rala (eski ‚Üí yeni)
            dolarVerileri.sort((a, b) => a.yil - b.yil);
            pamukVerileri.sort((a, b) => a.yil - b.yil);

            // En az 3 veri yoksa varsayƒ±lan ekle
            const historicalData = {
                dolar: dolarVerileri.length >= 2 ? dolarVerileri : [
                    { yil: 2022, deger: 18.80 },
                    { yil: 2023, deger: 29.50 },
                    { yil: 2025, deger: data.base.dolar || 35.20 }
                ],
                pamuk: pamukVerileri.length >= 2 ? pamukVerileri : [
                    { yil: 2022, deger: 95 },
                    { yil: 2023, deger: 120 },
                    { yil: 2025, deger: data.base.pamuk || 152 }
                ],
                lojistik: [
                    { yil: 2022, deger: 85 },
                    { yil: 2023, deger: 100 },
                    { yil: 2025, deger: data.base.lojistik || 125 }
                ],
                enflasyon: [
                    { yil: 2022, deger: 64 },
                    { yil: 2023, deger: 65 },
                    { yil: 2025, deger: data.base.enflasyon || 44 }
                ]
            };

            console.log('Dolar Verileri:', historicalData.dolar);
            console.log('Pamuk Verileri:', historicalData.pamuk);

            // En eski ve en yeni verileri al
            const dolarIlk = historicalData.dolar[0];
            const dolarSon = historicalData.dolar[historicalData.dolar.length - 1];
            const pamukIlk = historicalData.pamuk[0];
            const pamukSon = historicalData.pamuk[historicalData.pamuk.length - 1];

            // Yƒ±l farkƒ± hesapla
            const dolarYilFark = Math.max(dolarSon.yil - dolarIlk.yil, 1);
            const pamukYilFark = Math.max(pamukSon.yil - pamukIlk.yil, 1);

            // Hesaplamalar
            const dolarArtis = ((dolarSon.deger - dolarIlk.deger) / dolarIlk.deger * 100).toFixed(0);
            const pamukArtis = ((pamukSon.deger - pamukIlk.deger) / pamukIlk.deger * 100).toFixed(0);
            
            // Yƒ±llƒ±k ortalama artƒ±≈ü (CAGR)
            const dolarYillik = Math.pow(dolarSon.deger / dolarIlk.deger, 1/dolarYilFark) - 1;
            const pamukYillik = Math.pow(pamukSon.deger / pamukIlk.deger, 1/pamukYilFark) - 1;
            const ortArtis = ((dolarYillik + pamukYillik) / 2 * 100).toFixed(0);

            // 2026 Tahmini (trend bazlƒ±)
            const dolar2026 = dolarSon.deger * (1 + dolarYillik);
            const pamuk2026 = pamukSon.deger * (1 + pamukYillik);

            // √ñzet kartlarƒ± g√ºncelle
            document.getElementById('dolarArtis').textContent = '+%' + dolarArtis;
            document.getElementById('pamukArtis').textContent = '+%' + pamukArtis;
            document.getElementById('ortArtis').textContent = '+%' + ortArtis;
            document.getElementById('tahminDolar').textContent = dolar2026.toFixed(0) + '‚Ç∫';

            // Grafikleri √ßiz
            drawDolarTrendChart(historicalData.dolar, dolar2026);
            drawPamukTrendChart(historicalData.pamuk, pamuk2026);

            // Tablo g√ºncelle
            updateHistoryTable(historicalData, dolar2026, pamuk2026);

            // Stratejik √ßƒ±karƒ±mlar
            generateHistoryInsights(dolarArtis, pamukArtis, dolar2026);

            // Karar √∂nerisi
            generateHistoryDecision(dolarYillik, pamukYillik, dolar2026);
        }

        function drawDolarTrendChart(dolarData, tahmin2026) {
            const ctx = document.getElementById('dolarTrendChart');
            if (charts.dolarTrend) charts.dolarTrend.destroy();

            // Dinamik label ve deƒüerler olu≈ütur
            const labels = dolarData.map(d => d.yil.toString());
            labels.push('2026 (Tahmin)');
            
            const values = dolarData.map(d => d.deger);
            values.push(tahmin2026);

            charts.dolarTrend = new Chart(ctx, {
                type: 'line',
                data: {
                    labels,
                    datasets: [{
                        label: 'Dolar Kuru (‚Ç∫)',
                        data: values,
                        borderColor: '#10b981',
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        fill: true,
                        tension: 0.3,
                        pointRadius: 6,
                        pointBackgroundColor: values.map((_, i) => i === 4 ? '#f59e0b' : '#10b981')
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: (ctx) => ctx.raw.toFixed(2) + ' ‚Ç∫'
                            }
                        }
                    },
                    scales: {
                        y: { 
                            grid: { color: '#2a2a4a' }, 
                            ticks: { color: '#666', callback: (v) => v + '‚Ç∫' },
                            beginAtZero: false
                        },
                        x: { grid: { display: false }, ticks: { color: '#888' } }
                    }
                }
            });
        }

        function drawPamukTrendChart(pamukData, tahmin2026) {
            const ctx = document.getElementById('pamukTrendChart');
            if (charts.pamukTrend) charts.pamukTrend.destroy();

            // Dinamik label ve deƒüerler olu≈ütur
            const labels = pamukData.map(d => d.yil.toString());
            labels.push('2026 (Tahmin)');
            
            const values = pamukData.map(d => d.deger);
            values.push(tahmin2026);

            charts.pamukTrend = new Chart(ctx, {
                type: 'line',
                data: {
                    labels,
                    datasets: [{
                        label: 'Pamuk Endeksi',
                        data: values,
                        borderColor: '#f59e0b',
                        backgroundColor: 'rgba(245, 158, 11, 0.1)',
                        fill: true,
                        tension: 0.3,
                        pointRadius: 6,
                        pointBackgroundColor: values.map((_, i) => i === 4 ? '#ef4444' : '#f59e0b')
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        y: { 
                            grid: { color: '#2a2a4a' }, 
                            ticks: { color: '#666' },
                            beginAtZero: false
                        },
                        x: { grid: { display: false }, ticks: { color: '#888' } }
                    }
                }
            });
        }

        function updateHistoryTable(histData, dolar2026, pamuk2026) {
            const tbody = document.getElementById('historyTableBody');
            
            // Dolar ve pamuk i√ßin en eski ve en yeni deƒüerleri al
            const dolarIlk = histData.dolar[0];
            const dolarSon = histData.dolar[histData.dolar.length - 1];
            const pamukIlk = histData.pamuk[0];
            const pamukSon = histData.pamuk[histData.pamuk.length - 1];
            const lojistikSon = histData.lojistik[histData.lojistik.length - 1];
            const enflasyonSon = histData.enflasyon[histData.enflasyon.length - 1];

            // Dinamik kolonlar olu≈ütur
            const dolarYillar = histData.dolar.map(d => d.yil);
            const pamukYillar = histData.pamuk.map(d => d.yil);

            const rows = [
                {
                    param: 'üíµ Dolar Kuru',
                    values: histData.dolar.map(d => d.deger.toFixed(2) + '‚Ç∫'),
                    v2026: dolar2026.toFixed(2) + '‚Ç∫',
                    change: '+' + ((dolarSon.deger - dolarIlk.deger) / dolarIlk.deger * 100).toFixed(0) + '%'
                },
                {
                    param: 'üßµ Pamuk Endeksi',
                    values: histData.pamuk.map(d => d.deger.toFixed(0)),
                    v2026: pamuk2026.toFixed(0),
                    change: '+' + ((pamukSon.deger - pamukIlk.deger) / pamukIlk.deger * 100).toFixed(0) + '%'
                },
                {
                    param: 'üöö Lojistik Endeksi',
                    values: histData.lojistik.map(d => d.deger.toFixed(0)),
                    v2026: Math.round(lojistikSon.deger * 1.15),
                    change: '+' + ((lojistikSon.deger - histData.lojistik[0].deger) / histData.lojistik[0].deger * 100).toFixed(0) + '%'
                },
                {
                    param: 'üìà Enflasyon',
                    values: histData.enflasyon.map(d => '%' + d.deger.toFixed(0)),
                    v2026: '%35 (hedef)',
                    change: '-' + Math.abs(enflasyonSon.deger - histData.enflasyon[0].deger).toFixed(0) + ' puan'
                }
            ];

            // Tablo ba≈ülƒ±ƒüƒ±nƒ± g√ºncelle
            const thead = tbody.parentElement.querySelector('thead tr');
            const uniqueYears = [...new Set([...dolarYillar, ...pamukYillar])].sort();
            thead.innerHTML = `
                <th>Parametre</th>
                ${uniqueYears.map(y => `<th>${y}</th>`).join('')}
                <th>2026 (Tahmin)</th>
                <th>Toplam Deƒüi≈üim</th>
            `;

            tbody.innerHTML = rows.map(r => `
                <tr>
                    <td><strong>${r.param}</strong></td>
                    ${r.values.map(v => `<td>${v}</td>`).join('')}
                    <td style="color: #f59e0b;">${r.v2026}</td>
                    <td><span class="badge badge-danger">${r.change}</span></td>
                </tr>
            `).join('');
        }

        function generateHistoryInsights(dolarArtis, pamukArtis, dolar2026) {
            const insights = [
                {
                    type: 'danger',
                    icon: 'üìà',
                    text: `<strong>Dolar kuru 3 yƒ±lda %${dolarArtis} arttƒ±.</strong> Bu trend devam ederse 2026'da ${dolar2026.toFixed(0)}‚Ç∫ seviyesine ula≈üabilir. ƒ∞thal hammadde maliyetleri √∂nemli √∂l√ß√ºde artacak.`
                },
                {
                    type: 'danger',
                    icon: 'üßµ',
                    text: `<strong>Pamuk endeksi %${pamukArtis} y√ºkseldi.</strong> Tekstil √ºr√ºnlerinin maliyet baskƒ±sƒ± devam ediyor. Tedarik√ßi √ße≈üitlendirmesi d√º≈ü√ºn√ºlmeli.`
                },
                {
                    type: '',
                    icon: 'üéØ',
                    text: `<strong>Yƒ±llƒ±k ortalama artƒ±≈ü %25-30 bandƒ±nda.</strong> Fiyat revizyonlarƒ± bu oranda yapƒ±lmazsa kar marjlarƒ± erir.`
                },
                {
                    type: 'success',
                    icon: 'üí°',
                    text: `<strong>Enflasyon d√º≈ü√º≈ü trendinde.</strong> 2022'de %64'ten 2025'te %44'e geriledi. Bu durum t√ºketici harcamalarƒ±nƒ± olumlu etkileyebilir.`
                }
            ];

            document.getElementById('historyInsightList').innerHTML = insights.map(i => `
                <div class="insight-item ${i.type}">
                    <span class="item-icon">${i.icon}</span>
                    <span class="item-text">${i.text}</span>
                </div>
            `).join('');
        }

        function generateHistoryDecision(dolarYillik, pamukYillik, dolar2026) {
            const avgYillik = (dolarYillik + pamukYillik) / 2 * 100;
            
            let decision = '';
            
            if (avgYillik > 20) {
                decision = `<strong>Ge√ßmi≈ü veriler y√ºksek maliyet artƒ±≈üƒ± g√∂steriyor.</strong> 3 yƒ±llƒ±k trend analizi, parametrelerin yƒ±llƒ±k ortalama %${avgYillik.toFixed(0)} arttƒ±ƒüƒ±nƒ± ortaya koyuyor.<br><br>`;
                decision += `<strong>√ñnerilen Strateji:</strong><br>`;
                decision += `‚Ä¢ Fiyatlarƒ±nƒ±zƒ± yƒ±lda en az %${Math.round(avgYillik)} artƒ±rƒ±n<br>`;
                decision += `‚Ä¢ Dolar ${dolar2026.toFixed(0)}‚Ç∫'ye √ßƒ±kma ihtimaline kar≈üƒ± ≈üimdiden tedarik anla≈ümalarƒ± yapƒ±n<br>`;
                decision += `‚Ä¢ Y√ºksek dolar etkili √ºr√ºnlerde alternatif tedarik√ßi ara≈ütƒ±rƒ±n<br>`;
                decision += `‚Ä¢ Kar marjƒ± hedefini korumak i√ßin yaz √∂ncesi mutlaka fiyat revizyonu yapƒ±n`;
            } else {
                decision = `Parametreler nispeten stabil seyrediyor. Mevcut stratejiyi koruyabilirsiniz.`;
            }

            document.getElementById('historyDecision').innerHTML = decision;
            
            // √úr√ºn bazlƒ± ge√ßmi≈ü veri analizi √ßalƒ±≈ütƒ±r
            loadUrunMaliyetGecmisi();
        }

        // √úr√ºn Bazlƒ± Maliyet Ge√ßmi≈üi - Global veri
        let maliyetGecmisiData = [];
        let selectedYear = 2025;

        async function loadUrunMaliyetGecmisi() {
            try {
                const response = await fetch('/api/maliyetgecmisi');
                const result = await response.json();
                
                if (!result.success || !result.data || result.data.length === 0) {
                    console.log('√úr√ºn maliyet ge√ßmi≈üi verisi bulunamadƒ±');
                    return;
                }

                maliyetGecmisiData = result.data;
                
                // Varsayƒ±lan olarak 2025 yƒ±lƒ±nƒ± g√∂ster
                selectYear(2025);

            } catch (error) {
                console.error('√úr√ºn maliyet ge√ßmi≈üi y√ºklenirken hata:', error);
            }
        }

        function selectYear(year) {
            selectedYear = year;
            
            // Aktif buton stilini g√ºncelle
            document.querySelectorAll('.year-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.year === String(year)) {
                    btn.classList.add('active');
                }
            });

            if (year === 'all') {
                showAllYearsComparison();
            } else {
                showYearData(year);
            }
        }

        function showYearData(year) {
            // Se√ßilen yƒ±lƒ±n verilerini filtrele
            const yearData = maliyetGecmisiData.filter(d => parseInt(d.yil) === year);
            
            if (yearData.length === 0) {
                console.log('Bu yƒ±l i√ßin veri bulunamadƒ±:', year);
                return;
            }

            // √ñzet istatistikler
            const ortMaliyet = yearData.reduce((sum, u) => sum + parseFloat(u.maliyet), 0) / yearData.length;
            const ortFiyat = yearData.reduce((sum, u) => sum + parseFloat(u.satis_fiyati), 0) / yearData.length;
            const ortKarMarji = yearData.reduce((sum, u) => sum + parseFloat(u.kar_marji || 0), 0) / yearData.length;
            const enYuksekKar = yearData.reduce((max, u) => parseFloat(u.kar_marji) > parseFloat(max.kar_marji) ? u : max, yearData[0]);

            // Kartlarƒ± g√ºncelle
            document.getElementById('ortMaliyetArtis').textContent = Math.round(ortMaliyet).toLocaleString('tr-TR') + ' ‚Ç∫';
            document.getElementById('ortFiyatArtis').textContent = Math.round(ortFiyat).toLocaleString('tr-TR') + ' ‚Ç∫';
            document.getElementById('ortKarMarji').textContent = '%' + ortKarMarji.toFixed(1);
            document.getElementById('enCokArtanUrun').textContent = enYuksekKar.urun_adi;
            document.getElementById('enCokArtanYuzde').textContent = '%' + parseFloat(enYuksekKar.kar_marji).toFixed(1);
            
            // Yƒ±l etiketlerini g√ºncelle
            document.getElementById('yilPeriod1').textContent = year;
            document.getElementById('yilPeriod2').textContent = year;
            document.getElementById('yilPeriod3').textContent = year;

            // Ba≈ülƒ±klarƒ± g√ºncelle
            document.getElementById('maliyetChartTitle').textContent = 'üíµ √úr√ºn Maliyetleri - ' + year;
            document.getElementById('karMarjiChartTitle').textContent = 'üìä Kar Marjlarƒ± - ' + year;
            document.getElementById('urunTableTitle').textContent = 'üëó √úr√ºn Verileri - ' + year;

            // Grafikleri √ßiz
            drawYearMaliyetChart(yearData, year);
            drawYearKarMarjiChart(yearData, year);

            // Tabloyu g√ºncelle
            updateYearTable(yearData, year);
        }

        function showAllYearsComparison() {
            // Yƒ±llara g√∂re grupla
            const yillar = [2022, 2023, 2024, 2025];
            const urunler = [...new Set(maliyetGecmisiData.map(d => d.urun_adi))];
            
            // Kar≈üƒ±la≈ütƒ±rmalƒ± istatistikler
            const stats = urunler.map(urunAdi => {
                const urunVerileri = maliyetGecmisiData.filter(d => d.urun_adi === urunAdi);
                const ilk = urunVerileri.find(d => parseInt(d.yil) === 2022);
                const son = urunVerileri.find(d => parseInt(d.yil) === 2025);
                
                if (!ilk || !son) return null;
                
                return {
                    urun_adi: urunAdi,
                    ilk_maliyet: parseFloat(ilk.maliyet),
                    son_maliyet: parseFloat(son.maliyet),
                    ilk_fiyat: parseFloat(ilk.satis_fiyati),
                    son_fiyat: parseFloat(son.satis_fiyati),
                    maliyet_artis: ((parseFloat(son.maliyet) - parseFloat(ilk.maliyet)) / parseFloat(ilk.maliyet) * 100),
                    fiyat_artis: ((parseFloat(son.satis_fiyati) - parseFloat(ilk.satis_fiyati)) / parseFloat(ilk.satis_fiyati) * 100),
                    ort_kar_marji: urunVerileri.reduce((sum, u) => sum + parseFloat(u.kar_marji), 0) / urunVerileri.length
                };
            }).filter(Boolean);

            // √ñzet kartlarƒ± g√ºncelle
            const ortMaliyetArtis = stats.reduce((sum, s) => sum + s.maliyet_artis, 0) / stats.length;
            const ortFiyatArtis = stats.reduce((sum, s) => sum + s.fiyat_artis, 0) / stats.length;
            const ortKarMarji = stats.reduce((sum, s) => sum + s.ort_kar_marji, 0) / stats.length;
            const enCokArtan = stats.reduce((max, s) => s.maliyet_artis > max.maliyet_artis ? s : max, stats[0]);

            document.getElementById('ortMaliyetArtis').textContent = '+%' + ortMaliyetArtis.toFixed(0);
            document.getElementById('ortFiyatArtis').textContent = '+%' + ortFiyatArtis.toFixed(0);
            document.getElementById('ortKarMarji').textContent = '%' + ortKarMarji.toFixed(1);
            document.getElementById('enCokArtanUrun').textContent = enCokArtan.urun_adi;
            document.getElementById('enCokArtanYuzde').textContent = '+%' + enCokArtan.maliyet_artis.toFixed(0);
            
            document.getElementById('yilPeriod1').textContent = '2022 ‚Üí 2025';
            document.getElementById('yilPeriod2').textContent = '2022 ‚Üí 2025';
            document.getElementById('yilPeriod3').textContent = 'T√ºm D√∂nem';

            // Ba≈ülƒ±klarƒ± g√ºncelle
            document.getElementById('maliyetChartTitle').textContent = 'üìà Maliyet Artƒ±≈ü Oranlarƒ± (2022‚Üí2025)';
            document.getElementById('karMarjiChartTitle').textContent = 'üìä Yƒ±llƒ±k Kar Marjƒ± Kar≈üƒ±la≈ütƒ±rmasƒ±';
            document.getElementById('urunTableTitle').textContent = 'üëó T√ºm Yƒ±llar Kar≈üƒ±la≈ütƒ±rmasƒ± (2022-2025)';

            // Grafikleri √ßiz
            drawAllYearsMaliyetChart(stats);
            drawAllYearsKarMarjiChart(urunler);

            // Tabloyu g√ºncelle
            updateAllYearsTable(stats);
        }

        function drawYearMaliyetChart(yearData, year) {
            const ctx = document.getElementById('urunMaliyetArtisChart');
            if (!ctx) return;
            
            if (charts.urunMaliyetArtis) charts.urunMaliyetArtis.destroy();

            const sorted = [...yearData].sort((a, b) => parseFloat(b.maliyet) - parseFloat(a.maliyet));

            charts.urunMaliyetArtis = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: sorted.map(u => u.urun_adi.length > 15 ? u.urun_adi.substring(0, 12) + '...' : u.urun_adi),
                    datasets: [{
                        label: 'Maliyet (‚Ç∫)',
                        data: sorted.map(u => parseFloat(u.maliyet)),
                        backgroundColor: 'rgba(0, 212, 255, 0.7)',
                        borderRadius: 4
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: (ctx) => ctx.raw.toLocaleString('tr-TR') + ' ‚Ç∫'
                            }
                        }
                    },
                    scales: {
                        x: { 
                            grid: { color: '#2a2a4a' }, 
                            ticks: { color: '#888', callback: (v) => v.toLocaleString('tr-TR') + '‚Ç∫' }
                        },
                        y: { 
                            grid: { display: false }, 
                            ticks: { color: '#ccc', font: { size: 11 } }
                        }
                    }
                }
            });
        }

        function drawYearKarMarjiChart(yearData, year) {
            const ctx = document.getElementById('urunKarMarjiTrendChart');
            if (!ctx) return;
            
            if (charts.urunKarMarjiTrend) charts.urunKarMarjiTrend.destroy();

            const sorted = [...yearData].sort((a, b) => parseFloat(b.kar_marji) - parseFloat(a.kar_marji));

            charts.urunKarMarjiTrend = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: sorted.map(u => u.urun_adi.length > 15 ? u.urun_adi.substring(0, 12) + '...' : u.urun_adi),
                    datasets: [{
                        label: 'Kar Marjƒ± (%)',
                        data: sorted.map(u => parseFloat(u.kar_marji)),
                        backgroundColor: sorted.map(u => {
                            const km = parseFloat(u.kar_marji);
                            if (km >= 65) return 'rgba(16, 185, 129, 0.8)';
                            if (km >= 55) return 'rgba(59, 130, 246, 0.8)';
                            return 'rgba(245, 158, 11, 0.8)';
                        }),
                        borderRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: (ctx) => 'Kar Marjƒ±: %' + ctx.raw.toFixed(1)
                            }
                        }
                    },
                    scales: {
                        x: { 
                            grid: { display: false }, 
                            ticks: { color: '#888', maxRotation: 45, font: { size: 10 } }
                        },
                        y: { 
                            grid: { color: '#2a2a4a' }, 
                            ticks: { color: '#888', callback: (v) => '%' + v },
                            min: 50,
                            max: 75
                        }
                    }
                }
            });
        }

        function drawAllYearsMaliyetChart(stats) {
            const ctx = document.getElementById('urunMaliyetArtisChart');
            if (!ctx) return;
            
            if (charts.urunMaliyetArtis) charts.urunMaliyetArtis.destroy();

            const sorted = [...stats].sort((a, b) => b.maliyet_artis - a.maliyet_artis);

            charts.urunMaliyetArtis = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: sorted.map(u => u.urun_adi.length > 15 ? u.urun_adi.substring(0, 12) + '...' : u.urun_adi),
                    datasets: [{
                        label: 'Maliyet Artƒ±≈üƒ± (%)',
                        data: sorted.map(u => u.maliyet_artis),
                        backgroundColor: sorted.map(u => {
                            if (u.maliyet_artis > 100) return 'rgba(239, 68, 68, 0.8)';
                            if (u.maliyet_artis > 80) return 'rgba(245, 158, 11, 0.8)';
                            return 'rgba(16, 185, 129, 0.8)';
                        }),
                        borderRadius: 4
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: (ctx) => 'Maliyet Artƒ±≈üƒ±: %' + ctx.raw.toFixed(1)
                            }
                        }
                    },
                    scales: {
                        x: { 
                            grid: { color: '#2a2a4a' }, 
                            ticks: { color: '#888', callback: (v) => '%' + v }
                        },
                        y: { 
                            grid: { display: false }, 
                            ticks: { color: '#ccc', font: { size: 11 } }
                        }
                    }
                }
            });
        }

        function drawAllYearsKarMarjiChart(urunler) {
            const ctx = document.getElementById('urunKarMarjiTrendChart');
            if (!ctx) return;
            
            if (charts.urunKarMarjiTrend) charts.urunKarMarjiTrend.destroy();

            const yillar = [2022, 2023, 2024, 2025];
            const colors = ['#ef4444', '#f59e0b', '#3b82f6', '#10b981'];

            // Her yƒ±l i√ßin dataset olu≈ütur
            const datasets = yillar.map((yil, i) => {
                return {
                    label: String(yil),
                    data: urunler.slice(0, 5).map(urunAdi => {
                        const veri = maliyetGecmisiData.find(d => d.urun_adi === urunAdi && parseInt(d.yil) === yil);
                        return veri ? parseFloat(veri.kar_marji) : 0;
                    }),
                    backgroundColor: colors[i] + 'cc',
                    borderRadius: 4
                };
            });

            charts.urunKarMarjiTrend = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: urunler.slice(0, 5).map(u => u.length > 12 ? u.substring(0, 10) + '...' : u),
                    datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { 
                            display: true,
                            labels: { color: '#888' }
                        }
                    },
                    scales: {
                        x: { 
                            grid: { display: false }, 
                            ticks: { color: '#888', font: { size: 10 } }
                        },
                        y: { 
                            grid: { color: '#2a2a4a' }, 
                            ticks: { color: '#888', callback: (v) => '%' + v },
                            min: 50,
                            max: 75
                        }
                    }
                }
            });
        }

        function updateYearTable(yearData, year) {
            const tbody = document.getElementById('urunMaliyetTableBody');
            if (!tbody) return;

            // Tablo ba≈ülƒ±ƒüƒ±nƒ± g√ºncelle (tek yƒ±l)
            const thead = document.getElementById('urunTableHead');
            if (thead) {
                thead.innerHTML = `
                    <tr>
                        <th>√úr√ºn</th>
                        <th>Maliyet</th>
                        <th>Satƒ±≈ü Fiyatƒ±</th>
                        <th>Kar</th>
                        <th>Kar Marjƒ±</th>
                        <th>Durum</th>
                    </tr>
                `;
            }

            tbody.innerHTML = yearData.map(u => {
                const maliyet = parseFloat(u.maliyet);
                const fiyat = parseFloat(u.satis_fiyati);
                const kar = fiyat - maliyet;
                const karMarji = parseFloat(u.kar_marji);
                
                let durum, durumClass;
                if (karMarji >= 65) {
                    durum = '‚úÖ M√ºkemmel';
                    durumClass = 'color: #10b981;';
                } else if (karMarji >= 55) {
                    durum = 'üëç ƒ∞yi';
                    durumClass = 'color: #3b82f6;';
                } else {
                    durum = '‚ö†Ô∏è Dikkat';
                    durumClass = 'color: #f59e0b;';
                }

                return `
                    <tr>
                        <td style="font-weight: 600;">${u.urun_adi}</td>
                        <td>${maliyet.toLocaleString('tr-TR')} ‚Ç∫</td>
                        <td>${fiyat.toLocaleString('tr-TR')} ‚Ç∫</td>
                        <td style="color: #10b981; font-weight: 600;">${kar.toLocaleString('tr-TR')} ‚Ç∫</td>
                        <td style="color: ${karMarji >= 60 ? '#10b981' : '#f59e0b'}; font-weight: 600;">%${karMarji.toFixed(1)}</td>
                        <td style="${durumClass} font-weight: 600;">${durum}</td>
                    </tr>
                `;
            }).join('');
        }

        function updateAllYearsTable(stats) {
            const tbody = document.getElementById('urunMaliyetTableBody');
            if (!tbody) return;

            // Tablo ba≈ülƒ±ƒüƒ±nƒ± g√ºncelle (kar≈üƒ±la≈ütƒ±rma)
            const thead = document.getElementById('urunTableHead');
            if (thead) {
                thead.innerHTML = `
                    <tr>
                        <th>√úr√ºn</th>
                        <th>2022 Maliyet</th>
                        <th>2025 Maliyet</th>
                        <th>Maliyet Artƒ±≈üƒ±</th>
                        <th>Fiyat Artƒ±≈üƒ±</th>
                        <th>Ort. Kar Marjƒ±</th>
                        <th>Durum</th>
                    </tr>
                `;
            }

            tbody.innerHTML = stats.map(u => {
                const maliyetArtis = u.maliyet_artis;
                const fiyatArtis = u.fiyat_artis;
                const karMarji = u.ort_kar_marji;
                
                let durum, durumClass;
                if (fiyatArtis >= maliyetArtis && karMarji >= 60) {
                    durum = '‚úÖ ƒ∞yi';
                    durumClass = 'color: #10b981;';
                } else if (fiyatArtis >= maliyetArtis * 0.9) {
                    durum = '‚ö†Ô∏è Takipte';
                    durumClass = 'color: #f59e0b;';
                } else {
                    durum = '‚ùå Dikkat';
                    durumClass = 'color: #ef4444;';
                }

                return `
                    <tr>
                        <td style="font-weight: 600;">${u.urun_adi}</td>
                        <td>${u.ilk_maliyet.toLocaleString('tr-TR')} ‚Ç∫</td>
                        <td>${u.son_maliyet.toLocaleString('tr-TR')} ‚Ç∫</td>
                        <td style="color: ${maliyetArtis > 100 ? '#ef4444' : '#f59e0b'}; font-weight: 600;">+%${maliyetArtis.toFixed(1)}</td>
                        <td style="color: #3b82f6; font-weight: 600;">+%${fiyatArtis.toFixed(1)}</td>
                        <td style="color: ${karMarji >= 60 ? '#10b981' : '#f59e0b'};">%${karMarji.toFixed(1)}</td>
                        <td style="${durumClass} font-weight: 600;">${durum}</td>
                    </tr>
                `;
            }).join('');
        }

        // Tahminleme
        function runForecast() {
            if (data.urunler.length === 0) return;

            // Yaz sezonu katsayƒ±larƒ± (kategori bazlƒ±)
            const seasonFactors = {
                'Plaj Giyim': 1.45,
                'Spor Giyim': 1.35,
                'G√ºnl√ºk Giyim': 1.20,
                'Aksesuar': 1.30,
                'default': 1.25
            };

            // Aylƒ±k satƒ±≈ü daƒüƒ±lƒ±mƒ± (yaz yoƒüunluklu)
            const monthlyDistribution = {
                'Ocak': 0.06, '≈ûubat': 0.06, 'Mart': 0.08, 'Nisan': 0.09,
                'Mayƒ±s': 0.11, 'Haziran': 0.14, 'Temmuz': 0.16, 'Aƒüustos': 0.14,
                'Eyl√ºl': 0.08, 'Ekim': 0.04, 'Kasƒ±m': 0.02, 'Aralƒ±k': 0.02
            };

            // Hesaplamalar
            let totalRevenue = 0;
            let totalStock = 0;
            let totalDemand = 0;
            const categoryData = {};
            const productForecasts = [];

            data.urunler.forEach(u => {
                const stok = parseInt(u.stok_miktari) || 50;
                const fiyat = parseFloat(u.satis_fiyati) || 0;
                const kategori = u.kategori_adi || 'G√ºnl√ºk Giyim';
                const factor = seasonFactors[kategori] || seasonFactors['default'];

                // Tahmini yaz talebi (stok * mevsimsel katsayƒ±)
                const demand = Math.round(stok * factor * 1.5);
                const recommendedStock = Math.round(demand * 1.2); // %20 g√ºvenlik payƒ±
                const revenue = demand * fiyat;

                totalStock += stok;
                totalDemand += demand;
                totalRevenue += revenue;

                // Kategori bazlƒ± toplama
                if (!categoryData[kategori]) {
                    categoryData[kategori] = { demand: 0, stock: 0, factor };
                }
                categoryData[kategori].demand += demand;
                categoryData[kategori].stock += stok;

                // √úr√ºn bazlƒ± tahmin
                let status, action;
                if (stok >= recommendedStock) {
                    status = 'Yeterli';
                    action = 'Stok seviyesi iyi';
                } else if (stok >= recommendedStock * 0.7) {
                    status = 'Dikkat';
                    action = `+${recommendedStock - stok} adet sipari≈ü ver`;
                } else {
                    status = 'Kritik';
                    action = `ACƒ∞L: +${recommendedStock - stok} adet gerekli`;
                }

                productForecasts.push({
                    name: u.urun_adi,
                    stock: stok,
                    demand,
                    recommended: recommendedStock,
                    status,
                    action
                });
            });

            // √ñzet kartlarƒ± g√ºncelle
            const salesIncrease = 25 + Math.round(Math.random() * 10);
            const stockIncrease = Math.round((totalDemand / totalStock - 1) * 100);
            
            document.getElementById('forecastSales').textContent = '+%' + salesIncrease;
            document.getElementById('forecastStock').textContent = '+%' + Math.max(stockIncrease, 20);
            document.getElementById('forecastRevenue').textContent = '‚Ç∫' + formatNumber(totalRevenue);

            // En y√ºksek talep kategorisi
            let maxCategory = '';
            let maxFactor = 0;
            Object.keys(categoryData).forEach(cat => {
                if (categoryData[cat].factor > maxFactor) {
                    maxFactor = categoryData[cat].factor;
                    maxCategory = cat;
                }
            });
            document.getElementById('forecastDemand').textContent = maxCategory || 'Plaj Giyim';

            // Grafikleri √ßiz
            drawSalesForecastChart(monthlyDistribution, totalRevenue);
            drawCategoryForecastChart(categoryData);
            drawStockForecastChart(productForecasts);

            // Tablo
            updateForecastTable(productForecasts);
        }

        function formatNumber(num) {
            if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
            if (num >= 1000) return (num / 1000).toFixed(0) + 'K';
            return num.toFixed(0);
        }

        function drawSalesForecastChart(distribution, totalRevenue) {
            const ctx = document.getElementById('salesForecastChart');
            if (charts.salesForecast) charts.salesForecast.destroy();

            const months = Object.keys(distribution);
            const values = months.map(m => Math.round(totalRevenue * distribution[m]));
            const colors = months.map((m, i) => i >= 4 && i <= 7 ? '#10b981' : '#3b82f6');

            charts.salesForecast = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: months,
                    datasets: [{
                        label: 'Tahmini Satƒ±≈ü (‚Ç∫)',
                        data: values,
                        backgroundColor: colors,
                        borderRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: (ctx) => '‚Ç∫' + formatNumber(ctx.raw)
                            }
                        }
                    },
                    scales: {
                        y: { 
                            grid: { color: '#2a2a4a' }, 
                            ticks: { 
                                color: '#666',
                                callback: (v) => '‚Ç∫' + formatNumber(v)
                            }
                        },
                        x: { grid: { display: false }, ticks: { color: '#666' } }
                    }
                }
            });
        }

        function drawCategoryForecastChart(categoryData) {
            const ctx = document.getElementById('categoryForecastChart');
            if (charts.categoryForecast) charts.categoryForecast.destroy();

            const categories = Object.keys(categoryData);
            const demands = categories.map(c => categoryData[c].demand);
            const increases = categories.map(c => Math.round((categoryData[c].factor - 1) * 100));

            charts.categoryForecast = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: categories,
                    datasets: [{
                        label: 'Talep Artƒ±≈üƒ± %',
                        data: increases,
                        backgroundColor: ['#10b981', '#f59e0b', '#3b82f6', '#7c3aed', '#ef4444'],
                        borderRadius: 6
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: (ctx) => '+' + ctx.raw + '% talep artƒ±≈üƒ±'
                            }
                        }
                    },
                    scales: {
                        x: { 
                            grid: { color: '#2a2a4a' }, 
                            ticks: { color: '#666', callback: (v) => '+' + v + '%' }
                        },
                        y: { grid: { display: false }, ticks: { color: '#888' } }
                    }
                }
            });
        }

        function drawStockForecastChart(forecasts) {
            const ctx = document.getElementById('stockForecastChart');
            if (charts.stockForecast) charts.stockForecast.destroy();

            const top5 = forecasts.slice(0, 5);
            const labels = top5.map(f => f.name);
            const current = top5.map(f => f.stock);
            const recommended = top5.map(f => f.recommended);

            charts.stockForecast = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels,
                    datasets: [
                        {
                            label: 'Mevcut Stok',
                            data: current,
                            backgroundColor: '#3b82f6',
                            borderRadius: 4
                        },
                        {
                            label: '√ñnerilen Stok',
                            data: recommended,
                            backgroundColor: '#10b981',
                            borderRadius: 4
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'top', labels: { color: '#888' } }
                    },
                    scales: {
                        y: { grid: { color: '#2a2a4a' }, ticks: { color: '#666' } },
                        x: { grid: { display: false }, ticks: { color: '#666', font: { size: 9 } } }
                    }
                }
            });
        }

        function updateForecastTable(forecasts) {
            const tbody = document.getElementById('forecastTableBody');
            tbody.innerHTML = '';

            forecasts.forEach(f => {
                const statusClass = f.status === 'Yeterli' ? 'badge-success' : 
                                   (f.status === 'Dikkat' ? 'badge-warning' : 'badge-danger');
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td><strong>${f.name}</strong></td>
                    <td>${f.stock}</td>
                    <td>${f.demand}</td>
                    <td>${f.recommended}</td>
                    <td><span class="badge ${statusClass}">${f.status}</span></td>
                    <td style="color: ${f.status === 'Kritik' ? '#ef4444' : '#94a3b8'}; font-size: 0.85em;">${f.action}</td>
                `;
                tbody.appendChild(tr);
            });
        }

        // Senaryo Kar≈üƒ±la≈ütƒ±rma
        function runScenarioComparison() {
            const hedef = parseInt(document.getElementById('hedefSlider').value);
            
            // 3 Senaryo tanƒ±mlarƒ±
            const scenarios = [
                { id: 1, name: 'ƒ∞yimser', dolar: 32, pamuk: 130, lojistik: 100, enflasyon: 35 },
                { id: 2, name: 'Mevcut', dolar: data.base.dolar, pamuk: data.base.pamuk, lojistik: data.base.lojistik, enflasyon: data.base.enflasyon },
                { id: 3, name: 'K√∂t√ºmser', dolar: 45, pamuk: 180, lojistik: 145, enflasyon: 60 }
            ];

            const results = [];

            scenarios.forEach(s => {
                // Parametreleri g√∂ster
                document.getElementById(`s${s.id}Dolar`).textContent = s.dolar.toFixed(2) + ' ‚Ç∫';
                document.getElementById(`s${s.id}Pamuk`).textContent = s.pamuk;
                document.getElementById(`s${s.id}Lojistik`).textContent = s.lojistik;
                document.getElementById(`s${s.id}Enflasyon`).textContent = '%' + s.enflasyon;

                // Hesaplama
                const dolarD = (s.dolar - data.base.dolar) / data.base.dolar;
                const pamukD = (s.pamuk - data.base.pamuk) / data.base.pamuk;
                const lojistikD = (s.lojistik - data.base.lojistik) / data.base.lojistik;
                const enflasyonD = (s.enflasyon - data.base.enflasyon) / 100;

                let toplamKar = 0, toplamMaliyet = 0, riskli = 0;

                data.urunler.forEach(u => {
                    const m = parseFloat(u.birim_maliyet) || 0;
                    const f = parseFloat(u.satis_fiyati) || 0;

                    const etkiler = data.etkiler.filter(e => e.urun_id === u.urun_id);
                    let oran = 0;
                    etkiler.forEach(e => {
                        const k = parseFloat(e.etki_katsayisi) || 0;
                        const p = (e.parametre_adi || '').toLowerCase();
                        if (p.includes('dolar')) oran += dolarD * k;
                        else if (p.includes('pamuk')) oran += pamukD * k;
                        else if (p.includes('lojistik')) oran += lojistikD * k;
                    });
                    oran += enflasyonD * 0.3;

                    const yeniM = m * (1 + oran);
                    const kar = f > 0 ? ((f - yeniM) / f * 100) : 0;

                    toplamKar += kar;
                    toplamMaliyet += oran;
                    if (kar < hedef) riskli++;
                });

                const avgKar = data.urunler.length ? toplamKar / data.urunler.length : 0;
                const avgMaliyet = data.urunler.length ? (toplamMaliyet / data.urunler.length * 100) : 0;

                results.push({ ...s, kar: avgKar, maliyet: avgMaliyet, riskli });

                // Sonu√ßlarƒ± g√∂ster
                const karEl = document.getElementById(`s${s.id}Kar`);
                karEl.textContent = '%' + avgKar.toFixed(1);
                karEl.className = 'result-value ' + (avgKar >= hedef ? 'success' : (avgKar >= hedef - 10 ? 'warning' : 'danger'));

                const maliyetEl = document.getElementById(`s${s.id}Maliyet`);
                maliyetEl.textContent = (avgMaliyet > 0 ? '+' : '') + avgMaliyet.toFixed(1) + '%';
                maliyetEl.className = 'result-value ' + (avgMaliyet <= 0 ? 'success' : (avgMaliyet < 10 ? 'warning' : 'danger'));

                document.getElementById(`s${s.id}Risk`).textContent = riskli;

                // Verdict
                let verdict = '';
                if (s.id === 1) {
                    verdict = riskli === 0 
                        ? '‚úÖ T√ºm √ºr√ºnler hedefte! Yatƒ±rƒ±m fƒ±rsatƒ±.' 
                        : `‚ö†Ô∏è ${riskli} √ºr√ºn hala risk altƒ±nda.`;
                } else if (s.id === 2) {
                    verdict = riskli === 0 
                        ? 'üìä Mevcut strateji ba≈üarƒ±lƒ±.' 
                        : `üìä ${riskli} √ºr√ºne zam gerekiyor.`;
                } else {
                    verdict = riskli > data.urunler.length / 2 
                        ? 'üö® Kapsamlƒ± √∂nlem planƒ± hazƒ±rlanmalƒ±!' 
                        : `‚ö†Ô∏è ${riskli} √ºr√ºn kritik duruma d√º≈üer.`;
                }
                document.getElementById(`s${s.id}Verdict`).textContent = verdict;
            });

            // Grafik
            drawScenarioChart(results, hedef);

            // √ñneri
            generateRecommendation(results, hedef);
        }

        function drawScenarioChart(results, hedef) {
            const ctx = document.getElementById('scenarioChart');
            if (charts.scenario) charts.scenario.destroy();

            charts.scenario = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['ƒ∞yimser üòä', 'Mevcut üìä', 'K√∂t√ºmser üò∞'],
                    datasets: [
                        {
                            label: 'Kar Marjƒ± %',
                            data: results.map(r => r.kar),
                            backgroundColor: results.map(r => r.kar >= hedef ? '#10b981' : '#ef4444'),
                            borderRadius: 6
                        },
                        {
                            label: 'Hedef %',
                            data: [hedef, hedef, hedef],
                            type: 'line',
                            borderColor: '#f59e0b',
                            borderWidth: 2,
                            borderDash: [5, 5],
                            pointRadius: 0,
                            fill: false
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'top', labels: { color: '#888' } }
                    },
                    scales: {
                        y: { 
                            grid: { color: '#2a2a4a' }, 
                            ticks: { color: '#666' },
                            min: 0,
                            max: 100
                        },
                        x: { grid: { display: false }, ticks: { color: '#888', font: { size: 12 } } }
                    }
                }
            });
        }

        function generateRecommendation(results, hedef) {
            const [iyimser, mevcut, kotumser] = results;
            let html = '';

            // Ana strateji
            if (mevcut.riskli === 0) {
                html += '<p><strong>‚úÖ Mevcut durumda t√ºm √ºr√ºnleriniz hedefte!</strong> Stratejiniz ba≈üarƒ±lƒ±.</p>';
            } else {
                html += `<p><strong>‚ö†Ô∏è Mevcut durumda ${mevcut.riskli} √ºr√ºn hedefin altƒ±nda.</strong> Fiyat revizyonu gerekiyor.</p>`;
            }

            // ƒ∞yimser senaryo
            html += `<p>üìà <strong>ƒ∞yimser senaryoda:</strong> Dolar ${iyimser.dolar}‚Ç∫'ye d√º≈üerse kar marjƒ±nƒ±z <strong class="success">%${iyimser.kar.toFixed(1)}</strong>'e √ßƒ±kar. `;
            if (iyimser.riskli === 0) {
                html += 'Bu durumda fiyat artƒ±≈üƒ± yapmanƒ±za gerek kalmaz.</p>';
            } else {
                html += `${iyimser.riskli} √ºr√ºn hala risk altƒ±nda kalƒ±r.</p>`;
            }

            // K√∂t√ºmser senaryo
            html += `<p>üìâ <strong>K√∂t√ºmser senaryoda:</strong> Dolar ${kotumser.dolar}‚Ç∫'ye √ßƒ±karsa maliyetler <strong class="danger">%${kotumser.maliyet.toFixed(1)}</strong> artar. `;
            html += `<strong class="danger">${kotumser.riskli} √ºr√ºn</strong> risk altƒ±na girer.</p>`;

            // Aksiyon √∂nerisi
            html += '<p><strong>üí° √ñneri:</strong> ';
            if (kotumser.riskli > data.urunler.length / 2) {
                html += 'K√∂t√ºmser senaryoya kar≈üƒ± hazƒ±rlƒ±klƒ± olun. ≈ûimdiden kademeli zam planƒ± yapƒ±n ve tedarik√ßilerle uzun vadeli anla≈ümalar imzalayƒ±n.';
            } else if (mevcut.riskli > 0) {
                html += 'Mevcut riskli √ºr√ºnlerde zam yapƒ±n. Ekonomik dalgalanmalara kar≈üƒ± stok maliyetlerini sabitleyin.';
            } else {
                html += 'Mevcut stratejinizi koruyun. Piyasayƒ± yakƒ±ndan takip edin ve fƒ±rsatlarƒ± deƒüerlendirin.';
            }
            html += '</p>';

            document.getElementById('recContent').innerHTML = html;
        }
    </script>
</body>
</html>
